{"id":"bujo-pdf-0it","content_hash":"e332456bc736026d92743701e1e9981407ad43108edc1b9d370049346517408d","title":"Migrate PlannerGenerator to use page verbs instead of direct context creation","description":"The page verb system (index_pages, future_log_pages, etc.) now uses page_set DSL for proper footers. However, PlannerGenerator still creates contexts directly and bypasses the verbs.\n\nMigrate PlannerGenerator to use the Mixin verbs:\n- Include page Mixins in PlannerGenerator\n- Replace generate_index_pages with index_pages verb\n- Replace generate_future_log_pages with future_log_pages verb\n- Update any other direct page generation to use verbs\n\nBenefits:\n- Footers will appear via draw_set_label\n- Single source of truth for page generation\n- Cleaner, more declarative planner generation","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-29T20:43:41.332835803-05:00","updated_at":"2025-11-29T21:05:19.640347399-05:00","closed_at":"2025-11-29T21:05:19.640347399-05:00","source_repo":"."}
{"id":"bujo-pdf-5po","content_hash":"2346bec67a17cf592fc256502a2717c6d35a3c42991e90f069946931995c0118","title":"Refactor weekly page daily section to use WeekGrid","description":"Update lib/bujo_pdf/pages/weekly_page.rb:\n- Replace manual 7-column calculation with WeekGrid\n- Use cell_callback for rendering daily cells\n- Ensure quantized columns align with dot grid\n\nPart of Plan #22 Phase 3","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-13T16:21:15.44189811-05:00","updated_at":"2025-11-13T17:58:02.555946133-05:00","closed_at":"2025-11-13T17:58:02.555946133-05:00","source_repo":".","labels":["plan-22","refactoring"],"dependencies":[{"issue_id":"bujo-pdf-5po","depends_on_id":"bujo-pdf-hu8","type":"blocks","created_at":"2025-11-13T16:22:17.002281946-05:00","created_by":"daemon"}]}
{"id":"bujo-pdf-6t0","content_hash":"3c538bf9a1681e98332f0bdbdabdc6923bc4037fe6466547014779485ec0c9aa","title":"Plan: Replace PdfDSL with Document DSL","description":"## Context\nThe existing PdfDSL system (~2,600 lines) was never used in production. We've built a powerful verb system via Components::All that pages use for declarative content rendering.\n\n## Goals\n1. Delete PdfDSL - remove unused code\n2. Build DocumentBuilder - clean orchestration DSL\n3. Refactor PlannerGenerator - use DocumentBuilder internally\n\n## Key Design Principle\nClear separation between:\n- **Orchestration** (DocumentBuilder) - declares WHICH pages\n- **Content** (Pages::All verbs) - defines WHAT's drawn on pages\n\n## Target API\n```ruby\nBujoPdf.define_pdf(title: \"Planner 2025\", year: 2025, output: \"planner.pdf\") do\n  index_pages(2)\n  future_log_pages(2)\n  page :seasonal\n  weeks_in(year).each do |week|\n    quarterly_planning_for(week) if week.starts_quarter?\n    page :weekly, week: week\n  end\n  grid_pages\n  template_pages\nend\n```","status":"open","priority":0,"issue_type":"epic","created_at":"2025-11-29T20:51:36.913385497-05:00","updated_at":"2025-11-29T20:55:15.880532838-05:00","source_repo":".","comments":[{"id":7,"issue_id":"bujo-pdf-6t0","author":"andy","text":"See bujo-pdf-kd8 for the implementation tasks and dependency tree.","created_at":"2025-11-30T01:55:22Z"}]}
{"id":"bujo-pdf-8e5","content_hash":"c660ccc12b2b69815ce6252aeb2ea59ea9b1c02a8e25a49c9ef9a615e6dee2ce","title":"PageSet abstraction for multi-page spreads (Index, FutureLog, Weekly)","description":"## Architecture Vision\n\nPageSet as a **child context** of PageContext (evolved RenderContext), not a separate orchestration layer.\n\n### Layered Context Model\n```\nPageContext (unified page context)\n├── Global PDF state: year, total_weeks, date_config, event_store\n├── Current page state: page_number, page_key\n├── .set (PageSet::Context) - when inside a page_set block\n│   ├── page (1-based position in set)\n│   ├── total (count of pages in set)\n│   ├── label (interpolated string like \"Index 1 of 2\")\n│   ├── first?, last?\n│   └── name (set name)\n└── Page-specific extras via **data\n```\n\n### Target API\n```ruby\n# DSL in builder/mixin\npage_set(2, \"Index %page of %total\") do |set|\n  set.each { |i| index_page(num: i + 1) }\nend\n\n# In pages\ncontext.set?           # =\u003e true\ncontext.set.page       # =\u003e 1\ncontext.set.label      # =\u003e \"Index 1 of 2\"\ndraw_set_label         # renders footer automatically\n```\n\n### Key Design Decisions\n1. PageSet is child of PageContext (`context.set`), not parallel\n2. Null object pattern - `context.set` always exists\n3. DSL block scoping auto-populates context.set\n4. build_context picks up current page set state automatically\n\nSee plan: ~/.claude/plans/jiggly-churning-moth.md","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-29T19:29:00.899735436-05:00","updated_at":"2025-11-29T20:43:46.228713406-05:00","closed_at":"2025-11-29T20:43:46.228713406-05:00","source_repo":"."}
{"id":"bujo-pdf-8e5.1","content_hash":"07f1287b2a2a72b2b6d97fd6fd75fe4763e94be5ee80b5c7704a5ba503620040","title":"Create PageSet and PageSet::Context classes","description":"## Context\nCore data structure for page set pagination info.\n\n## Implementation\nCreate `lib/bujo_pdf/page_set.rb` with:\n\n### PageSet class\n- `initialize(count:, label:, name:)`\n- `[](index)` returns PageSet::Context for that index\n- `each` yields 0-based indices\n- `size` / `count`\n- Private: `interpolate_label(page_num)` - replaces %page/%total\n\n### PageSet::Context class\n- `page` (1-based position)\n- `total`\n- `label` (interpolated string)\n- `name` (extracted from label or explicit)\n- `first?` / `last?`\n\n### PageSet::NullContext class (null object)\n- All methods return nil/false\n- Used when not inside a page_set block\n\n## Acceptance Criteria\n- [ ] PageSet enumerable with `[]` and `each`\n- [ ] Label interpolation works: \"Index %page of %total\" =\u003e \"Index 1 of 2\"\n- [ ] NullContext responds to all Context methods safely\n- [ ] Tests pass","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-29T20:18:56.162959536-05:00","updated_at":"2025-11-29T20:23:59.001567993-05:00","closed_at":"2025-11-29T20:23:59.001567993-05:00","source_repo":".","dependencies":[{"issue_id":"bujo-pdf-8e5.1","depends_on_id":"bujo-pdf-8e5","type":"parent-child","created_at":"2025-11-29T20:18:56.163847193-05:00","created_by":"daemon"}]}
{"id":"bujo-pdf-8e5.2","content_hash":"8558f0ea57b16b19d6740e2b1a6412d71b449967a74f5e27118b5fc4eace6243","title":"Evolve RenderContext into PageContext with .set attribute","description":"## Context\nPageContext is the unified context object that flows to pages. It needs a `.set` attribute for page set info.\n\n## Implementation\nModify `lib/bujo_pdf/render_context.rb` (or create page_context.rb):\n\n### Changes\n- Add `attr_accessor :set`\n- Initialize `@set = PageSet::NullContext.new` by default\n- Add `set?` method: `!@set.is_a?(PageSet::NullContext)`\n- Consider aliasing RenderContext -\u003e PageContext for transition\n\n## Acceptance Criteria\n- [ ] `context.set` always returns an object (never nil)\n- [ ] `context.set?` returns true only when in a page set\n- [ ] Backward compatible with existing hash-style access\n- [ ] Existing pages still work unchanged","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-29T20:19:14.273495503-05:00","updated_at":"2025-11-29T20:26:53.267612228-05:00","closed_at":"2025-11-29T20:26:53.267612228-05:00","source_repo":".","dependencies":[{"issue_id":"bujo-pdf-8e5.2","depends_on_id":"bujo-pdf-8e5","type":"parent-child","created_at":"2025-11-29T20:19:14.274167144-05:00","created_by":"daemon"},{"issue_id":"bujo-pdf-8e5.2","depends_on_id":"bujo-pdf-8e5.1","type":"blocks","created_at":"2025-11-29T20:19:14.275069239-05:00","created_by":"daemon"}],"comments":[{"id":1,"issue_id":"bujo-pdf-8e5.2","author":"andy","text":"Commit 7e482c7: Added @set attr_accessor to RenderContext with NullContext default, added set? method. All acceptance criteria verified with tests.","created_at":"2025-11-30T01:26:53Z"}]}
{"id":"bujo-pdf-8e5.3","content_hash":"a04d0b51d60ed8e5e444af8b6825aa4c94cfea04e52aa6ea534f912b8a08eb92","title":"Add page_set DSL to MixinSupport","description":"## Context\nThe page_set DSL allows builders to declare page sets. It auto-populates context.set for pages generated inside the block.\n\n## Implementation\nIn `lib/bujo_pdf/pages/mixin_support.rb`:\n\n### Add page_set method\n```ruby\ndef page_set(count, label = nil, name: nil)\n  set = PageSet.new(count: count, label: label, name: name)\n  if block_given?\n    set.each do |i|  # 0-based\n      @current_page_set = set\n      @current_page_set_index = i\n      yield set\n    end\n  else\n    set  # return for manual use\n  end\nensure\n  @current_page_set = nil\n  @current_page_set_index = nil\nend\n```\n\n### Update build_context\nAfter creating PageContext, attach set context if inside page_set block:\n```ruby\nif @current_page_set\n  ctx.set = @current_page_set[@current_page_set_index]\nend\n```\n\n## Acceptance Criteria\n- [ ] page_set(n, label) { } iterates n times\n- [ ] Pages inside block have context.set populated\n- [ ] Pages outside block have context.set as NullContext\n- [ ] Block scoping works correctly (nested sets?)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-29T20:19:26.165908412-05:00","updated_at":"2025-11-29T20:34:02.204305922-05:00","closed_at":"2025-11-29T20:34:02.204305922-05:00","source_repo":".","dependencies":[{"issue_id":"bujo-pdf-8e5.3","depends_on_id":"bujo-pdf-8e5","type":"parent-child","created_at":"2025-11-29T20:19:26.166934033-05:00","created_by":"daemon"},{"issue_id":"bujo-pdf-8e5.3","depends_on_id":"bujo-pdf-8e5.2","type":"blocks","created_at":"2025-11-29T20:19:26.16801904-05:00","created_by":"daemon"}],"comments":[{"id":2,"issue_id":"bujo-pdf-8e5.3","author":"andy","text":"Commit c0574cc: Added page_set DSL method and updated build_context to auto-populate context.set inside block. All acceptance criteria verified with tests.","created_at":"2025-11-30T01:34:02Z"}]}
{"id":"bujo-pdf-8e5.4","content_hash":"84c0a2480858535870e05719217972a041d2ef0c58db94abaa56bca97a80edc2","title":"Add draw_set_label helper to Pages::Base","description":"## Context\nStandard footer rendering for pages in a set.\n\n## Implementation\nIn `lib/bujo_pdf/pages/base.rb`:\n\n```ruby\ndef draw_set_label(col: 2, row: 54, width: 39)\n  return unless context.set?\n  \n  text(col, row, context.set.label,\n       size: 9, color: '999999', width: width,\n       align: :center, position: :subscript)\nend\n```\n\n## Acceptance Criteria\n- [ ] No-op when not in a page set\n- [ ] Renders context.set.label when in a set\n- [ ] Customizable position via col/row/width params","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-29T20:19:39.071946618-05:00","updated_at":"2025-11-29T20:36:30.58151606-05:00","closed_at":"2025-11-29T20:36:30.58151606-05:00","source_repo":".","dependencies":[{"issue_id":"bujo-pdf-8e5.4","depends_on_id":"bujo-pdf-8e5","type":"parent-child","created_at":"2025-11-29T20:19:39.073592693-05:00","created_by":"daemon"},{"issue_id":"bujo-pdf-8e5.4","depends_on_id":"bujo-pdf-8e5.2","type":"blocks","created_at":"2025-11-29T20:19:39.074543631-05:00","created_by":"daemon"}],"comments":[{"id":3,"issue_id":"bujo-pdf-8e5.4","author":"andy","text":"Commit 063d43d: Added draw_set_label helper to Pages::Base. No-op when not in set, renders centered gray label when in a set. Customizable col/row/width params.","created_at":"2025-11-30T01:36:30Z"}]}
{"id":"bujo-pdf-8e5.5","content_hash":"7796ff53523ccdd50af22809ef83312703b4cf5694c60b1c1d1a13cf0de38f2a","title":"Update IndexPage mixin to use page_set DSL","description":"## Context\nFirst consumer of the new page_set DSL. Proof of concept.\n\n## Implementation\nIn `lib/bujo_pdf/pages/index_pages.rb`:\n\n### Update index_pages verb\n```ruby\ndef index_pages(count: 2)\n  page_set(count, \"Index %page of %total\") do |set|\n    set.each do |i|\n      index_page(num: i + 1)\n    end\n  end\nend\n```\n\n### Update IndexPage class\n- Replace `draw_page_indicator` with `draw_set_label`\n- Remove manual @index_page_num/@index_page_count extraction (use context.set)\n\n## Acceptance Criteria\n- [ ] index_pages(count: 2) generates 2 pages with correct footers\n- [ ] Footer shows \"Index 1 of 2\", \"Index 2 of 2\"\n- [ ] Legacy single index_page(num:) still works\n- [ ] Visual output unchanged","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-29T20:19:51.761301497-05:00","updated_at":"2025-11-29T20:39:06.586246728-05:00","closed_at":"2025-11-29T20:39:06.586246728-05:00","source_repo":".","dependencies":[{"issue_id":"bujo-pdf-8e5.5","depends_on_id":"bujo-pdf-8e5","type":"parent-child","created_at":"2025-11-29T20:19:51.762368835-05:00","created_by":"daemon"},{"issue_id":"bujo-pdf-8e5.5","depends_on_id":"bujo-pdf-8e5.3","type":"blocks","created_at":"2025-11-29T20:19:51.763279994-05:00","created_by":"daemon"},{"issue_id":"bujo-pdf-8e5.5","depends_on_id":"bujo-pdf-8e5.4","type":"blocks","created_at":"2025-11-29T20:19:51.764108728-05:00","created_by":"daemon"}],"comments":[{"id":4,"issue_id":"bujo-pdf-8e5.5","author":"andy","text":"Commit 98832ed: Updated index_pages to use page_set DSL. IndexPage now uses draw_set_label and removes draw_page_indicator. Visual output unchanged - verified via PDF generation.","created_at":"2025-11-30T01:39:06Z"}]}
{"id":"bujo-pdf-8e5.6","content_hash":"19fdf1762101602677ca62b3343b5c5ead82a41b6346766f0cc361aba95fb2d6","title":"Update FutureLog mixin to use page_set DSL","description":"## Context\nSecond consumer, validates the pattern works for different page types.\n\n## Implementation\nIn `lib/bujo_pdf/pages/future_log.rb`:\n\n### Update future_log_pages verb\n```ruby\ndef future_log_pages(count: 2)\n  page_set(count, \"Future Log %page of %total\") do |set|\n    set.each do |i|\n      future_log_page(num: i + 1, start_month: i * 6 + 1)\n    end\n  end\nend\n```\n\n### Update FutureLog class\n- Replace `draw_page_indicator` with `draw_set_label`\n- Remove manual footer construction\n\n## Acceptance Criteria\n- [ ] future_log_pages generates pages with correct footers\n- [ ] Footer shows \"Future Log 1 of 2\", \"Future Log 2 of 2\"\n- [ ] Visual output unchanged","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-29T20:21:45.711294383-05:00","updated_at":"2025-11-29T20:43:23.576533153-05:00","closed_at":"2025-11-29T20:43:23.576533153-05:00","source_repo":".","dependencies":[{"issue_id":"bujo-pdf-8e5.6","depends_on_id":"bujo-pdf-8e5","type":"parent-child","created_at":"2025-11-29T20:21:45.711990237-05:00","created_by":"daemon"},{"issue_id":"bujo-pdf-8e5.6","depends_on_id":"bujo-pdf-8e5.5","type":"blocks","created_at":"2025-11-29T20:21:45.712909151-05:00","created_by":"daemon"}],"comments":[{"id":5,"issue_id":"bujo-pdf-8e5.6","author":"andy","text":"Commit 0f2d539: Updated future_log_pages to use page_set DSL. FutureLog now uses draw_set_label. Note: PlannerGenerator still uses direct context creation, will need to switch to page verbs for footers to appear.","created_at":"2025-11-30T01:43:23Z"}]}
{"id":"bujo-pdf-am1","content_hash":"790ca96abd7402210ace45f29620be107e9f61bb9ec7d195b7e18b4f5af0909c","title":"Implement quantization width calculation logic","description":"Add calculate_column_widths method to WeekGrid:\n- When quantize: true and width divisible by 7 boxes → equal box widths\n- Otherwise → proportional division of available space\n- Return array of 7 column widths\n\nPart of Plan #22 Phase 1","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-13T16:20:55.140295939-05:00","updated_at":"2025-11-13T16:33:51.09411414-05:00","closed_at":"2025-11-13T16:33:51.09411414-05:00","source_repo":".","labels":["component","plan-22"],"dependencies":[{"issue_id":"bujo-pdf-am1","depends_on_id":"bujo-pdf-dkq","type":"blocks","created_at":"2025-11-13T16:22:16.472394728-05:00","created_by":"daemon"}]}
{"id":"bujo-pdf-ayc","content_hash":"8c958a94aa95c39913b4acd700f1aba3e866b5ad933800e46de7342a0613fe34","title":"Refactor year-at-a-glance pages to use WeekGrid","description":"Update year_events.rb and year_highlights.rb:\n- Use WeekGrid for weekday header row\n- Maintain quantized column widths for visual consistency\n- Update day cell positioning to use grid.cell_rect()\n\nPart of Plan #22 Phase 3","status":"open","priority":3,"issue_type":"task","created_at":"2025-11-13T16:21:13.389098472-05:00","updated_at":"2025-11-13T16:21:13.389098472-05:00","source_repo":".","labels":["plan-22","refactoring"],"dependencies":[{"issue_id":"bujo-pdf-ayc","depends_on_id":"bujo-pdf-hu8","type":"blocks","created_at":"2025-11-13T16:22:16.991714756-05:00","created_by":"daemon"}]}
{"id":"bujo-pdf-d15","content_hash":"89156aa6a90b7430efcf78a1568d6e175949abc01bf537f058e5daa26d3d3939","title":"Pages should define their own page_type and title instead of DocumentBuilder inference","description":"## Problem\n\nDocumentBuilder uses `infer_title` and `infer_page_type` case statements to determine page metadata from verb names. This violates single responsibility - pages should be self-describing.\n\nCurrent approach in `lib/bujo_pdf/document_builder.rb`:\n- `infer_title(verb_name, kwargs)` - 25+ case branches mapping verbs to titles\n- `infer_page_type(verb_name)` - 10+ case branches mapping verbs to types\n\n## Proposed Solution\n\nHave each page class define class methods:\n\n```ruby\nclass SeasonalCalendar \u003c Pages::Base\n  def self.page_title\n    'Seasonal Calendar'\n  end\n\n  def self.page_type\n    :seasonal\n  end\nend\n```\n\nFor dynamic titles (WeeklyPage, MonthlyReview), accept kwargs:\n\n```ruby\nclass WeeklyPage \u003c Pages::Base\n  def self.page_title(week:, **)\n    \"Week #{week}\"\n  end\n\n  def self.page_type\n    :weekly\n  end\nend\n```\n\nThen `DocumentBuilder#create_page_ref` calls the class methods instead of inference:\n\n```ruby\ndef create_page_ref(verb_name, args, kwargs)\n  page_class = page_class_for_verb(verb_name)\n  title = page_class.page_title(**kwargs)\n  page_type = page_class.page_type\n  # ...\nend\n```\n\n## Benefits\n\n1. Pages are self-describing - no external inference needed\n2. Adding new pages doesn't require updating DocumentBuilder\n3. Single source of truth for page metadata\n4. Easier to test - page classes can be tested in isolation\n\n## Files to modify\n\n- Add `page_title` and `page_type` class methods to all page classes in `lib/bujo_pdf/pages/`\n- Remove `infer_title` and `infer_page_type` from `lib/bujo_pdf/document_builder.rb`\n- Add `page_class_for_verb` mapping (or use verb naming convention)","status":"open","priority":2,"issue_type":"chore","created_at":"2025-11-29T21:28:32.190380956-05:00","updated_at":"2025-11-29T21:28:32.190380956-05:00","source_repo":"."}
{"id":"bujo-pdf-ddv","content_hash":"4b7bd44f971ba6b20cd9ee8184dbaeea38da88655b8b7212817459e38142f916","title":"Write WeekGrid unit tests","description":"Create comprehensive tests for WeekGrid:\n- Width calculation edge cases (divisible by 7, not divisible, zero/negative)\n- Quantize true vs false behavior\n- Cell positioning accuracy\n- Different first_day values\n- Header rendering with/without show_headers\n\nPart of Plan #22 Phase 1","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-13T16:21:08.098172293-05:00","updated_at":"2025-11-13T16:39:01.975636065-05:00","closed_at":"2025-11-13T16:39:01.975636065-05:00","source_repo":".","labels":["plan-22","testing"],"dependencies":[{"issue_id":"bujo-pdf-ddv","depends_on_id":"bujo-pdf-am1","type":"blocks","created_at":"2025-11-13T16:22:16.666033213-05:00","created_by":"daemon"},{"issue_id":"bujo-pdf-ddv","depends_on_id":"bujo-pdf-fjh","type":"blocks","created_at":"2025-11-13T16:22:16.677928029-05:00","created_by":"daemon"}]}
{"id":"bujo-pdf-dkq","content_hash":"f39ac2060c46387b38e492a450d83b0c611116f1e27943adb20b14e91f0f63fc","title":"Create WeekGrid component class with basic structure","description":"Create lib/bujo_pdf/components/week_grid.rb with:\n- Component class skeleton\n- Constructor accepting pdf, x, y, width, height, quantize, first_day, show_headers, header_height, cell_callback\n- Basic parameter validation\n\nPart of Plan #22 Phase 1","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-13T16:20:51.310329042-05:00","updated_at":"2025-11-13T16:26:48.324600074-05:00","closed_at":"2025-11-13T16:26:48.324600074-05:00","source_repo":".","labels":["component","plan-22"]}
{"id":"bujo-pdf-fjh","content_hash":"2b812d45bd3b67eb0cb8d50c09740b0033c93735bf9f33b0dd17183aeb90cc22","title":"Implement WeekGrid rendering methods","description":"Add to WeekGrid:\n- render() - main rendering orchestration\n- draw_headers() - weekday labels (M/T/W/T/F/S/S)\n- draw_column_dividers() - vertical lines between days\n- render_cells() - invoke cell_callback for each cell\n- cell_rect(day_index) - calculate cell boundaries\n- each_cell() - iterator yielding day_index and rect\n\nPart of Plan #22 Phase 1","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-13T16:21:00.975034722-05:00","updated_at":"2025-11-13T16:33:51.105900764-05:00","closed_at":"2025-11-13T16:33:51.105900764-05:00","source_repo":".","labels":["component","plan-22"],"dependencies":[{"issue_id":"bujo-pdf-fjh","depends_on_id":"bujo-pdf-dkq","type":"blocks","created_at":"2025-11-13T16:22:16.567039352-05:00","created_by":"daemon"}]}
{"id":"bujo-pdf-ft8","content_hash":"664c6c602014dcd38ed273493fc5e17fe31169589ea8c363fddb3e69f85ffb6e","title":"Add layout helper meta-components for margins, columns, rows","description":"Create meta-components that help with common layout calculations:\n\n- **Margins**: Inset content by N boxes on each side\n- **Columns**: Split a region into N equal columns (box-quantized)\n- **Rows**: Split a region into N equal rows (box-quantized)\n\nThese would be calculation helpers rather than rendering components,\nreturning bounds that other components can use.\n\nExample usage ideas:\n```ruby\n# Get inset bounds\ninner = margins(col, row, width, height, left: 2, right: 2)\n\n# Split into quantized columns\ncols = columns(col, row, width, height, count: 3, gap: 1)\ncols.each { |c| ruled_lines(c.col, c.row, c.width, c.height) }\n\n# Split into quantized rows\nrows = rows(col, row, width, height, count: 4, gap: 1)\n```\n\nDiscovered while building RuledLines component - the old SubComponent::RuledLines\nhad margin support that was removed for simplicity. These meta-components would\nprovide a cleaner, composable approach.","status":"open","priority":3,"issue_type":"feature","created_at":"2025-11-29T17:41:27.200756891-05:00","updated_at":"2025-11-29T17:41:27.200756891-05:00","source_repo":"."}
{"id":"bujo-pdf-fuo","content_hash":"e1ed2025bfc61dd98a90e47f6bc84bdac38d0c28317c32c9947fecc93c36ddc0","title":"Update CLAUDE.md with WeekGrid component documentation","description":"Add WeekGrid section to CLAUDE.md:\n- Component overview and key features\n- Usage examples\n- Parameter documentation\n- Integration with grid system\n\nPart of Plan #22 Phase 2","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-13T16:21:18.060934895-05:00","updated_at":"2025-11-13T19:05:41.700972213-05:00","closed_at":"2025-11-13T19:05:41.700972213-05:00","source_repo":".","labels":["documentation","plan-22"],"dependencies":[{"issue_id":"bujo-pdf-fuo","depends_on_id":"bujo-pdf-hu8","type":"blocks","created_at":"2025-11-13T16:22:16.874131381-05:00","created_by":"daemon"}]}
{"id":"bujo-pdf-hu8","content_hash":"cf0f59ec6551594c8ceee77d2547ad62e34f7229853593e939de6f05d120cc65","title":"Add grid system integration for WeekGrid","description":"Integrate WeekGrid with existing grid system:\n- Add WeekGrid.from_grid() constructor accepting col, row, width_boxes, height_boxes\n- Add week_grid() helper to lib/bujo_pdf/utilities/grid_system.rb\n- Ensure component works with grid coordinate system\n\nPart of Plan #22 Phase 2","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-13T16:21:03.160580462-05:00","updated_at":"2025-11-13T16:40:18.430726146-05:00","closed_at":"2025-11-13T16:40:18.430726146-05:00","source_repo":".","labels":["grid-system","plan-22"],"dependencies":[{"issue_id":"bujo-pdf-hu8","depends_on_id":"bujo-pdf-ddv","type":"blocks","created_at":"2025-11-13T16:22:16.775556038-05:00","created_by":"daemon"}]}
{"id":"bujo-pdf-itj","content_hash":"71317db09aee8a35909711dd2e4f78f2007134f3967ef96379ad29ff9929f018","title":"Add WeekGrid example to CLAUDE.local.md","description":"Add WeekGrid usage pattern to Common Layout Patterns section in CLAUDE.local.md:\n- Show quantized week grid example\n- Demonstrate each_cell iteration pattern\n- Include rect structure documentation\n\nPart of Plan #22 Phase 2","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-13T16:21:25.224313761-05:00","updated_at":"2025-11-13T19:05:41.713756988-05:00","closed_at":"2025-11-13T19:05:41.713756988-05:00","source_repo":".","labels":["documentation","plan-22"],"dependencies":[{"issue_id":"bujo-pdf-itj","depends_on_id":"bujo-pdf-hu8","type":"blocks","created_at":"2025-11-13T16:22:16.883949664-05:00","created_by":"daemon"}]}
{"id":"bujo-pdf-kd8","content_hash":"03c7d761b5c9e5003e8588f9052899df662dcec591fb71e9f6f415e93ed97689","title":"Plan: Replace PdfDSL with Document DSL","description":"Replace unused PdfDSL system with clean DocumentBuilder DSL.\n\n## Architecture: Define → Validate → Render\n\n### Define Phase\nDeclarative document structure - no rendering yet:\n```ruby\nDocumentBuilder.generate(\"planner.pdf\", year: 2025) do\n  @index = page_set(2, \"Index %page of %total\") { |i| index_page(num: i + 1) }\n  @weeks = weeks_in(year).map { |week| weekly_page(week: week) }\nend\n```\n\n### Validate Phase\nBefore rendering, validate all internal links resolve to valid PageRefs.\nCatches typos and missing destinations with clear errors.\n\n### Render Phase\nGenerate PDF, assigning real page numbers to PageRefs.\n\n## Core Concepts\n\n- **PageRef**: Single page with metadata (dest_name, title, page_type, pdf_page_number)\n- **PageSet**: Collection of related pages with \"X of Y\" context for footers\n- **Auto-wrapping verbs**: Verbs return PageRefs, participate in page_set context\n- **Type-safe links**: Reference PageRefs directly, validated before render\n- **Automatic outline**: Built from page metadata and set membership\n\n## Benefits Over Current System\n1. No manual `@foo = @pdf.page_number` tracking\n2. Type-safe links (no string typos causing silent failures)\n3. Accurate total_pages before rendering\n4. Automatic outline generation\n5. Clear validation errors for broken links\n6. ~2,600 lines of unused PdfDSL code deleted","status":"open","priority":0,"issue_type":"epic","created_at":"2025-11-29T20:51:49.579242274-05:00","updated_at":"2025-11-29T21:17:48.896134411-05:00","source_repo":".","dependencies":[{"issue_id":"bujo-pdf-kd8","depends_on_id":"bujo-pdf-q94","type":"blocks","created_at":"2025-11-29T21:19:03.755883421-05:00","created_by":"daemon"}],"comments":[{"id":6,"issue_id":"bujo-pdf-kd8","author":"andy","text":"See also bujo-pdf-6t0 which has a more detailed description of the plan context and target API.","created_at":"2025-11-30T01:55:22Z"},{"id":8,"issue_id":"bujo-pdf-kd8","author":"andy","text":"Note: PdfDSL has define_pdf(name, \u0026block) for named recipes. Our new DSL uses define_pdf(year:, output:, \u0026block) for direct generation. Different signatures, no conflict since PdfDSL isn't auto-loaded. Can coexist during development for comparison.","created_at":"2025-11-30T01:57:19Z"}]}
{"id":"bujo-pdf-kd8.1","content_hash":"b0a9f7396a93ef93c48bf7346ca6f16a80ac2ffbd6b4ce79c5742a6bccb99392","title":"Delete PdfDSL system (~2,600 lines)","description":"Delete unused PdfDSL code:\n\n## Files to Delete\n- lib/bujo_pdf/pdf_dsl.rb\n- lib/bujo_pdf/pdf_dsl/ (entire directory - 8 files)\n- test/unit/pdf_dsl/ (entire directory - 7 test files)\n- test/integration/standard_planner_generation_test.rb\n\n## Code to Remove\n- lib/bujo_pdf.rb: Remove define_pdf and generate_from_recipe methods\n\n## Verification\n- Run tests to ensure nothing broke\n- Generate planner to verify output unchanged","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-29T20:51:58.058031572-05:00","updated_at":"2025-11-29T20:57:34.357968841-05:00","source_repo":".","dependencies":[{"issue_id":"bujo-pdf-kd8.1","depends_on_id":"bujo-pdf-kd8","type":"parent-child","created_at":"2025-11-29T20:51:58.058678022-05:00","created_by":"daemon"},{"issue_id":"bujo-pdf-kd8.1","depends_on_id":"bujo-pdf-kd8.7","type":"blocks","created_at":"2025-11-29T20:56:50.656514734-05:00","created_by":"daemon"}],"comments":[{"id":9,"issue_id":"bujo-pdf-kd8.1","author":"andy","text":"Delayed until after verification. Compare old PdfDSL approach with new DocumentBuilder before deletion to ensure we haven't lost any valuable concepts. PdfDSL has ~2,600 lines including LinkRegistry and recipe system - review these before final removal.","created_at":"2025-11-30T01:57:28Z"}]}
{"id":"bujo-pdf-kd8.2","content_hash":"9c4c433014f361adf3eca118e99490caf277e65dbe459cf32e5392d9d4b5ffcd","title":"Create Week value object for iteration","description":"Create lib/bujo_pdf/week.rb - value object for week iteration.\n\n## Purpose\n\nClean iteration over weeks in DocumentBuilder:\n```ruby\nweeks_in(2025).each do |week|\n  quarterly_planning_page(quarter: week.quarter) if week.starts_quarter?\n  monthly_review_page(month: week.month) if week.starts_month?\n  weekly_page(week: week)\nend\n```\n\n## Interface\n\n```ruby\nclass Week\n  attr_reader :year, :number, :start_date, :end_date\n  \n  def initialize(year:, number:)\n    @year = year\n    @number = number\n    @start_date = DateCalculator.week_start(year, number)\n    @end_date = DateCalculator.week_end(year, number)\n  end\n  \n  # Month of the week start\n  def month = start_date.month\n  def month_name = Date::MONTHNAMES[month]\n  \n  # Quarter (1-4)\n  def quarter = ((month - 1) / 3) + 1\n  \n  # Boundary detection for interleaving\n  def starts_month?\n    # True if this is the first week starting in this month\n  end\n  \n  def starts_quarter?\n    # True if this is the first week starting in this quarter\n  end\n  \n  def first_of_month?\n    # True if this is first week where start_date.month == month\n  end\n  \n  # For page context\n  def to_context\n    {\n      week_num: number,\n      week_start: start_date,\n      week_end: end_date\n    }\n  end\nend\n\n# Helper method for DocumentBuilder\ndef weeks_in(year)\n  total = DateCalculator.total_weeks(year)\n  (1..total).map { |n| Week.new(year: year, number: n) }\nend\n```\n\n## Boundary Detection\n\nThe tricky part is detecting month/quarter boundaries correctly:\n- Week 1 might start in December of previous year\n- Need to track \"have we generated January yet?\" state\n\nOptions:\n1. Week tracks state internally (stateful)\n2. weeks_in returns iterator that tracks state\n3. DocumentBuilder tracks generated months/quarters\n\nRecommend option 3 - DocumentBuilder tracks state, Week just provides data:\n```ruby\nweeks_in(year).each do |week|\n  if week.in_year?(year) \u0026\u0026 !@generated_quarters.include?(week.quarter)\n    quarterly_planning_page(quarter: week.quarter)\n    @generated_quarters.add(week.quarter)\n  end\n  # ...\nend\n```","status":"in_progress","priority":1,"issue_type":"task","created_at":"2025-11-29T20:52:19.122751088-05:00","updated_at":"2025-11-29T21:34:40.825283903-05:00","source_repo":".","dependencies":[{"issue_id":"bujo-pdf-kd8.2","depends_on_id":"bujo-pdf-kd8","type":"parent-child","created_at":"2025-11-29T20:52:19.123397744-05:00","created_by":"daemon"}]}
{"id":"bujo-pdf-kd8.3","content_hash":"85c0ec85a627ff25f23760eee6d433acc20f6027707451e10e6cec14196af623","title":"Create DocumentBuilder orchestration class","description":"Create lib/bujo_pdf/document_builder.rb - the core orchestration DSL.\n\n## Three-Phase Architecture\n\n### 1. Define Phase\nBuild document structure without rendering. Collect PageRefs and register links.\n\n```ruby\nDocumentBuilder.generate(\"planner.pdf\", year: 2025) do\n  @seasonal = seasonal_calendar\n  @index = page_set(2, \"Index %page of %total\") { |i| index_page(num: i + 1) }\n  @weeks = weeks_in(year).map { |week| weekly_page(week: week) }\n  @grids = grid_pages\nend\n```\n\n### 2. Validate Phase\nBefore rendering, validate all internal links resolve to valid PageRefs:\n- Catch typos in destination names\n- Detect links to removed/missing pages\n- Fail fast with clear error messages\n\n### 3. Render Phase\nGenerate actual PDF, assigning real page numbers to PageRefs.\n\n## Core Classes\n\n### PageRef\nRepresents a single generated page:\n```ruby\nclass PageRef\n  attr_reader :dest_name, :title, :page_type\n  attr_accessor :pdf_page_number, :set_context\n  \n  def outline_title\n    set_context\u0026.label || title\n  end\nend\n```\n\n### PageSet\nCollection of related pages with pagination context:\n```ruby\nclass PageSet\n  include Enumerable\n  attr_reader :name, :label_pattern\n  \n  def add(page_ref)\n    # Attaches SetContext to page_ref\n  end\n  \n  SetContext = Data.define(:page, :total, :label, :set_name) do\n    def first? = page == 1\n    def last? = page == total\n  end\nend\n```\n\n## Auto-Wrapping Verbs\n\nVerbs in DocumentBuilder are wrapped to:\n1. Create PageRef with metadata\n2. Register for validation\n3. Return PageRef (not void)\n4. Participate in page_set context if active\n\n```ruby\n# Verbs automatically return PageRefs in DocumentBuilder\n@events = year_events_page  # Returns PageRef\n@events.pdf_page_number     # Available after render phase\n```\n\n## Type-Safe Links\n\nLinks reference PageRefs directly - validated before render:\n```ruby\n# In page definitions\nlink_to(@next_week_ref) { draw_nav_arrow(:right) }\n\n# Validation catches broken links before PDF generation\n```\n\n## Automatic Outline Generation\n\nOutline built from PageRef metadata and set membership:\n- page_type determines outline category\n- set membership determines grouping\n- No manual page number tracking needed\n\n## Entry Point\n\n```ruby\ndef generate(\u0026block)\n  instance_eval(\u0026block)  # Define phase\n  validate!              # Validate phase - raises on broken links\n  render!                # Render phase - generates PDF\nend\n```\n\n## Benefits\n- Type-safe links (no string typos)\n- Accurate total_pages before rendering\n- Pre-computed page numbers for footers\n- Clear errors for missing destinations\n- Automatic outline from page metadata","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-29T20:52:35.327708836-05:00","updated_at":"2025-11-29T21:33:47.662710456-05:00","closed_at":"2025-11-29T21:33:47.662710456-05:00","source_repo":".","dependencies":[{"issue_id":"bujo-pdf-kd8.3","depends_on_id":"bujo-pdf-kd8","type":"parent-child","created_at":"2025-11-29T20:52:35.328374988-05:00","created_by":"daemon"},{"issue_id":"bujo-pdf-kd8.3","depends_on_id":"bujo-pdf-q94","type":"blocks","created_at":"2025-11-29T21:18:08.544395778-05:00","created_by":"daemon"}],"comments":[{"id":11,"issue_id":"bujo-pdf-kd8.3","author":"andy","text":"Commit 09fb2e9: Added simplified DocumentBuilder. Includes Pages::All mixins for page verbs. Full three-phase architecture (define→validate→render) with auto-wrapping verbs deferred - would require modifying all page mixins to return PageRefs. Current version provides foundation with track_page() method.","created_at":"2025-11-30T02:33:47Z"}]}
{"id":"bujo-pdf-kd8.4","content_hash":"e3fac52d3d13f1fd677a0aa9fc6667105299808799aed9a9bf598f9fcebb46ce","title":"Add BujoPdf.define_pdf entry point method","description":"Add convenience method to lib/bujo_pdf.rb:\n\n```ruby\ndef self.define_pdf(year:, output:, title: nil, theme: :light, \u0026block)\n  DocumentBuilder.new(year: year, output: output, title: title, theme: theme).generate(\u0026block)\nend\n```","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-29T20:52:49.998130424-05:00","updated_at":"2025-11-29T21:34:36.503501775-05:00","closed_at":"2025-11-29T21:34:36.503501775-05:00","source_repo":".","dependencies":[{"issue_id":"bujo-pdf-kd8.4","depends_on_id":"bujo-pdf-kd8","type":"parent-child","created_at":"2025-11-29T20:52:49.999201018-05:00","created_by":"daemon"},{"issue_id":"bujo-pdf-kd8.4","depends_on_id":"bujo-pdf-kd8.3","type":"blocks","created_at":"2025-11-29T20:52:50.000029043-05:00","created_by":"daemon"}],"comments":[{"id":12,"issue_id":"bujo-pdf-kd8.4","author":"andy","text":"Commit cce620d: Added BujoPdf.define_pdf(year:, output:, theme:, \u0026block) entry point.","created_at":"2025-11-30T02:34:36Z"}]}
{"id":"bujo-pdf-kd8.5","content_hash":"430be360060ef03192104c257e1cb83a048725abd60e4169571df77f4814aee1","title":"Refactor PlannerGenerator to use DocumentBuilder","description":"Refactor PlannerGenerator to use DocumentBuilder internally.\n\n## Before\n~300 lines of procedural page generation with manual page number tracking:\n```ruby\nyear_events_page\n@events_page = @pdf.page_number  # Manual tracking everywhere\n```\n\n## After\nThin wrapper using DocumentBuilder DSL with automatic tracking:\n\n```ruby\ndef generate(filename)\n  DocumentBuilder.generate(filename, year: @year) do\n    @seasonal = seasonal_calendar\n    \n    @index = page_set(INDEX_PAGE_COUNT, \"Index %page of %total\") do |i|\n      index_page(num: i + 1)\n    end\n    \n    @future_log = page_set(FUTURE_LOG_PAGE_COUNT, \"Future Log %page of %total\") do |i|\n      future_log_page(num: i + 1)\n    end\n    \n    @year_events = year_events_page\n    @year_highlights = year_highlights_page\n    @multi_year = multi_year_page\n    \n    weeks_in(@year).each do |week|\n      quarterly_planning_page(quarter: week.quarter) if week.starts_quarter?\n      monthly_review_page(month: week.month) if week.starts_month?\n      weekly_page(week: week)\n    end\n    \n    @grids = grid_pages      # Returns PageSet\n    @templates = template_pages  # Returns PageSet\n    \n    @collections_config.collections.each do |c|\n      collection_page(id: c[:id], title: c[:title], subtitle: c[:subtitle])\n    end\n    \n    # Outline auto-generated from PageRef metadata!\n  end\nend\n```\n\n## Key Improvements\n- No manual `@foo = @pdf.page_number` bookkeeping\n- PageRefs capture page metadata automatically\n- page_set handles \"X of Y\" footer labels\n- Links validated before render (no silent broken links)\n- Outline generated from page types, not manual definition\n- total_pages known accurately before rendering","status":"open","priority":1,"issue_type":"task","created_at":"2025-11-29T20:53:00.989576982-05:00","updated_at":"2025-11-29T21:17:40.218291007-05:00","source_repo":".","dependencies":[{"issue_id":"bujo-pdf-kd8.5","depends_on_id":"bujo-pdf-kd8","type":"parent-child","created_at":"2025-11-29T20:53:00.990340247-05:00","created_by":"daemon"},{"issue_id":"bujo-pdf-kd8.5","depends_on_id":"bujo-pdf-kd8.3","type":"blocks","created_at":"2025-11-29T20:53:00.991283169-05:00","created_by":"daemon"},{"issue_id":"bujo-pdf-kd8.5","depends_on_id":"bujo-pdf-kd8.2","type":"blocks","created_at":"2025-11-29T20:53:00.992166268-05:00","created_by":"daemon"}]}
{"id":"bujo-pdf-kd8.6","content_hash":"496c16b788d83b0f022b526e09b3c013a52009b29a3197fda6df987e072bfde6","title":"Write DocumentBuilder tests","description":"Write unit and integration tests for DocumentBuilder:\n\n## Unit Tests\n- DocumentBuilder#page generates pages correctly\n- Convenience methods (index_pages, grid_pages, etc.) work\n- Week value object methods (starts_quarter?, starts_month?)\n- Page tracking for outline generation\n\n## Integration Test\n- Generate complete planner using DocumentBuilder\n- Compare output to existing PlannerGenerator output\n- Verify page count, destinations, outline","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-29T20:53:09.17164299-05:00","updated_at":"2025-11-29T20:53:09.17164299-05:00","source_repo":".","dependencies":[{"issue_id":"bujo-pdf-kd8.6","depends_on_id":"bujo-pdf-kd8","type":"parent-child","created_at":"2025-11-29T20:53:09.172391302-05:00","created_by":"daemon"},{"issue_id":"bujo-pdf-kd8.6","depends_on_id":"bujo-pdf-kd8.5","type":"blocks","created_at":"2025-11-29T20:53:09.173402793-05:00","created_by":"daemon"}]}
{"id":"bujo-pdf-kd8.7","content_hash":"fef143d04af666cf04001e632e6225e25200eda16d3ba3bb1524d954ae2af2a4","title":"Verify planner output unchanged","description":"Final verification that refactored PlannerGenerator produces identical output:\n\n## Steps\n1. Generate planner with current PlannerGenerator (save as baseline)\n2. Refactor to use DocumentBuilder\n3. Generate planner again\n4. Compare: page count, file size, visual inspection\n5. Run full test suite","status":"open","priority":1,"issue_type":"task","created_at":"2025-11-29T20:53:16.351893828-05:00","updated_at":"2025-11-29T20:53:16.351893828-05:00","source_repo":".","dependencies":[{"issue_id":"bujo-pdf-kd8.7","depends_on_id":"bujo-pdf-kd8","type":"parent-child","created_at":"2025-11-29T20:53:16.352753622-05:00","created_by":"daemon"},{"issue_id":"bujo-pdf-kd8.7","depends_on_id":"bujo-pdf-kd8.5","type":"blocks","created_at":"2025-11-29T20:53:16.354070857-05:00","created_by":"daemon"}]}
{"id":"bujo-pdf-ldq","content_hash":"959e66e754a2edb63f0ae359a63b6fdb9da0f18b61611cbe3766d9b8d5f8151b","title":"Refactor seasonal calendar to use WeekGrid","description":"Replace manual mini-month column calculation in lib/bujo_pdf/pages/seasonal_calendar.rb:\n- Use WeekGrid for weekday columns\n- Set quantize: true for grid alignment\n- Update render_mini_month to use grid.each_cell pattern\n\nPart of Plan #22 Phase 3","status":"open","priority":3,"issue_type":"task","created_at":"2025-11-13T16:21:10.104311073-05:00","updated_at":"2025-11-13T16:21:10.104311073-05:00","source_repo":".","labels":["plan-22","refactoring"],"dependencies":[{"issue_id":"bujo-pdf-ldq","depends_on_id":"bujo-pdf-hu8","type":"blocks","created_at":"2025-11-13T16:22:16.981916969-05:00","created_by":"daemon"}]}
{"id":"bujo-pdf-q94","content_hash":"5d3c279c559b36d8f199ed9f138789f195798de7674f5ef0be4c50e11f0c0028","title":"Create PageRef and PageSet classes","description":"Create lib/bujo_pdf/page_ref.rb and lib/bujo_pdf/page_set.rb.\n\n## PageRef\n\nRepresents a single generated page:\n\n```ruby\nclass PageRef\n  attr_reader :dest_name, :title, :page_type, :metadata\n  attr_accessor :pdf_page_number, :set_context\n  \n  def initialize(dest_name:, title:, page_type:, metadata: {})\n    @dest_name = dest_name\n    @title = title\n    @page_type = page_type\n    @metadata = metadata\n    @pdf_page_number = nil  # Assigned during render phase\n    @set_context = nil      # Assigned if part of PageSet\n  end\n  \n  def in_set? = !set_context.nil?\n  \n  def outline_title\n    set_context\u0026.label || title\n  end\n  \n  # For link validation\n  def valid_destination? = true\nend\n```\n\n## PageSet\n\nCollection of related pages with pagination context:\n\n```ruby\nclass PageSet\n  include Enumerable\n  \n  attr_reader :name, :label_pattern, :count\n  \n  def initialize(name:, count:, label_pattern: nil)\n    @name = name\n    @count = count\n    @label_pattern = label_pattern\n    @pages = []\n  end\n  \n  def add(page_ref)\n    position = @pages.length + 1\n    page_ref.set_context = SetContext.new(\n      page: position,\n      total: @count,\n      label: interpolate_label(position),\n      set_name: @name\n    )\n    @pages \u003c\u003c page_ref\n    page_ref\n  end\n  \n  def each(\u0026) = @pages.each(\u0026)\n  def [](i) = @pages[i]\n  def first = @pages.first\n  def last = @pages.last\n  def size = @pages.length\n  \n  def outline_entry\n    { destination: first\u0026.pdf_page_number, title: @name }\n  end\n  \n  private\n  \n  def interpolate_label(pos)\n    label_pattern\u0026.gsub('%page', pos.to_s)\u0026.gsub('%total', @count.to_s)\n  end\n  \n  SetContext = Data.define(:page, :total, :label, :set_name) do\n    def first? = page == 1\n    def last? = page == total\n  end\nend\n```\n\n## Usage\n\n```ruby\n# Standalone page\nref = PageRef.new(dest_name: 'seasonal', title: 'Seasonal Calendar', page_type: :seasonal)\n\n# Page in a set\nset = PageSet.new(name: 'Index', count: 2, label_pattern: 'Index %page of %total')\nref1 = PageRef.new(dest_name: 'index_1', title: 'Index', page_type: :index)\nset.add(ref1)\nref1.set_context.label  # =\u003e \"Index 1 of 2\"\n```","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-29T21:18:04.237042623-05:00","updated_at":"2025-11-29T21:24:12.304521832-05:00","closed_at":"2025-11-29T21:24:12.304521832-05:00","source_repo":".","comments":[{"id":10,"issue_id":"bujo-pdf-q94","author":"andy","text":"Commit 8957a35: Created PageRef and PageSet classes per spec. Renamed existing PageSet to PageSetContext to avoid collision. All tests pass, planner generates correctly.","created_at":"2025-11-30T02:24:12Z"}]}
