{"id":"bujo-0c3","title":"Epic: Improve test coverage to 70%+ across all files","description":"## Objective\nBring test coverage up from current levels to at least 70% across all library files.\n\n## Current State\n- 51 files below 50% coverage\n- 8 files below 20% coverage (critical)\n- Many core components and pages lack meaningful test coverage\n\n## Approach\nEach child task covers a single file. Priority based on:\n1. Coverage percentage (lower = higher priority)\n2. Code complexity (more uncovered lines = higher priority)\n3. File importance (core components \u003e specialized pages)\n\n## Coverage Targets\n- Phase 1: Get all files to 50%+\n- Phase 2: Get all files to 70%+\n\n## Test Philosophy\nFollow smoke test principles:\n- Test behavior, not implementation\n- Test public interfaces\n- Verify core functionality works\n- Don't over-mock","status":"open","priority":2,"issue_type":"feature","created_at":"2025-11-30T22:02:28.421919099-05:00","updated_at":"2025-11-30T22:02:28.421919099-05:00","comments":[{"id":48,"issue_id":"bujo-0c3","author":"andy","text":"## Child Tasks (52 files)\n\n### P1 - Critical (\u003c 20% coverage) - 8 tasks\n- bujo-cuv: utilities/diagnostics.rb (8%)\n- bujo-syo: components/week_column.rb (15%)\n- bujo-dx4: pages/all.rb (16%)\n- bujo-s5o: pages/year_at_glance_base.rb (17%)\n- bujo-79s: components/day_header.rb (18%)\n- bujo-33n: pages/tracker_example.rb (19%)\n- bujo-7ti: components/top_navigation.rb (19%)\n- bujo-y8v: dsl/builder.rb (19%)\n\n### P2 - High (20-40% coverage) - 30 tasks\n### P3 - Medium (40-50% coverage) - 14 tasks\n\nRun `bd list --status=open | grep \"Add tests for\"` to see all tasks.","created_at":"2025-12-01T03:07:16Z"}]}
{"id":"bujo-0cb","title":"Add tests for pages/collection_page.rb (41% coverage)","description":"File: lib/bujo_pdf/pages/collection_page.rb\nCurrent coverage: 41.38% (17 uncovered lines)\nTarget: 70%+","status":"open","priority":3,"issue_type":"chore","created_at":"2025-11-30T22:03:52.814110031-05:00","updated_at":"2025-11-30T22:03:52.814110031-05:00"}
{"id":"bujo-0em","title":"Add tests for pages/year_wheel.rb (26% coverage)","description":"File: lib/bujo_pdf/pages/year_wheel.rb\nCurrent coverage: 26.15% (96 uncovered lines)\nTarget: 70%+","status":"open","priority":2,"issue_type":"chore","created_at":"2025-11-30T22:03:10.343306716-05:00","updated_at":"2025-11-30T22:03:10.343306716-05:00"}
{"id":"bujo-0it","title":"Migrate PlannerGenerator to use page verbs instead of direct context creation","description":"The page verb system (index_pages, future_log_pages, etc.) now uses page_set DSL for proper footers. However, PlannerGenerator still creates contexts directly and bypasses the verbs.\n\nMigrate PlannerGenerator to use the Mixin verbs:\n- Include page Mixins in PlannerGenerator\n- Replace generate_index_pages with index_pages verb\n- Replace generate_future_log_pages with future_log_pages verb\n- Update any other direct page generation to use verbs\n\nBenefits:\n- Footers will appear via draw_set_label\n- Single source of truth for page generation\n- Cleaner, more declarative planner generation","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-29T20:43:41.332835803-05:00","updated_at":"2025-11-29T21:05:19.640347399-05:00","closed_at":"2025-11-29T21:05:19.640347399-05:00"}
{"id":"bujo-0s6","title":"Archive history folder proposals to doc/decisions with disposition notes","description":"Move the two proposal files from history/ to doc/decisions/ with disposition notes:\n\n**Files to process:**\n1. `history/page-dsl-proposal.md` - Page Definition DSL (Layout DSL)\n   - **Status:** NOT integrated\n   - **Note:** Already documented in `doc/decisions/layout-dsl-removed.md` - this proposal led to implementation that was later removed\n   - **Action:** Move to doc/decisions/ and add header noting it was implemented then removed\n\n2. `history/pdf-dsl-proposal.md` - PDF Definition DSL  \n   - **Status:** INTEGRATED and in active use\n   - **Evidence:** `lib/bujo_pdf/pdf_dsl/` directory and `lib/bujo_pdf/pdfs/standard_planner.rb`\n   - **Action:** Move to doc/decisions/ and add header noting successful integration\n\n**After moving:**\n- Delete the empty history/ folder\n- Ensure each file has clear 'Status' and 'Disposition' headers","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-11-30T15:23:44.289651683-05:00","updated_at":"2025-11-30T15:50:18.251462848-05:00","closed_at":"2025-11-30T15:50:18.251462848-05:00","close_reason":"Moved page-dsl-proposal.md (NOT INTEGRATED) and pdf-dsl-proposal.md (INTEGRATED) to doc/decisions/ with status headers. Removed empty history/ folder. Commit 458b05f."}
{"id":"bujo-144","title":"Update documentation after test coverage epic","description":"## Objective\nComprehensive documentation update after completing test coverage improvements and other recent changes.\n\n## Scope\n\n### README updates\n- Remove explicit test coverage percentages/results (they change too frequently)\n- Keep: how to run tests, coverage goals, testing philosophy\n- Update any outdated sections reflecting recent architecture changes\n\n### Architecture documentation\n- Review and update CLAUDE.md architecture sections\n- Document any new patterns introduced during test coverage work\n- Update component descriptions if behavior changed\n\n### Component documentation\n- Ensure component verb system is accurately documented\n- Update any component interfaces that changed\n- Document new components if any were added\n\n## Guidelines\n- Focus on accuracy over comprehensiveness\n- Remove stale/outdated information\n- Keep docs maintainable (avoid content that requires frequent updates)","status":"open","priority":2,"issue_type":"chore","created_at":"2025-11-30T22:30:46.385167175-05:00","updated_at":"2025-11-30T22:30:46.385167175-05:00","dependencies":[{"issue_id":"bujo-144","depends_on_id":"bujo-0c3","type":"blocks","created_at":"2025-11-30T22:30:51.010782205-05:00","created_by":"daemon"}]}
{"id":"bujo-1k4","title":"Embed page thumbnail previews in PDF","description":"Add capability to generate thumbnail-sized images of pages and embed them within the PDF itself.\n\n**Use case**: Navigation aids, page previews, visual table of contents\n\n**Technical approach**:\n- Render page to temporary single-page PDF\n- Convert to PNG using pdftoppm or similar\n- Scale down to thumbnail size\n- Embed as image in target page\n\n**Considerations**:\n- File size impact of embedded images\n- Resolution/quality tradeoffs\n- Which pages need thumbnails (all? index only?)\n- Caching during generation to avoid re-rendering","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-30T19:23:24.510623806-05:00","updated_at":"2025-11-30T20:29:09.178734065-05:00","closed_at":"2025-11-30T20:29:09.178734065-05:00","close_reason":"Implemented thumbnail generation and embedding. Two approaches available:\n- generate-thumbnails: More page types, theme support\n- scale-thumbnails: Simpler workflow using existing docs images\nCreated VisualToc page for embedding thumbnails with clickable navigation.","comments":[{"id":42,"issue_id":"bujo-1k4","author":"andy","text":"## Detailed Implementation Plan\n\n### Technical Feasibility: HIGH\n\nAll required tools and dependencies are already available:\n- **Prawn 2.5.0** - Fully supports embedded images via `.image()` method\n- **pdftoppm (Poppler)** - Extremely fast page extraction (~80ms per page)\n- **ImageMagick/convert** - Ready for compression\n- **mini_magick \u0026 RMagick** - Ruby image processing libraries available\n\n### Recommended Approach: Post-Processing\n\nCreate a standalone utility that:\n1. Extracts pages from finished PDF using `pdftoppm`\n2. Compresses to JPEG (80% quality = ~50% size reduction)\n3. Re-embeds thumbnails into PDF using Prawn's `image()` method\n\n**Why post-processing?**\n- No changes to existing generation logic\n- Clean separation of concerns\n- Can toggle on/off easily\n- Thumbnails guaranteed to match final PDF content\n\n### File Size Impact Analysis\n\nCurrent planner: ~7.9 MB (92 pages)\n\n- **Thumbnail (150 DPI JPEG, 80% quality)**: ~10 KB each\n- **Index pages only (4 pages)**: +40 KB total → 7.94 MB (+0.5%)\n- **All pages (worst case)**: +920 KB → 8.8 MB (+11%)\n- **Realistic use (9 thumbnails)**: +90 KB → 7.99 MB (+1%)\n\n**Conclusion**: Negligible impact for realistic use cases.\n\n### Key Prawn Methods Needed\n\n```ruby\npdf.image(filename, options = {})\n  # Options: at: [x, y], width: pixels, height: pixels\n  # fit: [w, h], scale: ratio\n```\n\n### Implementation Phases\n\n**Phase 1 (4-6 hours): Core post-processing tool**\n- Create `ThumbnailEmbedder` utility class in `lib/bujo_pdf/utilities/`\n- Build `bin/add-thumbnails` CLI command\n- Test extraction, compression, embedding\n- First use case: Index pages (minimal file size impact, high user value)\n\n**Phase 2 (2-3 hours): Build integration**\n- Add `--with-thumbnails` flag to main CLI\n- Modify `PdfBuilder` to call embedder if requested\n- Configuration options for quality/DPI/pages\n\n**Phase 3 (optional): Native component**\n- Create `ThumbnailGrid` component for in-PDF preview galleries\n- Caching system for performance\n- Parallel extraction with threading\n\n### Format and Quality Recommendations\n\n- **Format**: JPEG (70-80% smaller than PNG at same quality)\n- **Quality**: 80% (excellent visual quality, ~50% file reduction)\n- **Resolution**: 150 DPI (perfect for tablets/e-readers)\n- **PNG fallback**: For thumbnails requiring transparency\n\n### Dependencies\n\n```ruby\n# Gemfile (already present)\ngem 'mini_magick'  # Ruby wrapper for ImageMagick\n```\n\nExternal tools:\n- `pdftoppm` (poppler-utils package)\n- `convert` (imagemagick package)","created_at":"2025-12-01T00:32:55Z"},{"id":46,"issue_id":"bujo-1k4","author":"andy","text":"Created bin/generate-thumbnails to render page types as thumbnail PNGs.\n- Generates 13 page types at configurable size (default 80px)\n- Outputs to assets/thumbnails/\n\nCommit: 57312ed\n\nNext step: Create a visual TOC page component that embeds these thumbnails.","created_at":"2025-12-01T01:27:26Z"},{"id":47,"issue_id":"bujo-1k4","author":"andy","text":"Added two approaches for thumbnail embedding:\n\n1. bin/generate-thumbnails - Renders page types in isolation (13 types, theme support)\n2. bin/scale-thumbnails - Scales existing docs/*.png images (simpler, faster)\n\nCreated lib/bujo_pdf/pages/visual_toc.rb - Page that embeds thumbnails with clickable links.\n\nCommits: 57312ed, 2c2d08e\n\nThe scale-thumbnails approach is simpler and produces smaller files by reusing generate-samples output.","created_at":"2025-12-01T01:29:04Z"}]}
{"id":"bujo-1k7","title":"Add tests for components/fieldset.rb (24% coverage)","description":"File: lib/bujo_pdf/components/fieldset.rb\nCurrent coverage: 23.64% (84 uncovered lines)\nTarget: 70%+","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-11-30T22:02:56.862444734-05:00","updated_at":"2025-11-30T22:58:49.121944744-05:00","closed_at":"2025-11-30T22:58:49.121944744-05:00","close_reason":"99% coverage achieved (target 70%). Added 41 tests covering DEFAULTS, POSITION_CONFIG, initialization, all 5 render positions, private methods, and mixin."}
{"id":"bujo-1my","title":"PDF DSL Phase 3: Recipe Registry","description":"Build the named recipe system for reusable PDF configurations.\n\nCore API:\n```ruby\nBujoPdf.define_pdf :standard_planner do |year:, theme: :light|\n  # ... page declarations\nend\n\nBujoPdf.generate :standard_planner, year: 2025, theme: :earth\n```\n\nFeatures:\n- Named recipe storage (@recipes hash)\n- Parameterized recipes with defaults\n- Inline generation (block without name)\n- Recipe composition (include_recipe)\n\nRecipe composition:\n```ruby\nBujoPdf.define_pdf :full_planner do |year:|\n  include_recipe :weekly_essentials, year: year\n  page :reference\nend\n```\n\nDeliverables:\n- Recipe registry implementation\n- BujoPdf.define_pdf and BujoPdf.generate methods\n- include_recipe for composition\n- Tests for recipe definition and invocation","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-29T10:28:35.084102-05:00","updated_at":"2025-11-29T11:43:45.387444-05:00","closed_at":"2025-11-29T11:43:45.387444-05:00","dependencies":[{"issue_id":"bujo-1my","depends_on_id":"bujo-bjl","type":"parent-child","created_at":"2025-11-29T10:30:44.544385-05:00","created_by":"daemon"},{"issue_id":"bujo-1my","depends_on_id":"bujo-zrw","type":"blocks","created_at":"2025-11-29T10:30:44.559103-05:00","created_by":"daemon"}],"comments":[{"id":1,"issue_id":"bujo-1my","author":"andy","text":"Commit 518cfb7: Implemented PDF DSL Phase 3 Recipe Registry\n\nAdded:\n- include_recipe method for recipe composition\n- Comprehensive tests for recipe definition and composition\n- Nested recipe inclusion support\n- Parameter passing through recipe chain\n\nTests: 13 tests, 29 assertions all passing\nTotal tests: 324 tests, 3140 assertions","created_at":"2025-11-30T19:04:05Z"}]}
{"id":"bujo-1sc","title":"Evaluated local coordinate translation for nested regions - decided against","description":"## Context\n\nExplored whether to add coordinate space translation for reusable components. The idea: define a component (e.g., H1 + 5-line todo list) as if at origin (0,0), then place it at various positions via containers that handle translation.\n\n## Current System\n\n- Global grid coordinate system (43×55)\n- Components receive absolute grid positions (col, row, width, height)\n- `divide_grid`, `divide_columns`, `divide_rows` return cells with absolute positions\n- No automatic translation - components can draw anywhere\n\n## Proposed Alternative\n\nA `Region` class that:\n- Knows its absolute position\n- Provides local-to-absolute translation (`region.abs_x(local_col)`)\n- Subdivides into child Regions\n- Enables components to work in local coordinates\n\n## Decision: Keep Absolute Coordinates\n\n**Rejected the Region approach** for these reasons:\n\n1. **Cognitive overhead**: With grid ruler enabled, users think in absolute positions. 'I want something at column 5' maps directly to `ruled_lines(5, ...)`. Nested regions require mental translation: 'I'm in a region at col 5, so local col 3 is really absolute col 8...'\n\n2. **Debugging transparency**: Current system lets you answer 'where is this on the page?' by reading the code. No hidden state or coordinate transformations to trace.\n\n3. **Prawn link annotations**: Already discovered that link annotations require absolute page coordinates even inside bounding_box. Any local coordinate system would need escape hatches.\n\n4. **Actual reuse is limited**: Pages are bespoke enough that we're placing things, not duplicating component logic. The threading of (col, row, width, height) is repetitive but explicit.\n\n5. **YAGNI**: The pain isn't severe enough to justify the abstraction cost.\n\n## Minor Enhancement Considered\n\nIf repetition becomes painful, `Cell` could gain `to_args` to unpack the 4-tuple:\n```ruby\ndraw_foo(*cell.to_args)  # instead of draw_foo(cell.col, cell.row, cell.width, cell.height)\n```\n\nThis is a tiny convenience without hidden coordinate spaces.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-30T08:54:04.864446101-05:00","updated_at":"2025-11-30T08:54:11.689411067-05:00","closed_at":"2025-11-30T08:54:11.689411067-05:00"}
{"id":"bujo-2im","title":"Add tests for components/erase_dots.rb (35% coverage)","description":"File: lib/bujo_pdf/components/erase_dots.rb\nCurrent coverage: 34.62% (17 uncovered lines)\nTarget: 70%+","status":"open","priority":2,"issue_type":"chore","created_at":"2025-11-30T22:03:25.704941369-05:00","updated_at":"2025-11-30T22:03:25.704941369-05:00"}
{"id":"bujo-2md","title":"Add tests for pages/future_log.rb (39% coverage)","description":"File: lib/bujo_pdf/pages/future_log.rb\nCurrent coverage: 38.81% (41 uncovered lines)\nTarget: 70%+","status":"open","priority":2,"issue_type":"chore","created_at":"2025-11-30T22:03:38.891031456-05:00","updated_at":"2025-11-30T22:03:38.891031456-05:00"}
{"id":"bujo-2q7","title":"PDF DSL Phase 1: Core DSL and Builder","description":"Build the core PDF definition infrastructure.\n\nCore classes:\n- PdfDefinition - stores name and block\n- DeclarationContext - collects page declarations during evaluation\n- PageDeclaration - represents a page with type and params\n- GroupDeclaration - represents a page group with options\n- MetadataBuilder - captures PDF metadata\n- PdfBuilder - orchestrates the build process\n\nDSL methods:\n- page(type, **params) - declare a page\n- group(name, **options, \u0026block) - declare a page group\n- metadata(\u0026block) - set PDF metadata\n- theme(name) - set theme\n\nHelper methods:\n- weeks_in(year) - returns Week objects for iteration\n- months_in(year) - returns Month objects\n\nDeliverables:\n- Core class implementations\n- Basic DSL that can declare pages\n- PdfBuilder that renders declared pages using existing page classes\n- Tests for declaration and basic rendering","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-29T10:28:13.461918-05:00","updated_at":"2025-11-29T11:22:45.904521-05:00","closed_at":"2025-11-29T11:22:45.904521-05:00","dependencies":[{"issue_id":"bujo-2q7","depends_on_id":"bujo-bjl","type":"parent-child","created_at":"2025-11-29T10:28:25.233329-05:00","created_by":"daemon"}],"comments":[{"id":2,"issue_id":"bujo-2q7","author":"andy","text":"Implementation complete in commits e318d0d and 4ab43ef. Core classes: PdfDefinition, DeclarationContext, PageDeclaration, GroupDeclaration, MetadataBuilder, Week, Month, PdfBuilder. DSL methods for page/group/metadata/theme declaration. Iteration helpers weeks_in/months_in. 52 unit tests passing. Build process: definition evaluation -\u003e page declaration collection -\u003e sequential page rendering using existing PageFactory.","created_at":"2025-11-30T19:04:05Z"}]}
{"id":"bujo-32o","title":"Add tests for pages/quarterly_planning.rb (36% coverage)","description":"File: lib/bujo_pdf/pages/quarterly_planning.rb\nCurrent coverage: 35.79% (61 uncovered lines)\nTarget: 70%+","status":"open","priority":2,"issue_type":"chore","created_at":"2025-11-30T22:03:37.296380419-05:00","updated_at":"2025-11-30T22:03:37.296380419-05:00"}
{"id":"bujo-33n","title":"Add tests for pages/tracker_example.rb (19% coverage)","description":"File: lib/bujo_pdf/pages/tracker_example.rb\nCurrent coverage: 18.63% (83 uncovered lines)\nTarget: 70%+","status":"closed","priority":1,"issue_type":"chore","created_at":"2025-11-30T22:02:42.259163083-05:00","updated_at":"2025-11-30T22:40:22.424623916-05:00","closed_at":"2025-11-30T22:40:22.424623916-05:00","close_reason":"Added 19 tests achieving 100% coverage"}
{"id":"bujo-3c6","title":"Explore integrating Layout DSL with PDF DSL system","description":"The codebase has two separate DSL systems:\n- lib/bujo_pdf/dsl/ - Layout DSL for page-level layout (experimental, not integrated)\n- lib/bujo_pdf/pdf_dsl/ - PDF Definition DSL for document assembly (actively used)\n\nThey serve different purposes (orthogonal). The Layout DSL could eventually replace the component verb system for building pages.\n\nTasks:\n- Review what the Layout DSL provides (LayoutNode, ContainerNode, etc.)\n- Determine if/how it should integrate with the PDF DSL\n- Consider whether pages should use Layout DSL instead of component verbs","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-30T14:26:48.208041015-05:00","updated_at":"2025-11-30T14:42:52.74183746-05:00","closed_at":"2025-11-30T14:42:52.74183746-05:00","close_reason":"Decided against integration. The Layout DSL solves automatic flex-based layout computation, but the current global (col, row) coordinate system is simpler to reason about for fixed-grid PDF layouts. The explicit coordinate approach is visually debuggable, grid-aligned by default, and matches how humans think about planner page design. Not worth the abstraction cost for problems we don't have."}
{"id":"bujo-3g0","title":"CollectionPage: use hline verb instead of direct Prawn","description":"Replace pdf.stroke_line with hline() verb in collection_page.rb.\n\nFile: lib/bujo_pdf/pages/collection_page.rb\n\nPart of component architecture refactoring - Phase 2.","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-11-30T21:24:04.909398671-05:00","updated_at":"2025-11-30T21:31:35.026079377-05:00","closed_at":"2025-11-30T21:31:35.026079377-05:00","close_reason":"Closed"}
{"id":"bujo-3l5","title":"Replace inline YAML loading with CollectionsConfiguration class","description":"standard_planner.rb (lines 134-153) has inline YAML loading that duplicates what CollectionsConfiguration already does.\n\nThe class provides:\n- Auto-generation of ID from title\n- Consistent symbol keys\n- any? and count helpers\n\nFix: Replace inline code with:\n  config = CollectionsConfiguration.new('config/collections.yml')\n  config.collections.each do |collection|\n    page :collection, id: :\"collection_\\#{collection[:id]}\", ...\n  end\n\nFiles:\n- lib/bujo_pdf/collections_configuration.rb (existing class)\n- lib/bujo_pdf/pdf_dsl/recipes/standard_planner.rb (needs update)","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-11-30T14:26:48.504222739-05:00","updated_at":"2025-11-30T14:53:26.573334722-05:00","closed_at":"2025-11-30T14:53:26.573334722-05:00","close_reason":"Closed"}
{"id":"bujo-3ob","title":"Standardize component architecture with explicit kwargs","description":"Unify all components under Base::Component with Canvas + explicit kwargs.\n\n## Goal\n1. Introduce Canvas value object to bundle pdf + grid\n2. All 22 components inherit from Base::Component\n3. Components receive canvas: + explicit kwargs (no **options bag)\n4. Delete SubComponentBase\n\n## Architecture\n```\nDocument → Page → Canvas → Components\n                    ↓\n            wraps pdf + grid\n            (+ future grid renderers)\n```\n\n## Current State\n- 5 components use Base::Component (with **options)\n- 3 components use SubComponentBase (render_at pattern)\n- 14 standalone components (no base class)\n\n## Phases\n0. Create Canvas class (bujo-nij)\n1. Update Base::Component to use canvas: (bujo-auv)\n2. Migrate existing Base::Component users (bujo-q0s)\n3. Migrate SubComponentBase users (bujo-vuc)\n4. Migrate standalone components (bujo-8hj)\n5. Delete SubComponentBase (bujo-dvb)\n\nSee plan: ~/.claude/plans/binary-snacking-pie.md","status":"blocked","priority":2,"issue_type":"feature","created_at":"2025-11-30T15:34:13.124510122-05:00","updated_at":"2025-11-30T15:55:29.446737017-05:00"}
{"id":"bujo-3pp","title":"TodoList component for configurable to-do lists","description":"## Overview\n\nCreate a grid-based TodoList component that renders configurable to-do lists for bullet journal pages. The component follows the same grid-based sizing philosophy as other components (WeekGrid, Fieldset).\n\n## Grid-based Dimensions\n\n- **Width**: N box columns (configurable)\n- **Height**: M box rows, one row per to-do item (configurable)\n\n## Structure\n\n- **Column 1 (1 box wide)**: Bullet/checkbox area - centered marker\n- **Columns 2-N**: Item text area (empty space for handwriting)\n\n## Configurable Elements\n\n### 1. Bullet Style (`:bullet_style`)\n\nControls what appears in the first column of each row:\n\n- `:bullet` - Bullet Journal style dot (larger than grid dots, darker/bolder color for visual differentiation)\n- `:checkbox` - Empty square for checking off\n- `:circle` - Open circle\n- Future consideration: custom icons\n\n### 2. Row Dividers (`:divider`)\n\nOptional horizontal lines separating to-do rows:\n\n- `:none` - No dividers (default)\n- `:solid` - Solid line along bottom of each row\n- `:dashed` - Dashed line along bottom of each row\n\n### 3. Divider Color (`:divider_color`)\n\n- Configurable hex color string\n- Default: `COLOR_BORDERS` ('E5E5E5') or similar muted gray\n\n## Proposed API\n\n```ruby\n# Basic usage\ngrid.todo_list(col, row, width: 20, rows: 8)\n\n# Full options\ngrid.todo_list(col, row,\n               width: 20,           # box columns wide\n               rows: 8,             # number of to-do items\n               bullet_style: :bullet,\n               divider: :dashed,\n               divider_color: 'E5E5E5')\n```\n\n## Implementation Notes\n\n- Bullet dots should be noticeably larger than the 1pt dot grid dots (maybe 2-3pt)\n- Bullet color should be darker/more prominent than grid dots (maybe black or dark gray vs light gray)\n- Row height is 1 box (DOT_SPACING) per item\n- Component should work with the existing grid helper pattern (`grid.todo_list(...)`)\n\n## Design Philosophy\n\nThis component enables:\n- Big to-do lists or small to-do lists\n- Multiple to-do lists on a single page\n- Consistent visual language across the planner\n- Easy composition with other components\n\n## Future Extensions\n\n- HabitTracker component (similar grid structure but with icon columns for tracking habits with symbols like water bottles, hearts, checkmarks)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-29T11:13:33.066452-05:00","updated_at":"2025-11-29T12:16:49.863928-05:00","closed_at":"2025-11-29T12:16:49.863928-05:00","comments":[{"id":3,"issue_id":"bujo-3pp","author":"andy","text":"Commit be34614: Implemented TodoList component with bullet/checkbox/circle styles, optional row dividers, and grid helper integration. All 23 tests passing.","created_at":"2025-11-30T19:04:05Z"}]}
{"id":"bujo-3vn","title":"Add tests for components/daily_section.rb (26% coverage)","description":"File: lib/bujo_pdf/components/daily_section.rb\nCurrent coverage: 25.64% (29 uncovered lines)\nTarget: 70%+","status":"open","priority":2,"issue_type":"chore","created_at":"2025-11-30T22:03:09.369434879-05:00","updated_at":"2025-11-30T22:03:09.369434879-05:00"}
{"id":"bujo-3xu","title":"Add pt_* positioning params to VLine component","description":"Add pt_x:, pt_y:, pt_height: parameters to enable pixel-precise line positioning (like Text already has).\n\nFile: lib/bujo_pdf/components/vline.rb\n\nSame pattern as HLine enhancement.\n\nPart of component architecture refactoring - Phase 1.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-11-30T21:24:04.799001293-05:00","updated_at":"2025-11-30T21:26:21.994903779-05:00","closed_at":"2025-11-30T21:26:21.994903779-05:00","close_reason":"Closed"}
{"id":"bujo-49m","title":"Rename pdf_dsl/ to dsl/ and simplify file names","description":"Rename and simplify the PDF DSL directory structure.\n\nDirectory rename:\n- `lib/bujo_pdf/pdf_dsl/` → `lib/bujo_pdf/dsl/`\n\nFile renames within dsl/:\n- `pdf_definition.rb` → `definition.rb`\n- `declaration_context.rb` → `context.rb`\n- `pdf_builder.rb` → `builder.rb`\n- `link_registry.rb` → `registry.rb`\n- `metadata_builder.rb` → `metadata.rb`\n- `outline_declaration.rb` → `outline.rb`\n\nConsolidations:\n- Merge `inline_page_context.rb` + `inline_page_declaration.rb` → `inline_page.rb`\n- Consolidate root `week.rb` with `dsl/week.rb`\n\nTasks:\n1. `git mv lib/bujo_pdf/pdf_dsl lib/bujo_pdf/dsl`\n2. Rename files to simpler names\n3. Update `lib/bujo_pdf/pdf_dsl.rb` path references (keep this file name for now)\n4. Update internal require_relative statements\n5. Move test files in test/unit/pdf_dsl/ to test/unit/dsl/\n6. Run tests\n\nPart of DSL reorganization plan.","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-11-30T15:08:30.225976647-05:00","updated_at":"2025-11-30T15:34:54.291457821-05:00","closed_at":"2025-11-30T15:34:54.291457821-05:00","close_reason":"Renamed pdf_dsl/ to dsl/, simplified file names, consolidated inline_page files. Tests pass. Commit cc8bd28."}
{"id":"bujo-4cu","title":"Add tests for base/component.rb (48% coverage)","description":"File: lib/bujo_pdf/base/component.rb\nCurrent coverage: 48.0% (26 uncovered lines)\nTarget: 70%+","status":"open","priority":3,"issue_type":"chore","created_at":"2025-11-30T22:04:02.39642211-05:00","updated_at":"2025-11-30T22:04:02.39642211-05:00"}
{"id":"bujo-4db","title":"Add tests for calendars/ical_parser.rb (21% coverage)","description":"File: lib/bujo_pdf/dsl/configuration/calendars/ical_parser.rb\nCurrent coverage: 21.13% (56 uncovered lines)\nTarget: 70%+","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-11-30T22:02:55.577255434-05:00","updated_at":"2025-11-30T22:52:14.572281865-05:00","closed_at":"2025-11-30T22:52:14.572281865-05:00","close_reason":"86% coverage achieved (target 70%). Added 27 tests covering initialization, parsing, all-day events, multi-day events, year filtering, exclude patterns, recurring events, and error handling. Fixed bugs in year filtering and exception handling."}
{"id":"bujo-4dk","title":"Add rotation parameter to Text component","description":"Add optional rotation: parameter to Text component supporting 90, -90, and 0 (default).\n\n**Implementation:**\n1. Add @rotation instance variable to Text#initialize\n2. Add rotation: parameter to Text::Mixin#text verb\n3. Add render_rotated private method that:\n   - Calculates center point for rotation origin\n   - Wraps text rendering in @pdf.rotate(@rotation, origin: [x, y])\n4. Modify render to call render_rotated when @rotation != 0\n5. Disable dot erasure for rotated text (not needed for label use cases)\n\n**Files:**\n- lib/bujo_pdf/components/text.rb\n\n**Acceptance:** text(5, 10, 'Label', rotation: -90) renders vertical text reading top-to-bottom","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-11-30T15:20:08.855740607-05:00","updated_at":"2025-11-30T15:26:17.330821081-05:00","closed_at":"2025-11-30T15:26:17.330821081-05:00","close_reason":"Implemented rotation parameter for Text component. Tested with -90, 90, and 0 degrees. Commit a9562fb."}
{"id":"bujo-4p9","title":"Add tests for pages/multi_year_overview.rb (35% coverage)","description":"File: lib/bujo_pdf/pages/multi_year_overview.rb\nCurrent coverage: 34.67% (49 uncovered lines)\nTarget: 70%+","status":"open","priority":2,"issue_type":"chore","created_at":"2025-11-30T22:03:26.013922866-05:00","updated_at":"2025-11-30T22:03:26.013922866-05:00"}
{"id":"bujo-4u7","title":"Add tests for pages/reference_calibration.rb (22% coverage)","description":"File: lib/bujo_pdf/pages/reference_calibration.rb\nCurrent coverage: 21.59% (69 uncovered lines)\nTarget: 70%+","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-11-30T22:02:55.869924851-05:00","updated_at":"2025-11-30T22:53:52.461805742-05:00","closed_at":"2025-11-30T22:53:52.461805742-05:00","close_reason":"100% coverage achieved (target 70%). Added 17 tests covering page registration, setup, render, calibration elements, mixin, and integration."}
{"id":"bujo-4x4","title":"Component isolation rendering for visual testing","description":"Create tooling to render specific components in isolation with different parameter variations, producing trimmed PNG output.\n\n**Use case**: Visual testing, documentation, debugging component rendering\n\n**Technical approach**:\n1. Render component(s) to single-page PDF\n2. Convert PDF to PNG (pdftoppm)\n3. Trim blank space (ImageMagick convert -trim or similar)\n4. Output final isolated PNG\n\n**Features**:\n- Accept component class + params as input\n- Support multiple components on same page for comparison\n- Support parameter variations (e.g., render WeekGrid with quantize: true vs false)\n- Optional: composite multiple variations into comparison grid\n\n**Example usage**:\n```bash\nbin/render-component WeekGrid --params 'quantize: true, width: 35' -o week_grid_quantized.png\nbin/render-component WeekGrid --variations 'quantize: [true, false]' -o comparison.png\n```\n\n**Dependencies**:\n- pdftoppm (poppler-utils)\n- ImageMagick for trimming","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-30T19:23:24.603286855-05:00","updated_at":"2025-11-30T20:21:04.479603809-05:00","closed_at":"2025-11-30T20:21:04.479603809-05:00","close_reason":"Component isolation rendering tool completed. See bin/render-component --help for usage.","comments":[{"id":43,"issue_id":"bujo-4x4","author":"andy","text":"## Detailed Implementation Plan\n\n### Component Architecture Summary\n\nAll components follow a consistent instantiation pattern:\n\n```ruby\ncomponent = MyComponent.new(\n  canvas:   # Canvas value object (required)\n  col:      # Starting column (0-43)\n  row:      # Starting row (0-55)  \n  width:    # Width in grid boxes\n  height:   # Height in grid boxes\n  # ... component-specific parameters\n)\ncomponent.render\n```\n\nThe `Canvas` class wraps both `Prawn::Document` and `GridSystem`, providing all dependencies components need.\n\n### Component Categories\n\n**Category A: Simple Primitives**\n- GridDots, RuledLines, Box, H1, H2, Text\n- Straightforward constructor with grid coordinates\n\n**Category B: Composite Components**\n- Fieldset, WeekColumn\n- Use internal components but still take grid coordinates\n\n**Category C: Context-Dependent**\n- DailySection, WeekSidebar\n- Require dates, configuration, or other runtime context\n\n### Implementation Phases\n\n**Phase 1: Core Script (`bin/render-component`)**\n\nCreate a CLI tool that:\n1. Takes component name + parameters\n2. Creates minimal Canvas (Prawn document + GridSystem)\n3. Renders optional reference grid for context\n4. Renders the component\n5. Saves PDF\n\n```bash\n# Usage examples\nbin/render-component grid_dots --col 5 --row 10 --width 20 --height 15\nbin/render-component box --col 2 --row 5 --fill EEEEEE --stroke CCCCCC\nbin/render-component fieldset --legend Winter --position top_left\n```\n\n**Phase 2: PNG Pipeline**\n\nAdd extraction and trimming:\n\n```bash\n# Extract page to PNG\npdftoppm -png -r 150 -f 1 -l 1 -singlefile component.pdf output\n\n# Trim whitespace\nconvert output.png -trim +repage output.png\n```\n\nIntegrate into script with `--png` flag:\n```bash\nbin/render-component box --fill EEEEEE --png -o box_filled.png\n```\n\n**Phase 3: Parameter Variations**\n\nSupport rendering multiple variations:\n\n```bash\nbin/render-component box \\\n  --variations 'fill: [EEEEEE, DDDDDD, CCCCCC]' \\\n  --grid 1x3 \\\n  -o box_variations.png\n```\n\n**Phase 4: Comparison Mode**\n\nSide-by-side rendering for regression testing:\n\n```bash\nbin/render-component fieldset \\\n  --compare 'position: [top_left, top_right, bottom_left, bottom_right]' \\\n  --grid 2x2 \\\n  -o fieldset_positions.png\n```\n\n### CLI Interface Design\n\n```\nUsage: bin/render-component COMPONENT [OPTIONS]\n\nComponents:\n  grid_dots, ruled_lines, box, h1, h2, text, fieldset, week_column\n\nGrid Options:\n  --col COL          Starting column (default: 5)\n  --row ROW          Starting row (default: 10)\n  --width WIDTH      Width in boxes (default: 20)\n  --height HEIGHT    Height in boxes (default: 15)\n\nOutput Options:\n  -o, --output FILE  Output file (PDF or PNG based on extension)\n  --png              Force PNG output with trimming\n  --dpi DPI          PNG resolution (default: 150)\n  --no-trim          Don't trim whitespace from PNG\n  --reference-grid   Show light reference grid lines\n\nComponent-Specific:\n  --color COLOR      Primary color (hex)\n  --fill COLOR       Fill color\n  --stroke COLOR     Stroke/border color\n  --content TEXT     Text content\n  --legend TEXT      Fieldset legend\n  --position POS     Position enum (top_left, etc.)\n```\n\n### Key Technical Considerations\n\n**Coordinate System:**\n- Grid coordinates: Row 0 = top, increases downward\n- Prawn coordinates: (0,0) = bottom-left, Y increases upward\n- GridSystem handles conversion via `grid.y(row)`\n\n**Z-Index/Layering:**\n- Some components (RuledLines) manage z-index by redrawing dots on top\n- Reference grid should render first (background)\n\n**Theme Colors:**\n- Components use `Themes.current[:colors]` if color not specified\n- Consider `--theme` flag for testing different themes\n\n### External Dependencies\n\n```bash\n# Required for PNG extraction\napt install poppler-utils  # pdftoppm\n\n# Required for trimming\napt install imagemagick    # convert\n```\n\n### File Structure\n\n```\nlib/bujo_pdf/\n  utilities/\n    component_renderer.rb    # Core rendering logic\nbin/\n  render-component           # CLI executable\n```","created_at":"2025-12-01T00:33:01Z"},{"id":44,"issue_id":"bujo-4x4","author":"andy","text":"## Future Use Cases\n\n**If this goes well, planned integrations:**\n\n1. **CLAUDE.md integration** - Document component rendering as standard testing approach for visual verification during development\n\n2. **README documentation** - Generate component preview images for the main README\n\n3. **COMPONENTS.md** - Create comprehensive component documentation with:\n   - Visual examples of each component\n   - Parameter variations shown side-by-side\n   - Code snippets paired with rendered output\n   - Could be auto-generated from component metadata\n\nThis makes the tool not just a debugging aid but part of the documentation pipeline.","created_at":"2025-12-01T00:33:53Z"},{"id":45,"issue_id":"bujo-4x4","author":"andy","text":"Implemented bin/render-component tool. Features:\n- Renders 12 components in isolation with configurable parameters\n- Supports parameter variations for comparison rendering\n- Options: --theme, --no-trim, --no-grid, --dpi\n- Uses pdftoppm (PDF-\u003ePNG) and ImageMagick (trim whitespace)\n\nCommit: a809376\n\nFixed a bug in Fieldset component (used :border instead of :borders key).","created_at":"2025-12-01T01:21:00Z"}]}
{"id":"bujo-59z","title":"Add Future Log tab to right sidebar navigation","description":"## Summary\nAdd a new navigation tab to the right sidebar that links to the Future Log pages.\n\n## Current State\n- Right sidebar has tabs: Year, Events, Highlights, Multi, Grids\n- Future Log has 2 pages: `future_log_1` (months 1-6) and `future_log_2` (months 7-12)\n- No navigation link to Future Log from weekly pages\n\n## Requirements\n1. Add \"Future\" tab to right sidebar (position TBD - likely after Year or near Index)\n2. Default destination: `future_log_1`\n3. Week-appropriate behavior: Link to relevant future log page based on current week\n   - Weeks 1-26 (H1): Link to `future_log_1`\n   - Weeks 27-52 (H2): Link to `future_log_2`\n4. Consider multi-tap cycling (like Grids tab) to allow navigating between both pages\n\n## Implementation\n- Modify `StandardWithSidebarsLayout#build_top_tabs` to add the new tab\n- Pass current week number to layout for context-aware destination\n- Use cyclic destination array: `[:future_log_1, :future_log_2]`\n\n## Files to modify\n- `lib/bujo_pdf/layouts/standard_with_sidebars_layout.rb`","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-30T16:47:58.210952299-05:00","updated_at":"2025-11-30T17:26:59.700119086-05:00","closed_at":"2025-11-30T17:26:59.700119086-05:00","close_reason":"Added Future tab with cyclic navigation between future_log_1 and future_log_2. Tab appears in right sidebar between Year and Events. Uses existing multi-tap cycling infrastructure."}
{"id":"bujo-5cm","title":"Add tests for pages/daily_wheel.rb (29% coverage)","description":"File: lib/bujo_pdf/pages/daily_wheel.rb\nCurrent coverage: 29.13% (73 uncovered lines)\nTarget: 70%+","status":"open","priority":2,"issue_type":"chore","created_at":"2025-11-30T22:03:24.012260725-05:00","updated_at":"2025-11-30T22:03:24.012260725-05:00"}
{"id":"bujo-5e1","title":"Page Definition DSL","description":"A declarative DSL for defining page layouts that abstracts away Prawn internals while preserving full flexibility. Page definitions become composable, testable, and readable specifications rather than imperative drawing code.\n\n## Current State\n\nPages are Ruby classes that directly manipulate Prawn. This couples layout logic to rendering, making pages harder to compose, test, and extend.\n\n## Proposed DSL\n\nLayout primitives:\n- Containers: sidebar, header, footer, section, columns, rows, grid\n- Content: text, field, dot_grid, graph_grid\n- Navigation: nav_link, nav_group\n\nFlex layout for proportional sizing. Styles/themes referenced by name.\n\n## Implementation Phases\n\nPhase 1: Layout Engine - Build layout tree that computes bounding boxes\nPhase 2: Component Registry - Define and instantiate reusable components\nPhase 3: Style Resolution - CSS-like cascading styles\n\n## Migration Path\n\n1. Build DSL alongside existing page classes\n2. Reimplement one simple page using DSL\n3. Validate output matches\n4. Gradually migrate remaining pages\n\n## Benefits\n\n- Readability: Page structure immediately apparent\n- Testability: Layout logic separable from rendering\n- Extensibility: Users define custom pages without Prawn knowledge\n- Consistency: Shared primitives enforce design system\n\nFull proposal in history/page-dsl-proposal.md","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-11-29T10:23:27.504424-05:00","updated_at":"2025-11-29T12:00:45.356489-05:00","closed_at":"2025-11-29T12:00:45.356489-05:00","comments":[{"id":4,"issue_id":"bujo-5e1","author":"andy","text":"DESIGN CONSTRAINT: Grid-centric positioning\n\nThe DSL should keep the 43x55 grid as the central mental model, not abstract it away.\n\nKey principles:\n- Bounds and positions should be expressed in grid units by default\n- Quantization to grid is preferred (align to dot grid intersections)\n- Vertical/horizontal packing (flex) is fine for flow within a region\n- Proportional splits allowed when needed (e.g., 7 day columns in 35 boxes)\n- But the grid remains the foundation, not an implementation detail\n\nExample - grid units, not abstract flex:\n```ruby\nsidebar width: 3          # 3 grid boxes, not 'narrow'\nsection :daily, height: 10  # 10 grid rows\ncolumns 7, width: 35      # 35 boxes / 7 = 5 boxes each (quantized)\n```\n\nThe DSL makes grid math easier - it doesn't replace grid thinking.","created_at":"2025-11-30T19:04:05Z"},{"id":5,"issue_id":"bujo-5e1","author":"andy","text":"DESIGN DECISIONS from discussion:\n\n**Gap units**: Sub-grid gaps (like 0.5) are intentional deviations for design reasons - text stacking in nav doesn't fit box quantization. Conscious choice, not inconsistency.\n\n**Flex quantization**: Quantize and give extra box to one side. Simple rule, no fractional boxes.\n\n**Layout helpers needed**:\n- Column packing / row packing\n- Quantized vs proportional split\n- Box-based positioning\n\n**Page IDs for linking**: Generate from:\n- Page type\n- Date granularity (year, year+month, or full date)\n- Incremental ID for repeats with same type+date params\n- Allow explicit name overrides\n\n**Layouts persist**: Layouts define navigation chrome (left sidebar, top, right), carve space from grid, page defines content within remaining bounds. Same concept as today, refined syntax.\n\n**Primary user**: Andy. Don't over-engineer for external devs or non-Ruby users.\n\n**Component model**: Nested composition. Components contain components, pages contain components. Library of layout primitives + rendered object primitives that compose.\n\n**Templates**: Often just 'dot grid + title' (future log). Some need new components (monthly review with sections/questions).","created_at":"2025-11-30T19:04:05Z"},{"id":6,"issue_id":"bujo-5e1","author":"andy","text":"IMPLEMENTATION APPROACH: Incremental wrap-then-migrate\n\nWorking software stays working. DSL wraps existing page classes initially, then gradually migrates internals. Clean as we go - no big bang rewrite.\n\nPhase 1 produces a DSL that calls existing page classes. Later phases migrate page internals to DSL-native rendering.","created_at":"2025-11-30T19:04:05Z"}]}
{"id":"bujo-5gi","title":"MiniMonth: use text verb for day headers","description":"Replace direct pdf.text_box calls for weekday headers with text() verb.\n\nFile: lib/bujo_pdf/components/mini_month.rb\n\nPart of component architecture refactoring - Phase 3.","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-11-30T21:24:27.133454356-05:00","updated_at":"2025-11-30T22:04:16.514741794-05:00","closed_at":"2025-11-30T22:04:16.514741794-05:00","close_reason":"Refactored draw_weekday_headers to use text verb. Commit: f82b599"}
{"id":"bujo-5og","title":"Add tests for calendars/event.rb (42% coverage)","description":"File: lib/bujo_pdf/dsl/configuration/calendars/event.rb\nCurrent coverage: 42.31% (15 uncovered lines)\nTarget: 70%+","status":"open","priority":3,"issue_type":"chore","created_at":"2025-11-30T22:03:53.485177383-05:00","updated_at":"2025-11-30T22:03:53.485177383-05:00"}
{"id":"bujo-5po","title":"Refactor weekly page daily section to use WeekGrid","description":"Update lib/bujo_pdf/pages/weekly_page.rb:\n- Replace manual 7-column calculation with WeekGrid\n- Use cell_callback for rendering daily cells\n- Ensure quantized columns align with dot grid\n\nPart of Plan #22 Phase 3","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-13T16:21:15.44189811-05:00","updated_at":"2025-11-13T17:58:02.555946133-05:00","closed_at":"2025-11-13T17:58:02.555946133-05:00","labels":["plan-22","refactoring"],"dependencies":[{"issue_id":"bujo-5po","depends_on_id":"bujo-hu8","type":"blocks","created_at":"2025-11-13T16:22:17.002281946-05:00","created_by":"daemon"}]}
{"id":"bujo-68h","title":"Template and page type expansion","description":"Exploration of new page types and templates for the planner. These could be expressed through a declarative DSL once that exists, or implemented directly using the current component system.\n\nCandidate templates:\n- Index pages (numbered blank pages for TOC)\n- Future log (3-6 month minimal spread)\n- Collections template (titled blank page generator)\n- Monthly review (prompt-based reflection)\n- Quarterly planning (12-week year style)\n- Example tracker spread (show-dont-prescribe approach)\n\nPhilosophy: Keep the core minimal but enable/inspire creation.","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-11-29T10:14:23.82079-05:00","updated_at":"2025-11-29T13:04:09.902568-05:00","closed_at":"2025-11-29T13:04:09.902568-05:00"}
{"id":"bujo-69e","title":"Add tests for components/box.rb (28% coverage)","description":"File: lib/bujo_pdf/components/box.rb\nCurrent coverage: 27.66% (34 uncovered lines)\nTarget: 70%+","status":"open","priority":2,"issue_type":"chore","created_at":"2025-11-30T22:03:10.644181995-05:00","updated_at":"2025-11-30T22:03:10.644181995-05:00"}
{"id":"bujo-6n5","title":"Add tests for components/week_sidebar.rb (24% coverage)","description":"File: lib/bujo_pdf/components/week_sidebar.rb\nCurrent coverage: 23.75% (61 uncovered lines)\nTarget: 70%+","status":"open","priority":2,"issue_type":"chore","created_at":"2025-11-30T22:03:08.823018638-05:00","updated_at":"2025-11-30T22:03:08.823018638-05:00"}
{"id":"bujo-6t0","title":"Plan: Replace PdfDSL with Document DSL","description":"## Context\nThe existing PdfDSL system (~2,600 lines) was never used in production. We've built a powerful verb system via Components::All that pages use for declarative content rendering.\n\n## Goals\n1. Delete PdfDSL - remove unused code\n2. Build DocumentBuilder - clean orchestration DSL\n3. Refactor PlannerGenerator - use DocumentBuilder internally\n\n## Key Design Principle\nClear separation between:\n- **Orchestration** (DocumentBuilder) - declares WHICH pages\n- **Content** (Pages::All verbs) - defines WHAT's drawn on pages\n\n## Target API\n```ruby\nBujoPdf.define_pdf(title: \"Planner 2025\", year: 2025, output: \"planner.pdf\") do\n  index_pages(2)\n  future_log_pages(2)\n  page :seasonal\n  weeks_in(year).each do |week|\n    quarterly_planning_for(week) if week.starts_quarter?\n    page :weekly, week: week\n  end\n  grid_pages\n  template_pages\nend\n```","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-11-29T20:51:36.913385497-05:00","updated_at":"2025-11-30T00:09:41.663287107-05:00","closed_at":"2025-11-30T00:09:41.663287107-05:00","comments":[{"id":7,"issue_id":"bujo-6t0","author":"andy","text":"See bujo-pdf-kd8 for the implementation tasks and dependency tree.","created_at":"2025-11-30T19:04:05Z"}]}
{"id":"bujo-793","title":"Consolidate sub_components into components","description":"Eliminate the separate `sub_components/` directory by moving its contents into `components/`.\n\nCurrent sub_components (4 files):\n- `base.rb` - Abstract base class\n- `fieldset.rb` - HTML-like fieldset boxes with legend labels\n- `week_column.rb` - Week column rendering\n- `day_header.rb` - Day header rendering\n\nTasks:\n1. Move each sub_component file to components/\n2. Change namespace from `SubComponent::` to `BujoPdf::Components::`\n3. Update all references throughout codebase\n4. Update requires in lib/bujo_pdf.rb\n5. Delete empty sub_components/ directory\n6. Consider whether SubComponent::Base functionality merges into Component or becomes a shared module\n\nThe distinction between Component and SubComponent adds complexity without clear benefit.","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-11-30T14:59:58.248081406-05:00","updated_at":"2025-11-30T15:15:06.384745108-05:00","closed_at":"2025-11-30T15:15:06.384745108-05:00","close_reason":"Consolidated sub_components into components namespace. All 4 files moved, references updated, tests passing."}
{"id":"bujo-79s","title":"Add tests for components/day_header.rb (18% coverage)","description":"File: lib/bujo_pdf/components/day_header.rb\nCurrent coverage: 17.74% (51 uncovered lines)\nTarget: 70%+","status":"closed","priority":1,"issue_type":"chore","created_at":"2025-11-30T22:02:41.946446821-05:00","updated_at":"2025-11-30T22:38:39.057784955-05:00","closed_at":"2025-11-30T22:38:39.057784955-05:00","close_reason":"Added 23 tests achieving 100% coverage"}
{"id":"bujo-7nx","title":"Add tests for dsl/configuration/dates.rb (36% coverage)","description":"File: lib/bujo_pdf/dsl/configuration/dates.rb\nCurrent coverage: 35.59% (38 uncovered lines)\nTarget: 70%+","status":"open","priority":2,"issue_type":"chore","created_at":"2025-11-30T22:03:26.338762559-05:00","updated_at":"2025-11-30T22:03:26.338762559-05:00"}
{"id":"bujo-7of","title":"Create RadialLines component for wheel pages","description":"Extract radial line drawing logic from wheel pages.\n\nCreate new component: lib/bujo_pdf/components/radial_lines.rb\n\nFUTURE WORK - Do not implement now.","status":"open","priority":3,"issue_type":"feature","created_at":"2025-11-30T21:24:29.500043026-05:00","updated_at":"2025-11-30T21:24:29.500043026-05:00"}
{"id":"bujo-7ti","title":"Add tests for components/top_navigation.rb (19% coverage)","description":"File: lib/bujo_pdf/components/top_navigation.rb\nCurrent coverage: 19.05% (68 uncovered lines)\nTarget: 70%+","status":"closed","priority":1,"issue_type":"chore","created_at":"2025-11-30T22:02:42.5414707-05:00","updated_at":"2025-11-30T22:42:02.256100488-05:00","closed_at":"2025-11-30T22:42:02.256100488-05:00","close_reason":"Added 21 tests achieving 100% coverage"}
{"id":"bujo-7um","title":"Add tests for pages/seasonal_calendar.rb (37% coverage)","description":"File: lib/bujo_pdf/pages/seasonal_calendar.rb\nCurrent coverage: 36.84% (36 uncovered lines)\nTarget: 70%+","status":"open","priority":2,"issue_type":"chore","created_at":"2025-11-30T22:03:37.85505179-05:00","updated_at":"2025-11-30T22:03:37.85505179-05:00"}
{"id":"bujo-7yv","title":"Add Fieldset verb to Components::All","description":"Add a fieldset() verb so pages can use it directly like other components.\n\n**Implementation:**\n1. Add Fieldset::Mixin module with fieldset(col, row, width, height, legend:, position:, ...) verb\n2. Include Fieldset::Mixin in Components::All\n\n**Files:**\n- lib/bujo_pdf/components/fieldset.rb\n- lib/bujo_pdf/components/all.rb\n\n**Acceptance:** Pages can call fieldset(5, 10, 20, 15, legend: 'Winter', position: :top_left)","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-30T15:20:35.99353927-05:00","updated_at":"2025-11-30T15:46:19.205890607-05:00","closed_at":"2025-11-30T15:46:19.205890607-05:00","close_reason":"Added Fieldset::Mixin with fieldset() verb and included in Components::All. Commit 1545ecb.","dependencies":[{"issue_id":"bujo-7yv","depends_on_id":"bujo-sto","type":"blocks","created_at":"2025-11-30T15:20:42.770806988-05:00","created_by":"daemon"}]}
{"id":"bujo-7z2","title":"Add inline page definitions with body block to PDF DSL","description":"Enable fluid, composable page definitions directly within define_pdf blocks without requiring predefined page classes.\n\n## Goal\nAllow users to define pages on-the-fly using components directly in the DSL:\n\n```ruby\nBujoPdf.define_pdf :simple_notes do |year:|\n  page id: :notes, outline: 'Notes' do\n    layout :full_page\n    theme :dark              # Override theme for this page\n    background :ruled        # :dot_grid (default), :ruled, :blank\n\n    body do\n      h1(2, 1, \"Notes\")\n      ruled_lines(2, 3, 38, 50)\n    end\n  end\n\n  # Minimal inline page\n  page do\n    body do\n      h1(2, 1, \"Blank\")\n    end\n  end\n\n  # Still supports predefined pages\n  page :weekly, week: week\nend\n```\n\n## Design Decisions\n- `body` block separates metadata/config from rendering\n- Page-level config: layout, theme override, background type\n- Body block has access to all component verbs (h1, ruled_lines, box, etc.)\n- Must work with two-pass architecture (declaration pass, then render pass)\n\n## Implementation Plan\n1. **InlinePageContext** - captures config and body block during declaration\n   - layout(name, **options)\n   - theme(name)\n   - background(type)\n   - body(\u0026block)\n\n2. **InlinePageDeclaration** - extends PageDeclaration to store inline config\n   - Stores layout_name, theme_override, background_type, body_block\n\n3. **InlinePage** - anonymous page class for render phase\n   - Extends Pages::Base\n   - Includes Components::All\n   - Executes stored body block in render()\n\n4. Update **DeclarationContext#page** to detect block and create InlinePageDeclaration\n\n5. Update **PdfBuilder#render_page** to handle InlinePageDeclaration","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-30T08:40:28.508062776-05:00","updated_at":"2025-11-30T09:08:10.328736146-05:00","closed_at":"2025-11-30T09:08:10.328736146-05:00","comments":[{"id":8,"issue_id":"bujo-7z2","author":"andy","text":"Starting implementation. Plan:\n1. Create InlinePageContext for capturing config/body block\n2. Create InlinePageDeclaration extending PageDeclaration\n3. Create InlinePage class for render phase\n4. Update DeclarationContext#page to handle blocks\n5. Update PdfBuilder#render_page for inline pages","created_at":"2025-11-30T19:04:05Z"}]}
{"id":"bujo-8e5","title":"PageSet abstraction for multi-page spreads (Index, FutureLog, Weekly)","description":"## Architecture Vision\n\nPageSet as a **child context** of PageContext (evolved RenderContext), not a separate orchestration layer.\n\n### Layered Context Model\n```\nPageContext (unified page context)\n├── Global PDF state: year, total_weeks, date_config, event_store\n├── Current page state: page_number, page_key\n├── .set (PageSet::Context) - when inside a page_set block\n│   ├── page (1-based position in set)\n│   ├── total (count of pages in set)\n│   ├── label (interpolated string like \"Index 1 of 2\")\n│   ├── first?, last?\n│   └── name (set name)\n└── Page-specific extras via **data\n```\n\n### Target API\n```ruby\n# DSL in builder/mixin\npage_set(2, \"Index %page of %total\") do |set|\n  set.each { |i| index_page(num: i + 1) }\nend\n\n# In pages\ncontext.set?           # =\u003e true\ncontext.set.page       # =\u003e 1\ncontext.set.label      # =\u003e \"Index 1 of 2\"\ndraw_set_label         # renders footer automatically\n```\n\n### Key Design Decisions\n1. PageSet is child of PageContext (`context.set`), not parallel\n2. Null object pattern - `context.set` always exists\n3. DSL block scoping auto-populates context.set\n4. build_context picks up current page set state automatically\n\nSee plan: ~/.claude/plans/jiggly-churning-moth.md","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-29T19:29:00.899735436-05:00","updated_at":"2025-11-29T20:43:46.228713406-05:00","closed_at":"2025-11-29T20:43:46.228713406-05:00"}
{"id":"bujo-8e5.1","title":"Create PageSet and PageSet::Context classes","description":"## Context\nCore data structure for page set pagination info.\n\n## Implementation\nCreate `lib/bujo_pdf/page_set.rb` with:\n\n### PageSet class\n- `initialize(count:, label:, name:)`\n- `[](index)` returns PageSet::Context for that index\n- `each` yields 0-based indices\n- `size` / `count`\n- Private: `interpolate_label(page_num)` - replaces %page/%total\n\n### PageSet::Context class\n- `page` (1-based position)\n- `total`\n- `label` (interpolated string)\n- `name` (extracted from label or explicit)\n- `first?` / `last?`\n\n### PageSet::NullContext class (null object)\n- All methods return nil/false\n- Used when not inside a page_set block\n\n## Acceptance Criteria\n- [ ] PageSet enumerable with `[]` and `each`\n- [ ] Label interpolation works: \"Index %page of %total\" =\u003e \"Index 1 of 2\"\n- [ ] NullContext responds to all Context methods safely\n- [ ] Tests pass","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-29T20:18:56.162959536-05:00","updated_at":"2025-11-29T20:23:59.001567993-05:00","closed_at":"2025-11-29T20:23:59.001567993-05:00","dependencies":[{"issue_id":"bujo-8e5.1","depends_on_id":"bujo-8e5","type":"parent-child","created_at":"2025-11-29T20:18:56.163847193-05:00","created_by":"daemon"}]}
{"id":"bujo-8e5.2","title":"Evolve RenderContext into PageContext with .set attribute","description":"## Context\nPageContext is the unified context object that flows to pages. It needs a `.set` attribute for page set info.\n\n## Implementation\nModify `lib/bujo_pdf/render_context.rb` (or create page_context.rb):\n\n### Changes\n- Add `attr_accessor :set`\n- Initialize `@set = PageSet::NullContext.new` by default\n- Add `set?` method: `!@set.is_a?(PageSet::NullContext)`\n- Consider aliasing RenderContext -\u003e PageContext for transition\n\n## Acceptance Criteria\n- [ ] `context.set` always returns an object (never nil)\n- [ ] `context.set?` returns true only when in a page set\n- [ ] Backward compatible with existing hash-style access\n- [ ] Existing pages still work unchanged","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-29T20:19:14.273495503-05:00","updated_at":"2025-11-29T20:26:53.267612228-05:00","closed_at":"2025-11-29T20:26:53.267612228-05:00","dependencies":[{"issue_id":"bujo-8e5.2","depends_on_id":"bujo-8e5","type":"parent-child","created_at":"2025-11-29T20:19:14.274167144-05:00","created_by":"daemon"},{"issue_id":"bujo-8e5.2","depends_on_id":"bujo-8e5.1","type":"blocks","created_at":"2025-11-29T20:19:14.275069239-05:00","created_by":"daemon"}],"comments":[{"id":9,"issue_id":"bujo-8e5.2","author":"andy","text":"Commit 7e482c7: Added @set attr_accessor to RenderContext with NullContext default, added set? method. All acceptance criteria verified with tests.","created_at":"2025-11-30T19:04:05Z"}]}
{"id":"bujo-8e5.3","title":"Add page_set DSL to MixinSupport","description":"## Context\nThe page_set DSL allows builders to declare page sets. It auto-populates context.set for pages generated inside the block.\n\n## Implementation\nIn `lib/bujo_pdf/pages/mixin_support.rb`:\n\n### Add page_set method\n```ruby\ndef page_set(count, label = nil, name: nil)\n  set = PageSet.new(count: count, label: label, name: name)\n  if block_given?\n    set.each do |i|  # 0-based\n      @current_page_set = set\n      @current_page_set_index = i\n      yield set\n    end\n  else\n    set  # return for manual use\n  end\nensure\n  @current_page_set = nil\n  @current_page_set_index = nil\nend\n```\n\n### Update build_context\nAfter creating PageContext, attach set context if inside page_set block:\n```ruby\nif @current_page_set\n  ctx.set = @current_page_set[@current_page_set_index]\nend\n```\n\n## Acceptance Criteria\n- [ ] page_set(n, label) { } iterates n times\n- [ ] Pages inside block have context.set populated\n- [ ] Pages outside block have context.set as NullContext\n- [ ] Block scoping works correctly (nested sets?)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-29T20:19:26.165908412-05:00","updated_at":"2025-11-29T20:34:02.204305922-05:00","closed_at":"2025-11-29T20:34:02.204305922-05:00","dependencies":[{"issue_id":"bujo-8e5.3","depends_on_id":"bujo-8e5","type":"parent-child","created_at":"2025-11-29T20:19:26.166934033-05:00","created_by":"daemon"},{"issue_id":"bujo-8e5.3","depends_on_id":"bujo-8e5.2","type":"blocks","created_at":"2025-11-29T20:19:26.16801904-05:00","created_by":"daemon"}],"comments":[{"id":10,"issue_id":"bujo-8e5.3","author":"andy","text":"Commit c0574cc: Added page_set DSL method and updated build_context to auto-populate context.set inside block. All acceptance criteria verified with tests.","created_at":"2025-11-30T19:04:05Z"}]}
{"id":"bujo-8e5.4","title":"Add draw_set_label helper to Pages::Base","description":"## Context\nStandard footer rendering for pages in a set.\n\n## Implementation\nIn `lib/bujo_pdf/pages/base.rb`:\n\n```ruby\ndef draw_set_label(col: 2, row: 54, width: 39)\n  return unless context.set?\n  \n  text(col, row, context.set.label,\n       size: 9, color: '999999', width: width,\n       align: :center, position: :subscript)\nend\n```\n\n## Acceptance Criteria\n- [ ] No-op when not in a page set\n- [ ] Renders context.set.label when in a set\n- [ ] Customizable position via col/row/width params","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-29T20:19:39.071946618-05:00","updated_at":"2025-11-29T20:36:30.58151606-05:00","closed_at":"2025-11-29T20:36:30.58151606-05:00","dependencies":[{"issue_id":"bujo-8e5.4","depends_on_id":"bujo-8e5","type":"parent-child","created_at":"2025-11-29T20:19:39.073592693-05:00","created_by":"daemon"},{"issue_id":"bujo-8e5.4","depends_on_id":"bujo-8e5.2","type":"blocks","created_at":"2025-11-29T20:19:39.074543631-05:00","created_by":"daemon"}],"comments":[{"id":11,"issue_id":"bujo-8e5.4","author":"andy","text":"Commit 063d43d: Added draw_set_label helper to Pages::Base. No-op when not in set, renders centered gray label when in a set. Customizable col/row/width params.","created_at":"2025-11-30T19:04:05Z"}]}
{"id":"bujo-8e5.5","title":"Update IndexPage mixin to use page_set DSL","description":"## Context\nFirst consumer of the new page_set DSL. Proof of concept.\n\n## Implementation\nIn `lib/bujo_pdf/pages/index_pages.rb`:\n\n### Update index_pages verb\n```ruby\ndef index_pages(count: 2)\n  page_set(count, \"Index %page of %total\") do |set|\n    set.each do |i|\n      index_page(num: i + 1)\n    end\n  end\nend\n```\n\n### Update IndexPage class\n- Replace `draw_page_indicator` with `draw_set_label`\n- Remove manual @index_page_num/@index_page_count extraction (use context.set)\n\n## Acceptance Criteria\n- [ ] index_pages(count: 2) generates 2 pages with correct footers\n- [ ] Footer shows \"Index 1 of 2\", \"Index 2 of 2\"\n- [ ] Legacy single index_page(num:) still works\n- [ ] Visual output unchanged","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-29T20:19:51.761301497-05:00","updated_at":"2025-11-29T20:39:06.586246728-05:00","closed_at":"2025-11-29T20:39:06.586246728-05:00","dependencies":[{"issue_id":"bujo-8e5.5","depends_on_id":"bujo-8e5","type":"parent-child","created_at":"2025-11-29T20:19:51.762368835-05:00","created_by":"daemon"},{"issue_id":"bujo-8e5.5","depends_on_id":"bujo-8e5.3","type":"blocks","created_at":"2025-11-29T20:19:51.763279994-05:00","created_by":"daemon"},{"issue_id":"bujo-8e5.5","depends_on_id":"bujo-8e5.4","type":"blocks","created_at":"2025-11-29T20:19:51.764108728-05:00","created_by":"daemon"}],"comments":[{"id":12,"issue_id":"bujo-8e5.5","author":"andy","text":"Commit 98832ed: Updated index_pages to use page_set DSL. IndexPage now uses draw_set_label and removes draw_page_indicator. Visual output unchanged - verified via PDF generation.","created_at":"2025-11-30T19:04:05Z"}]}
{"id":"bujo-8e5.6","title":"Update FutureLog mixin to use page_set DSL","description":"## Context\nSecond consumer, validates the pattern works for different page types.\n\n## Implementation\nIn `lib/bujo_pdf/pages/future_log.rb`:\n\n### Update future_log_pages verb\n```ruby\ndef future_log_pages(count: 2)\n  page_set(count, \"Future Log %page of %total\") do |set|\n    set.each do |i|\n      future_log_page(num: i + 1, start_month: i * 6 + 1)\n    end\n  end\nend\n```\n\n### Update FutureLog class\n- Replace `draw_page_indicator` with `draw_set_label`\n- Remove manual footer construction\n\n## Acceptance Criteria\n- [ ] future_log_pages generates pages with correct footers\n- [ ] Footer shows \"Future Log 1 of 2\", \"Future Log 2 of 2\"\n- [ ] Visual output unchanged","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-29T20:21:45.711294383-05:00","updated_at":"2025-11-29T20:43:23.576533153-05:00","closed_at":"2025-11-29T20:43:23.576533153-05:00","dependencies":[{"issue_id":"bujo-8e5.6","depends_on_id":"bujo-8e5","type":"parent-child","created_at":"2025-11-29T20:21:45.711990237-05:00","created_by":"daemon"},{"issue_id":"bujo-8e5.6","depends_on_id":"bujo-8e5.5","type":"blocks","created_at":"2025-11-29T20:21:45.712909151-05:00","created_by":"daemon"}],"comments":[{"id":13,"issue_id":"bujo-8e5.6","author":"andy","text":"Commit 0f2d539: Updated future_log_pages to use page_set DSL. FutureLog now uses draw_set_label. Note: PlannerGenerator still uses direct context creation, will need to switch to page verbs for footers to appear.","created_at":"2025-11-30T19:04:05Z"}]}
{"id":"bujo-8hj","title":"Migrate standalone components to canvas: parameter","description":"Change 14 standalone components from pdf:, grid: to canvas:.\n\nThese already use explicit kwargs - change to canvas: and add inheritance.\n\n## Components\nbox, erase_dots, grid_dots, grid_ruler, h1, h2, hline, mini_month, ruled_lines, ruled_list, text, todo_list, vline, week_grid\n\n## Pattern\nBefore:\n```ruby\nclass Text\n  def initialize(pdf:, grid:, col:, row:, content:, ...)\n    @pdf = pdf\n    @grid = grid\n    @col = col\n    # ...\n  end\nend\n```\n\nAfter:\n```ruby\nclass Text \u003c Component\n  def initialize(canvas:, col:, row:, content:, ...)\n    super(canvas: canvas)\n    @col = col\n    # ...\n  end\nend\n```\n\n## Notes\n- todo_list and week_grid work in points (no grid) - may need special handling\n- Most changes are mechanical: add inheritance, change pdf:/grid: to canvas:, call super","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-30T15:34:47.136349334-05:00","updated_at":"2025-11-30T16:37:48.139649494-05:00","closed_at":"2025-11-30T16:37:48.139649494-05:00","close_reason":"Migrated all 14 standalone components to canvas: parameter. Tests pass and planner generates.","dependencies":[{"issue_id":"bujo-8hj","depends_on_id":"bujo-auv","type":"blocks","created_at":"2025-11-30T15:34:59.805761003-05:00","created_by":"daemon"}]}
{"id":"bujo-8jm","title":"Add define_page helper to MixinSupport","description":"Replace DocumentBuilder's method_missing inference with explicit `define_page` calls in Mixin verbs.\n\n## Design\n\nAdd `define_page` helper to MixinSupport:\n\n```ruby\ndef define_page(dest:, title:, type:, **metadata, \u0026render_block)\n  if @defining\n    # Define phase: create PageRef with stored render block\n    ref = PageRef.new(\n      dest_name: dest,\n      title: title,\n      page_type: type,\n      metadata: metadata,\n      render_block: render_block\n    )\n    @current_builder_page_set\u0026.add(ref)\n    @pages \u003c\u003c ref\n    ref\n  else\n    # Render phase: just execute the block\n    render_block.call\n  end\nend\n```\n\n## Mixin Usage\n\n```ruby\ndef weekly_page(week:)\n  define_page(dest: \"week_#{week}\", title: \"Week #{week}\", type: :weekly) do\n    start_new_page\n    context = build_context(page_key: \"week_#{week}\".to_sym, ...)\n    WeeklyPage.new(@pdf, context).generate\n  end\nend\n```\n\n## Changes Required\n\n1. Add `render_block` to PageRef\n2. Add `define_page` to MixinSupport\n3. Migrate all ~20 Mixin verbs to use `define_page`\n4. Remove from DocumentBuilder:\n   - `method_missing` / `respond_to_missing?`\n   - `infer_dest_name`, `infer_title`, `infer_page_type`\n   - `create_page_ref`\n5. Simplify `render_page` to call `page_ref.render_block.call`\n\n## Design Decisions\n\n- **define_page only** - No backwards compatibility with direct rendering\n- **Auto-detect page_set** - Automatically adds to `@current_builder_page_set` if active","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-29T21:50:02.939516723-05:00","updated_at":"2025-11-29T22:13:31.214429376-05:00","closed_at":"2025-11-29T22:13:31.214429376-05:00"}
{"id":"bujo-8n7","title":"Add tests for dsl/runtime/component_context.rb (50% coverage)","description":"File: lib/bujo_pdf/dsl/runtime/component_context.rb\nCurrent coverage: 50.0% (16 uncovered lines)\nTarget: 70%+","status":"open","priority":3,"issue_type":"chore","created_at":"2025-11-30T22:04:02.645871222-05:00","updated_at":"2025-11-30T22:04:02.645871222-05:00"}
{"id":"bujo-8y2","title":"Add tests for components/ruled_list.rb (48% coverage)","description":"File: lib/bujo_pdf/components/ruled_list.rb\nCurrent coverage: 47.92% (25 uncovered lines)\nTarget: 70%+","status":"open","priority":3,"issue_type":"chore","created_at":"2025-11-30T22:04:02.271853261-05:00","updated_at":"2025-11-30T22:04:02.271853261-05:00"}
{"id":"bujo-9jc","title":"Add tests for calendars/recurring_event_expander.rb (33% coverage)","description":"File: lib/bujo_pdf/dsl/configuration/calendars/recurring_event_expander.rb\nCurrent coverage: 33.33% (16 uncovered lines)\nTarget: 70%+","status":"open","priority":2,"issue_type":"chore","created_at":"2025-11-30T22:03:25.322903197-05:00","updated_at":"2025-11-30T22:03:25.322903197-05:00"}
{"id":"bujo-9p0","title":"Add tests for components/mini_month.rb (25% coverage)","description":"File: lib/bujo_pdf/components/mini_month.rb\nCurrent coverage: 24.69% (61 uncovered lines)\nTarget: 70%+","status":"open","priority":2,"issue_type":"chore","created_at":"2025-11-30T22:03:09.083859025-05:00","updated_at":"2025-11-30T22:03:09.083859025-05:00"}
{"id":"bujo-alt","title":"Phase 4: Migration - Reference Page","description":"Reimplement the reference/calibration page using the DSL as a proof of concept.\n\nWhy this page:\n- Relatively simple structure\n- Uses grid system\n- Good test of the DSL primitives\n\nSteps:\n1. Define reference page using DSL\n2. Render both old and new versions\n3. Visual diff to validate\n4. Document any DSL gaps discovered\n\nThis validates the DSL works before migrating more complex pages.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-29T10:25:03.999341-05:00","updated_at":"2025-11-29T11:50:52.445669-05:00","closed_at":"2025-11-29T11:50:52.445669-05:00","dependencies":[{"issue_id":"bujo-alt","depends_on_id":"bujo-5e1","type":"parent-child","created_at":"2025-11-29T10:25:12.063815-05:00","created_by":"daemon"},{"issue_id":"bujo-alt","depends_on_id":"bujo-dkz","type":"blocks","created_at":"2025-11-29T10:25:12.089145-05:00","created_by":"daemon"}],"comments":[{"id":14,"issue_id":"bujo-alt","author":"andy","text":"Analysis: The DSL currently lacks a renderer component.\n\nThe Page Definition DSL (Phases 1-3) implemented:\n- Layout tree with nodes (sections, columns, grids)\n- Content nodes (text, fields, dot_grid, etc.)\n- Style resolution with cascading themes\n- Component registry for reusable patterns\n\nMissing for page migration:\n1. LayoutRenderer - converts layout tree to Prawn calls\n2. Shape primitives (circle, line, etc.) or custom render blocks\n3. Integration with existing page rendering pipeline\n\nThe reference page specifically needs:\n- Circles (draw_reference_circle)\n- Division lines (draw_division_lines)\n- Center cross (draw_center_cross)\n- Centimeter markings (draw_centimeter_markings)\n- Text blocks with precise positioning\n\nRecommendation: Create a LayoutRenderer that can:\n1. Walk the computed layout tree\n2. Render each node type to Prawn\n3. Support 'custom' nodes for specialized drawing\n\nThis is foundational work needed before any page can be migrated.","created_at":"2025-11-30T19:04:05Z"},{"id":15,"issue_id":"bujo-alt","author":"andy","text":"Commit ce39f53: Added LayoutRenderer and CustomNode\n\nCreated:\n- LayoutRenderer class that walks layout trees and renders to Prawn\n- CustomNode for arbitrary Prawn drawing within layouts\n- LayoutBuilder#custom method for creating custom nodes\n- Tests for renderer and custom node\n\nThe renderer handles:\n- Grid-to-points coordinate conversion\n- Text, dividers, dot/graph grids, ruled lines, fields\n- Navigation links and tabs\n- Style resolution with themes\n\nCustomNode enables specialized drawing like circles and arbitrary lines\nthat the reference page needs.","created_at":"2025-11-30T19:04:05Z"},{"id":16,"issue_id":"bujo-alt","author":"andy","text":"Status Update: Foundational work complete\n\nThe critical infrastructure for page migration is now in place:\n1. LayoutRenderer - renders layout trees to Prawn\n2. CustomNode - enables arbitrary drawing within DSL layouts\n3. Style resolution - cascading styles from themes\n\nRemaining work to fully migrate reference page:\n- Create reference_page_dsl.rb using DSL primitives\n- Visual comparison with current implementation\n\nThe CustomNode approach allows us to replicate any specialized drawing\n(circles, centimeter markings, etc.) while gaining the benefits of\ndeclarative layout for the structural elements.\n\nThis task has been partially delivered - the blocker (no renderer) is resolved.\nThe actual page definition can be done as follow-up work.","created_at":"2025-11-30T19:04:05Z"}]}
{"id":"bujo-am1","title":"Implement quantization width calculation logic","description":"Add calculate_column_widths method to WeekGrid:\n- When quantize: true and width divisible by 7 boxes → equal box widths\n- Otherwise → proportional division of available space\n- Return array of 7 column widths\n\nPart of Plan #22 Phase 1","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-13T16:20:55.140295939-05:00","updated_at":"2025-11-13T16:33:51.09411414-05:00","closed_at":"2025-11-13T16:33:51.09411414-05:00","labels":["component","plan-22"],"dependencies":[{"issue_id":"bujo-am1","depends_on_id":"bujo-dkq","type":"blocks","created_at":"2025-11-13T16:22:16.472394728-05:00","created_by":"daemon"}]}
{"id":"bujo-ap3","title":"Create dsl/runtime/ for execution-time support","description":"Move execution-time support files into `lib/bujo_pdf/dsl/runtime/`.\n\nFiles to move:\n- `render_context.rb` → `dsl/runtime/render_context.rb`\n- `component_context.rb` → `dsl/runtime/component_context.rb`\n- `page_factory.rb` → `dsl/runtime/page_factory.rb`\n- `page_ref.rb` → `dsl/runtime/page_ref.rb`\n- `page_set.rb` → `dsl/runtime/page_set.rb`\n- `page_set_context.rb` → `dsl/runtime/page_set_context.rb`\n\nTasks:\n1. Create `lib/bujo_pdf/dsl/runtime/` directory\n2. `git mv` all files\n3. Update requires in `lib/bujo_pdf.rb`\n4. Update any `require_relative` in dependent files\n5. Run tests\n\nPart of DSL reorganization plan.","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-11-30T15:08:36.684160092-05:00","updated_at":"2025-11-30T15:37:49.640179505-05:00","closed_at":"2025-11-30T15:37:49.640179505-05:00","close_reason":"Created dsl/runtime/ with 6 files moved. Updated require paths. Tests pass. Commit 8862aab.","dependencies":[{"issue_id":"bujo-ap3","depends_on_id":"bujo-49m","type":"blocks","created_at":"2025-11-30T15:08:46.266714913-05:00","created_by":"daemon"}]}
{"id":"bujo-aqm","title":"Add tests for dsl/configuration/calendars.rb (24% coverage)","description":"File: lib/bujo_pdf/dsl/configuration/calendars.rb\nCurrent coverage: 23.68% (29 uncovered lines)\nTarget: 70%+","status":"in_progress","priority":2,"issue_type":"chore","created_at":"2025-11-30T22:02:57.175964919-05:00","updated_at":"2025-11-30T22:58:56.163582536-05:00"}
{"id":"bujo-as7","title":"Add tests for pages/grids/lined_grid_page.rb (41% coverage)","description":"File: lib/bujo_pdf/pages/grids/lined_grid_page.rb\nCurrent coverage: 41.46% (24 uncovered lines)\nTarget: 70%+","status":"open","priority":3,"issue_type":"chore","created_at":"2025-11-30T22:03:53.163401088-05:00","updated_at":"2025-11-30T22:03:53.163401088-05:00"}
{"id":"bujo-auv","title":"Update Base::Component to use Canvas parameter","description":"Update Base::Component to use Canvas instead of separate pdf/grid params.\n\n## Changes\nCurrent signature:\n```ruby\ndef initialize(pdf, grid_system, content_area: nil, **options)\n  @pdf = pdf\n  @grid = grid_system\n  @content_area = content_area\n  @options = options\nend\n```\n\nNew signature:\n```ruby\ndef initialize(canvas:, content_area: nil)\n  @canvas = canvas\n  @content_area = content_area\nend\n\n# Convenience accessors\ndef pdf = @canvas.pdf\ndef grid = @canvas.grid\n```\n\n## Remove\n- @options instance variable\n- context method (returns @options)\n- require_options helper\n- create_sub_component factory methods\n\n## Keep\n- Style helpers: with_fill_color, with_stroke_color, with_font\n- Content area helpers: content_col, content_row, content_rect\n- Grid delegators (now delegate through @canvas)\n- Abstract render method\n\n## File\nlib/bujo_pdf/base/component.rb","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-30T15:34:21.288225109-05:00","updated_at":"2025-11-30T15:58:09.54334999-05:00","closed_at":"2025-11-30T15:58:09.54334999-05:00","close_reason":"Component signature changed to canvas: keyword arg. Removed @options, context, require_options, create_sub_component factories. Commit b891a0b.","dependencies":[{"issue_id":"bujo-auv","depends_on_id":"bujo-nij","type":"blocks","created_at":"2025-11-30T15:48:03.199759016-05:00","created_by":"daemon"}]}
{"id":"bujo-ayc","title":"Refactor year-at-a-glance pages to use WeekGrid","description":"Update year_events.rb and year_highlights.rb:\n- Use WeekGrid for weekday header row\n- Maintain quantized column widths for visual consistency\n- Update day cell positioning to use grid.cell_rect()\n\nPart of Plan #22 Phase 3","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-13T16:21:13.389098472-05:00","updated_at":"2025-11-30T14:05:29.093882721-05:00","closed_at":"2025-11-30T14:05:29.093882721-05:00","close_reason":"Not pursuing","labels":["plan-22","refactoring"],"dependencies":[{"issue_id":"bujo-ayc","depends_on_id":"bujo-hu8","type":"blocks","created_at":"2025-11-13T16:22:16.991714756-05:00","created_by":"daemon"}]}
{"id":"bujo-b1y","title":"Future log template","description":"Simple 3-month or 6-month spread with minimal structure. Just month headers and open space for capturing things beyond the current planning horizon.\n\nDesign options:\n- 3-month (fits on one spread) vs 6-month (two spreads)\n- How much structure? Just month headers, or add week markers?\n- Should entries be linkable to specific weeks when they arrive?","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-29T10:14:47.183297-05:00","updated_at":"2025-11-29T12:39:21.081147-05:00","closed_at":"2025-11-29T12:39:21.081147-05:00","dependencies":[{"issue_id":"bujo-b1y","depends_on_id":"bujo-68h","type":"parent-child","created_at":"2025-11-29T10:15:46.984867-05:00","created_by":"daemon"}]}
{"id":"bujo-bjl","title":"PDF Definition DSL","description":"A declarative DSL for composing complete PDFs from page definitions. Sits above the Page DSL and handles document-level concerns: page ordering, cross-reference resolution, metadata, and reusable 'recipes' for common planner configurations.\n\n## Current State\n\nPDF generation is imperative - document structure embedded in procedural code, making it hard to offer variations or let users define custom planners.\n\n## Proposed DSL\n\n```ruby\nBujoPdf.define_pdf :standard_planner do |year:, theme: :light|\n  metadata { title \"Planner #{year}\" }\n  theme theme\n\n  page :seasonal_calendar, year: year\n  weeks_in(year).each { |week| page :weekly, week: week }\n  group :grids, cycle: true do\n    page :dot_grid\n    page :graph_grid\n  end\nend\n\nBujoPdf.generate :standard_planner, year: 2025, theme: :earth\n```\n\n## Key Features\n\n- Named recipes with parameters\n- Page groups with navigation scoping\n- Conditional pages\n- Cross-reference resolution (two-pass: declare then render)\n- Recipe composition (include_recipe)\n- YAML config for non-programmers\n\n## Implementation Phases\n\nPhase 1: Core DSL and Builder - PdfDefinition, DeclarationContext, PageDeclaration\nPhase 2: Link Resolution - Two-pass build, LinkRegistry\nPhase 3: Recipe Registry - Named recipes, composition\n\nFull proposal in history/pdf-dsl-proposal.md","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-11-29T10:26:55.284445-05:00","updated_at":"2025-11-29T12:00:57.078782-05:00","closed_at":"2025-11-29T12:00:57.078782-05:00","dependencies":[{"issue_id":"bujo-bjl","depends_on_id":"bujo-5e1","type":"related","created_at":"2025-11-29T10:30:52.176183-05:00","created_by":"daemon"}],"comments":[{"id":17,"issue_id":"bujo-bjl","author":"andy","text":"IMPLEMENTATION APPROACH: Incremental wrap-then-migrate\n\nWorking software stays working. PDF DSL wraps existing PlannerGenerator and page classes initially. Later phases migrate to DSL-native orchestration. Clean as we go.","created_at":"2025-11-30T19:04:05Z"}]}
{"id":"bujo-c3t","title":"Add tests for components/h1.rb (48% coverage)","description":"File: lib/bujo_pdf/components/h1.rb\nCurrent coverage: 47.83% (12 uncovered lines)\nTarget: 70%+","status":"open","priority":3,"issue_type":"chore","created_at":"2025-11-30T22:03:54.886396229-05:00","updated_at":"2025-11-30T22:03:54.886396229-05:00"}
{"id":"bujo-cuv","title":"Add tests for utilities/diagnostics.rb (8% coverage)","description":"File: lib/bujo_pdf/utilities/diagnostics.rb\nCurrent coverage: 8.33% (33 uncovered lines)\nTarget: 70%+","status":"closed","priority":1,"issue_type":"chore","created_at":"2025-11-30T22:02:40.732516141-05:00","updated_at":"2025-11-30T22:29:08.828324092-05:00","closed_at":"2025-11-30T22:29:08.828324092-05:00","close_reason":"Added 13 tests achieving 100% coverage"}
{"id":"bujo-cwg","title":"Refactor grid.rect to return GridRect instead of Hash","description":"Currently `grid.rect(col, row, width, height)` returns a Hash with point-based coordinates:\n```ruby\n{x: 70.85, y: 650.3, width: 42.51, height: 14.17}\n```\n\nThis creates confusion when trying to splat it into component verbs that expect grid coordinates.\n\n**Goal**: Have `grid.rect()` return a `GridRect` value object which:\n- Has `col`, `row`, `width`, `height` accessors (grid coordinates)\n- Supports `*rect` splatting via `to_a` → `[col, row, width, height]`\n- Supports `**rect` splatting via `to_hash` → `{col:, row:, width:, height:}`\n- Has `.to_h` for point-based hash if needed: `{x:, y:, width:, height:}`\n\n**Steps**:\n1. Audit all usages of `grid.rect()` to understand current usage patterns\n2. Update GridRect to have a `to_point_hash` or similar for point-based coords if needed\n3. Update `GridSystem#rect` to return GridRect\n4. Fix any callers that expect Hash with point-based coords","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-30T21:51:30.144494481-05:00","updated_at":"2025-11-30T22:08:55.634298366-05:00","closed_at":"2025-11-30T22:08:55.634298366-05:00","close_reason":"GridRect now supports both grid and point-based accessors with backward-compatible hash-style access. Commit: 11147b3"}
{"id":"bujo-d09","title":"Add tests for layouts/standard_with_sidebars_layout.rb (31% coverage)","description":"File: lib/bujo_pdf/layouts/standard_with_sidebars_layout.rb\nCurrent coverage: 30.91% (38 uncovered lines)\nTarget: 70%+","status":"open","priority":2,"issue_type":"chore","created_at":"2025-11-30T22:03:24.593193029-05:00","updated_at":"2025-11-30T22:03:24.593193029-05:00"}
{"id":"bujo-d15","title":"Pages should define their own page_type and title instead of DocumentBuilder inference","description":"## Problem\n\nDocumentBuilder uses `infer_title` and `infer_page_type` case statements to determine page metadata from verb names. This violates single responsibility - pages should be self-describing.\n\nCurrent approach in `lib/bujo_pdf/document_builder.rb`:\n- `infer_title(verb_name, kwargs)` - 25+ case branches mapping verbs to titles\n- `infer_page_type(verb_name)` - 10+ case branches mapping verbs to types\n\n## Proposed Solution\n\nHave each page class define class methods:\n\n```ruby\nclass SeasonalCalendar \u003c Pages::Base\n  def self.page_title\n    'Seasonal Calendar'\n  end\n\n  def self.page_type\n    :seasonal\n  end\nend\n```\n\nFor dynamic titles (WeeklyPage, MonthlyReview), accept kwargs:\n\n```ruby\nclass WeeklyPage \u003c Pages::Base\n  def self.page_title(week:, **)\n    \"Week #{week}\"\n  end\n\n  def self.page_type\n    :weekly\n  end\nend\n```\n\nThen `DocumentBuilder#create_page_ref` calls the class methods instead of inference:\n\n```ruby\ndef create_page_ref(verb_name, args, kwargs)\n  page_class = page_class_for_verb(verb_name)\n  title = page_class.page_title(**kwargs)\n  page_type = page_class.page_type\n  # ...\nend\n```\n\n## Benefits\n\n1. Pages are self-describing - no external inference needed\n2. Adding new pages doesn't require updating DocumentBuilder\n3. Single source of truth for page metadata\n4. Easier to test - page classes can be tested in isolation\n\n## Files to modify\n\n- Add `page_title` and `page_type` class methods to all page classes in `lib/bujo_pdf/pages/`\n- Remove `infer_title` and `infer_page_type` from `lib/bujo_pdf/document_builder.rb`\n- Add `page_class_for_verb` mapping (or use verb naming convention)","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-11-29T21:28:32.190380956-05:00","updated_at":"2025-11-29T21:49:33.182588642-05:00","closed_at":"2025-11-29T21:49:33.182588642-05:00"}
{"id":"bujo-d44","title":"Add tests for calendars/ical_fetcher.rb (21% coverage)","description":"File: lib/bujo_pdf/dsl/configuration/calendars/ical_fetcher.rb\nCurrent coverage: 21.11% (71 uncovered lines)\nTarget: 70%+","status":"in_progress","priority":2,"issue_type":"chore","created_at":"2025-11-30T22:02:55.273670481-05:00","updated_at":"2025-11-30T22:49:29.85278913-05:00"}
{"id":"bujo-d67","title":"Wire DateConfiguration into PdfBuilder","description":"DateConfiguration is complete but never instantiated:\n\nFiles involved:\n- lib/bujo_pdf/date_configuration.rb - Loads highlighted dates with styling\n- config/dates.yml - Contains real data (birthdays, anniversaries)\n- Pages already expect context.date_config\n\nProblem: PdfBuilder never instantiates DateConfiguration - so date highlights never appear.\n\nFix: Add to lib/bujo_pdf/pdf_dsl/pdf_builder.rb:\n  date_config = DateConfiguration.new('config/dates.yml') if File.exist?('config/dates.yml')\n  # Include in context hash","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-11-30T14:26:48.409094658-05:00","updated_at":"2025-11-30T14:56:33.957837582-05:00","closed_at":"2025-11-30T14:56:33.957837582-05:00","close_reason":"Fixed in same commit as bujo-rq5. DateConfiguration is now loaded in build_base_context() and passed to pages as date_config."}
{"id":"bujo-d6b","title":"RuledList: use text verb for entry numbers","description":"Replace pdf.bounding_box + pdf.text pattern in draw_entry_number with text() verb.\n\nFile: lib/bujo_pdf/components/ruled_list.rb\n\nPart of component architecture refactoring - Phase 3.","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-11-30T21:24:27.018483136-05:00","updated_at":"2025-11-30T22:02:19.160578008-05:00","closed_at":"2025-11-30T22:02:19.160578008-05:00","close_reason":"Refactored draw_entry_number to use text verb. Commit: 8b36bef"}
{"id":"bujo-da0","title":"Quarterly planning spread","description":"12-week year style planning for people who think in quarters.\n\nDesign questions:\n- One spread per quarter, or a rolling 12-week view?\n- How does it integrate with weekly pages? Links?\n- Goal-setting prompts vs pure blank structure?","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-29T10:16:01.84303-05:00","updated_at":"2025-11-29T13:00:19.75477-05:00","closed_at":"2025-11-29T13:00:19.75477-05:00","dependencies":[{"issue_id":"bujo-da0","depends_on_id":"bujo-68h","type":"parent-child","created_at":"2025-11-29T10:16:13.547587-05:00","created_by":"daemon"}]}
{"id":"bujo-ddv","title":"Write WeekGrid unit tests","description":"Create comprehensive tests for WeekGrid:\n- Width calculation edge cases (divisible by 7, not divisible, zero/negative)\n- Quantize true vs false behavior\n- Cell positioning accuracy\n- Different first_day values\n- Header rendering with/without show_headers\n\nPart of Plan #22 Phase 1","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-13T16:21:08.098172293-05:00","updated_at":"2025-11-13T16:39:01.975636065-05:00","closed_at":"2025-11-13T16:39:01.975636065-05:00","labels":["plan-22","testing"],"dependencies":[{"issue_id":"bujo-ddv","depends_on_id":"bujo-am1","type":"blocks","created_at":"2025-11-13T16:22:16.666033213-05:00","created_by":"daemon"},{"issue_id":"bujo-ddv","depends_on_id":"bujo-fjh","type":"blocks","created_at":"2025-11-13T16:22:16.677928029-05:00","created_by":"daemon"}]}
{"id":"bujo-dgz","title":"Add page titles and switch outline to use page titles","description":"## Overview\n\nCurrently, the PDF outline (bookmarks) is built in `build_outline` method with hardcoded title strings. Pages should define their own titles and the outline should use `outline: true` to pull from those titles.\n\n## Current State\n\nSee comparison table from analysis:\n\n| Page | Outline Title | Page Title | Action Needed |\n|------|---------------|------------|---------------|\n| Seasonal Calendar | 'Seasonal Calendar' | 'Year #{year}' | Add title method |\n| Index | 'Index' | 'Index' | Ready |\n| Future Log | 'Future Log' | 'Future Log: ...' | Simplify or keep |\n| Year Events | 'Year at a Glance - Events' | 'Year #{year} - Events' | Align title |\n| Year Highlights | 'Year at a Glance - Highlights' | 'Year #{year} - Highlights' | Align title |\n| Multi-Year | 'Multi-Year Overview' | *(none)* | **Add title** |\n| Quarterly Planning | 'Quarterly Planning' | 'Q# Year' | Add outline_title method |\n| Monthly Reviews | 'Monthly Reviews' | 'Month Year' | Add outline_title method |\n| Grid Showcase | 'Grid Types Showcase' | 'Grid Types' | Align title |\n| Grids Overview | '- Basic Grids Overview' | 'Grid Reference' | Align title |\n| Dot Grid | '- Dot Grid (5mm)' | 'Dot Grid (5mm)' | Ready (handle indent) |\n| Graph Grid | '- Graph Grid (5mm)' | 'Graph Grid (5mm)' | Ready (handle indent) |\n| Ruled Lines | '- Ruled Lines (10mm)' | 'Ruled Lines (10mm)' | Ready (handle indent) |\n| Isometric | '- Isometric Grid' | 'Isometric Grid' | Ready (handle indent) |\n| Perspective | '- Perspective Grid' | 'Perspective Grid (1-point)' | Align title |\n| Hexagon | '- Hexagon Grid' | 'Hexagon Grid' | Ready (handle indent) |\n| Tracker Ideas | 'Tracker Ideas' | 'Tracker Ideas' | Ready |\n| Calibration | 'Calibration \u0026 Reference' | *(none)* | **Add title** |\n| Daily Wheel | 'Daily Wheel' | *(none)* | **Add title** |\n| Year Wheel | 'Year Wheel' | *(none)* | **Add title** |\n| Collections | collection[:title] | @title | Ready |\n\n## Tasks\n\n### 1. Add title methods to pages without titles\n- `multi_year_overview.rb` - add `def outline_title` returning 'Multi-Year Overview'\n- `reference_calibration.rb` - add `def outline_title` returning 'Calibration \u0026 Reference'\n- `daily_wheel.rb` - add `def outline_title` returning 'Daily Wheel'\n- `year_wheel.rb` - add `def outline_title` returning 'Year Wheel'\n\n### 2. Add outline_title method to base class\nAdd `def outline_title` to `Pages::Base` that subclasses can override. This separates the display title from the outline title.\n\n### 3. Align titles where they differ\n- `seasonal_calendar.rb` - add outline_title 'Seasonal Calendar'\n- `year_at_glance_events.rb` - change page_title or add outline_title for 'Year at a Glance - Events'\n- `year_at_glance_highlights.rb` - same for Highlights\n- `grid_showcase.rb` - add outline_title 'Grid Types Showcase'\n- `grids_overview.rb` - add outline_title 'Basic Grids Overview'\n- `perspective_grid_page.rb` - add outline_title 'Perspective Grid'\n\n### 4. Handle hierarchical outline entries\nGrid pages use indented titles ('  - Dot Grid') to show hierarchy. Consider:\n- Option A: Use Prawn's nested outline sections\n- Option B: Keep flat list with visual indentation in title\n\n### 5. Refactor build_outline to use page titles\nReplace hardcoded strings with calls to page outline_title methods. This requires either:\n- Storing page instances during generation, or\n- Creating a registry of page types to outline titles\n\n## Files to modify\n- `lib/bujo_pdf/pages/base.rb` - add outline_title method\n- `lib/bujo_pdf/pages/multi_year_overview.rb`\n- `lib/bujo_pdf/pages/reference_calibration.rb`\n- `lib/bujo_pdf/pages/daily_wheel.rb`\n- `lib/bujo_pdf/pages/year_wheel.rb`\n- `lib/bujo_pdf/pages/seasonal_calendar.rb`\n- `lib/bujo_pdf/pages/year_at_glance_events.rb`\n- `lib/bujo_pdf/pages/year_at_glance_highlights.rb`\n- `lib/bujo_pdf/pages/grid_showcase.rb`\n- `lib/bujo_pdf/pages/grids_overview.rb`\n- `lib/bujo_pdf/pages/grids/perspective_grid_page.rb`\n- `lib/bujo_pdf/planner_generator.rb` - refactor build_outline","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-30T13:44:44.291411-05:00","updated_at":"2025-11-30T14:21:29.355464444-05:00","closed_at":"2025-11-30T14:21:29.355464444-05:00","close_reason":"Implemented:\n1. outline_title method on Pages::Base that pulls from PageRegistry\n2. Updated standard_planner.rb to use outline: true for template pages\n3. Removed legacy outline builder - DSL declarative outlines are now the only path\n4. resolve_page_title in pdf_builder with fallback chain\n5. expand_dsl_params for Week/Month objects\n\nAll tests pass and PDF generation works correctly.","comments":[{"id":41,"issue_id":"bujo-dgz","author":"andy","text":"Commit a82417b: Refactor outline to use page titles from PageRegistry\n\nChanges:\n- Add outline_title method to Pages::Base for override capability\n- Update standard_planner.rb to use outline: true for template pages\n- Remove legacy outline builder from pdf_builder.rb\n- Add resolve_page_title with priority order for title resolution\n- Add expand_dsl_params to handle Week/Month value objects","created_at":"2025-11-30T19:21:23Z"}]}
{"id":"bujo-dkq","title":"Create WeekGrid component class with basic structure","description":"Create lib/bujo_pdf/components/week_grid.rb with:\n- Component class skeleton\n- Constructor accepting pdf, x, y, width, height, quantize, first_day, show_headers, header_height, cell_callback\n- Basic parameter validation\n\nPart of Plan #22 Phase 1","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-13T16:20:51.310329042-05:00","updated_at":"2025-11-13T16:26:48.324600074-05:00","closed_at":"2025-11-13T16:26:48.324600074-05:00","labels":["component","plan-22"]}
{"id":"bujo-dkz","title":"Phase 3: Style Resolution","description":"Build CSS-like cascading style system.\n\nCore classes:\n- StyleResolver - resolves styles for elements\n- Theme - defines named styles\n\nAPI:\n```ruby\nBujoPdf.define_theme :earth do\n  style :title, font_size: 14, font_weight: :bold, color: '4A4A4A'\n  style :dot_grid, dot_color: 'CCCCCC', dot_radius: 0.5\nend\n```\n\nStyle cascade:\n1. Theme default styles (base)\n2. Named style from theme\n3. Inline styles on element\n\nDeliverables:\n- StyleResolver class\n- Theme definition DSL\n- Integration with layout nodes\n- Tests for style resolution","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-29T10:24:51.335782-05:00","updated_at":"2025-11-29T11:36:15.096872-05:00","closed_at":"2025-11-29T11:36:15.096872-05:00","dependencies":[{"issue_id":"bujo-dkz","depends_on_id":"bujo-5e1","type":"parent-child","created_at":"2025-11-29T10:25:03.915883-05:00","created_by":"daemon"},{"issue_id":"bujo-dkz","depends_on_id":"bujo-nle","type":"blocks","created_at":"2025-11-29T10:25:03.964087-05:00","created_by":"daemon"}],"comments":[{"id":18,"issue_id":"bujo-dkz","author":"andy","text":"Commit a488269: Implemented Style Resolution Phase 3\n\nCreated:\n- StyleResolver class with cascade resolution\n- Theme class with colors, named styles, element defaults\n- ThemeBuilder DSL for defining themes\n- ThemeRegistry for storing themes\n- ContentNode integration (element_type, style_ref, inline_styles, resolved_styles)\n\nTests: 30 tests, 76 assertions all passing","created_at":"2025-11-30T19:04:05Z"}]}
{"id":"bujo-dmp","title":"Audit pages for GridRect bounds pattern opportunities","description":"Review all pages for opportunities to simplify component constructor calls using the GridRect bounds pattern (like CornellNotes refactor).\n\nPart of component architecture refactoring - Phase 4.","status":"open","priority":3,"issue_type":"chore","created_at":"2025-11-30T21:24:28.281850149-05:00","updated_at":"2025-11-30T21:24:28.281850149-05:00"}
{"id":"bujo-dpy","title":"Add tests for pages/index_pages.rb (49% coverage)","description":"File: lib/bujo_pdf/pages/index_pages.rb\nCurrent coverage: 48.94% (24 uncovered lines)\nTarget: 70%+","status":"open","priority":3,"issue_type":"chore","created_at":"2025-11-30T22:04:02.517149036-05:00","updated_at":"2025-11-30T22:04:02.517149036-05:00"}
{"id":"bujo-dvb","title":"Delete SubComponentBase after migration","description":"Remove SubComponentBase once all components migrated.\n\n## Delete\n- lib/bujo_pdf/components/sub_component_base.rb\n\n## Update\n- Remove any requires of sub_component_base\n- Update CLAUDE.md if it references SubComponentBase","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-11-30T15:34:52.235886021-05:00","updated_at":"2025-11-30T16:45:15.050705213-05:00","closed_at":"2025-11-30T16:45:15.050705213-05:00","close_reason":"Deleted SubComponentBase and removed require. All tests pass.","dependencies":[{"issue_id":"bujo-dvb","depends_on_id":"bujo-vuc","type":"blocks","created_at":"2025-11-30T15:34:59.824492569-05:00","created_by":"daemon"}]}
{"id":"bujo-dx4","title":"Add tests for pages/all.rb (16% coverage)","description":"File: lib/bujo_pdf/pages/all.rb\nCurrent coverage: 16.28% (36 uncovered lines)\nTarget: 70%+","status":"closed","priority":1,"issue_type":"chore","created_at":"2025-11-30T22:02:41.294339375-05:00","updated_at":"2025-11-30T22:33:24.352438623-05:00","closed_at":"2025-11-30T22:33:24.352438623-05:00","close_reason":"Added 29 tests achieving 100% coverage"}
{"id":"bujo-e3p","title":"Add tests for pages/grid_showcase.rb (29% coverage)","description":"File: lib/bujo_pdf/pages/grid_showcase.rb\nCurrent coverage: 28.79% (47 uncovered lines)\nTarget: 70%+","status":"open","priority":2,"issue_type":"chore","created_at":"2025-11-30T22:03:10.958515737-05:00","updated_at":"2025-11-30T22:03:10.958515737-05:00"}
{"id":"bujo-e7c","title":"Add tests for pages/grids_overview.rb (22% coverage)","description":"File: lib/bujo_pdf/pages/grids_overview.rb\nCurrent coverage: 21.74% (72 uncovered lines)\nTarget: 70%+","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-11-30T22:02:56.261176053-05:00","updated_at":"2025-11-30T22:55:14.24351546-05:00","closed_at":"2025-11-30T22:55:14.24351546-05:00","close_reason":"100% coverage achieved (target 70%). Added 26 tests covering page registration, GRID_SAMPLES constant, setup, render, drawing methods, mixin, and integration."}
{"id":"bujo-etn","title":"Add pt_* positioning params to HLine component","description":"Add pt_x:, pt_y:, pt_width: parameters to enable pixel-precise line positioning (like Text already has).\n\nFile: lib/bujo_pdf/components/hline.rb\n\nWhen pt_* params are provided, use them instead of grid-based calculations. This enables Fieldset to draw inset borders at arbitrary pixel positions.\n\nPart of component architecture refactoring - Phase 1.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-11-30T21:24:04.693706206-05:00","updated_at":"2025-11-30T21:26:21.967031936-05:00","closed_at":"2025-11-30T21:26:21.967031936-05:00","close_reason":"Closed"}
{"id":"bujo-f2q","title":"QuarterlyPlanning: use box verb for nav links","description":"Replace transparent fill_rounded_rectangle with box() verb.\n\nFile: lib/bujo_pdf/pages/quarterly_planning.rb\n\nPart of component architecture refactoring - Phase 2.","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-11-30T21:24:05.136800198-05:00","updated_at":"2025-11-30T21:31:35.068918309-05:00","closed_at":"2025-11-30T21:31:35.068918309-05:00","close_reason":"Closed"}
{"id":"bujo-fjh","title":"Implement WeekGrid rendering methods","description":"Add to WeekGrid:\n- render() - main rendering orchestration\n- draw_headers() - weekday labels (M/T/W/T/F/S/S)\n- draw_column_dividers() - vertical lines between days\n- render_cells() - invoke cell_callback for each cell\n- cell_rect(day_index) - calculate cell boundaries\n- each_cell() - iterator yielding day_index and rect\n\nPart of Plan #22 Phase 1","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-13T16:21:00.975034722-05:00","updated_at":"2025-11-13T16:33:51.105900764-05:00","closed_at":"2025-11-13T16:33:51.105900764-05:00","labels":["component","plan-22"],"dependencies":[{"issue_id":"bujo-fjh","depends_on_id":"bujo-dkq","type":"blocks","created_at":"2025-11-13T16:22:16.567039352-05:00","created_by":"daemon"}]}
{"id":"bujo-ft8","title":"Add layout helper meta-components for margins, columns, rows","description":"Create meta-components that help with common layout calculations:\n\n- **Margins**: Inset content by N boxes on each side\n- **Columns**: Split a region into N equal columns (box-quantized)\n- **Rows**: Split a region into N equal rows (box-quantized)\n\nThese would be calculation helpers rather than rendering components,\nreturning bounds that other components can use.\n\nExample usage ideas:\n```ruby\n# Get inset bounds\ninner = margins(col, row, width, height, left: 2, right: 2)\n\n# Split into quantized columns\ncols = columns(col, row, width, height, count: 3, gap: 1)\ncols.each { |c| ruled_lines(c.col, c.row, c.width, c.height) }\n\n# Split into quantized rows\nrows = rows(col, row, width, height, count: 4, gap: 1)\n```\n\nDiscovered while building RuledLines component - the old SubComponent::RuledLines\nhad margin support that was removed for simplicity. These meta-components would\nprovide a cleaner, composable approach.","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-11-29T17:41:27.200756891-05:00","updated_at":"2025-11-30T14:05:29.055519321-05:00","closed_at":"2025-11-30T14:05:29.055519321-05:00","close_reason":"Not pursuing"}
{"id":"bujo-fuo","title":"Update CLAUDE.md with WeekGrid component documentation","description":"Add WeekGrid section to CLAUDE.md:\n- Component overview and key features\n- Usage examples\n- Parameter documentation\n- Integration with grid system\n\nPart of Plan #22 Phase 2","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-13T16:21:18.060934895-05:00","updated_at":"2025-11-13T19:05:41.700972213-05:00","closed_at":"2025-11-13T19:05:41.700972213-05:00","labels":["documentation","plan-22"],"dependencies":[{"issue_id":"bujo-fuo","depends_on_id":"bujo-hu8","type":"blocks","created_at":"2025-11-13T16:22:16.874131381-05:00","created_by":"daemon"}]}
{"id":"bujo-g9g","title":"Remove PdfDSL and consolidate on DocumentBuilder","description":"## Goal\nSimplify by removing the parallel PdfDSL system and keeping DocumentBuilder as the single approach.\n\n## Current State\n- PlannerGenerator calls DocumentBuilder.generate directly\n- PdfDSL (BujoPdf.define_pdf) exists as a separate parallel system\n- Two different architectures doing similar things\n\n## Approach\n1. Remove lib/bujo_pdf/pdf_dsl.rb and lib/bujo_pdf/pdf_dsl/ directory\n2. Remove BujoPdf.define_pdf and BujoPdf.generate_from_recipe methods\n3. Keep DocumentBuilder as the core PDF generation engine\n4. If recipe concept is valuable, add it to DocumentBuilder directly\n\n## Success Criteria\n- bin/bujo-pdf still works identically\n- Single unified architecture (DocumentBuilder)\n- Less code, simpler mental model\n- No orphaned/unused code paths","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-29T23:21:38.152813105-05:00","updated_at":"2025-11-29T23:41:54.887007206-05:00","closed_at":"2025-11-29T23:41:54.887007206-05:00"}
{"id":"bujo-hqa","title":"Add tests for calendars/config_loader.rb (38% coverage)","description":"File: lib/bujo_pdf/dsl/configuration/calendars/config_loader.rb\nCurrent coverage: 38.24% (42 uncovered lines)\nTarget: 70%+","status":"open","priority":2,"issue_type":"chore","created_at":"2025-11-30T22:03:38.179392232-05:00","updated_at":"2025-11-30T22:03:38.179392232-05:00"}
{"id":"bujo-hu8","title":"Add grid system integration for WeekGrid","description":"Integrate WeekGrid with existing grid system:\n- Add WeekGrid.from_grid() constructor accepting col, row, width_boxes, height_boxes\n- Add week_grid() helper to lib/bujo_pdf/utilities/grid_system.rb\n- Ensure component works with grid coordinate system\n\nPart of Plan #22 Phase 2","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-13T16:21:03.160580462-05:00","updated_at":"2025-11-13T16:40:18.430726146-05:00","closed_at":"2025-11-13T16:40:18.430726146-05:00","labels":["grid-system","plan-22"],"dependencies":[{"issue_id":"bujo-hu8","depends_on_id":"bujo-ddv","type":"blocks","created_at":"2025-11-13T16:22:16.775556038-05:00","created_by":"daemon"}]}
{"id":"bujo-iqp","title":"Add tests for components/grid_ruler.rb (26% coverage)","description":"File: lib/bujo_pdf/components/grid_ruler.rb\nCurrent coverage: 25.81% (46 uncovered lines)\nTarget: 70%+","status":"open","priority":2,"issue_type":"chore","created_at":"2025-11-30T22:03:09.681126664-05:00","updated_at":"2025-11-30T22:03:09.681126664-05:00"}
{"id":"bujo-itj","title":"Add WeekGrid example to CLAUDE.local.md","description":"Add WeekGrid usage pattern to Common Layout Patterns section in CLAUDE.local.md:\n- Show quantized week grid example\n- Demonstrate each_cell iteration pattern\n- Include rect structure documentation\n\nPart of Plan #22 Phase 2","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-13T16:21:25.224313761-05:00","updated_at":"2025-11-13T19:05:41.713756988-05:00","closed_at":"2025-11-13T19:05:41.713756988-05:00","labels":["documentation","plan-22"],"dependencies":[{"issue_id":"bujo-itj","depends_on_id":"bujo-hu8","type":"blocks","created_at":"2025-11-13T16:22:16.883949664-05:00","created_by":"daemon"}]}
{"id":"bujo-iy5","title":"Add tests for base/layout.rb (29% coverage)","description":"File: lib/bujo_pdf/base/layout.rb\nCurrent coverage: 29.23% (46 uncovered lines)\nTarget: 70%+","status":"open","priority":2,"issue_type":"chore","created_at":"2025-11-30T22:03:24.294579422-05:00","updated_at":"2025-11-30T22:03:24.294579422-05:00"}
{"id":"bujo-jq1","title":"Refactor PlannerGenerator to use BujoPdf.define_pdf","description":"## Goal\nUnify PDF generation by making PlannerGenerator use the PdfDSL system internally.\n\n## Current State\n- PlannerGenerator calls DocumentBuilder.generate directly\n- PdfDSL (BujoPdf.define_pdf) exists as a separate parallel system\n- Two different architectures doing similar things\n\n## Approach\n1. Create a :standard_planner recipe using BujoPdf.define_pdf\n2. Refactor PlannerGenerator to call BujoPdf.generate_from_recipe\n3. Migrate config handling (dates.yml, calendars.yml, collections.yml) to work with PdfDSL\n4. DocumentBuilder becomes an implementation detail of PdfDSL or gets removed\n\n## Success Criteria\n- bin/bujo-pdf still works identically\n- Single unified architecture for PDF generation\n- PdfDSL is the public API, DocumentBuilder is internal or removed","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-29T23:21:37.997793502-05:00","updated_at":"2025-11-30T00:08:05.814020738-05:00","closed_at":"2025-11-30T00:08:05.814020738-05:00","comments":[{"id":19,"issue_id":"bujo-jq1","author":"andy","text":"Initial switch done - BujoPdf.generate now uses PdfDSL. Follow-up issues created for gaps: bujo-pdf-zqm (missing pages), bujo-pdf-u1p (missing outlines), bujo-pdf-s5c (verify links)","created_at":"2025-11-30T19:04:05Z"},{"id":20,"issue_id":"bujo-jq1","author":"andy","text":"This was completed in commit 2eb7ed6: BujoPdf.generate now uses generate_from_recipe(:standard_planner) instead of directly using PlannerGenerator.\n\nPlannerGenerator still exists as a separate implementation using DocumentBuilder, but it is now bypassed by the main API. It could be deprecated and eventually removed along with DocumentBuilder.\n\nSuccess criteria met:\n- bin/bujo-pdf works (uses BujoPdf.generate -\u003e PdfDSL)\n- Single unified architecture (PdfDSL is the public API)\n- DocumentBuilder is now an internal legacy system","created_at":"2025-11-30T19:04:05Z"}]}
{"id":"bujo-kd8","title":"Plan: Replace PdfDSL with Document DSL","description":"Replace unused PdfDSL system with clean DocumentBuilder DSL.\n\n## Architecture: Define → Validate → Render\n\n### Define Phase\nDeclarative document structure - no rendering yet:\n```ruby\nDocumentBuilder.generate(\"planner.pdf\", year: 2025) do\n  @index = page_set(2, \"Index %page of %total\") { |i| index_page(num: i + 1) }\n  @weeks = weeks_in(year).map { |week| weekly_page(week: week) }\nend\n```\n\n### Validate Phase\nBefore rendering, validate all internal links resolve to valid PageRefs.\nCatches typos and missing destinations with clear errors.\n\n### Render Phase\nGenerate PDF, assigning real page numbers to PageRefs.\n\n## Core Concepts\n\n- **PageRef**: Single page with metadata (dest_name, title, page_type, pdf_page_number)\n- **PageSet**: Collection of related pages with \"X of Y\" context for footers\n- **Auto-wrapping verbs**: Verbs return PageRefs, participate in page_set context\n- **Type-safe links**: Reference PageRefs directly, validated before render\n- **Automatic outline**: Built from page metadata and set membership\n\n## Benefits Over Current System\n1. No manual `@foo = @pdf.page_number` tracking\n2. Type-safe links (no string typos causing silent failures)\n3. Accurate total_pages before rendering\n4. Automatic outline generation\n5. Clear validation errors for broken links\n6. ~2,600 lines of unused PdfDSL code deleted","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-11-29T20:51:49.579242274-05:00","updated_at":"2025-11-30T00:09:45.18460496-05:00","closed_at":"2025-11-30T00:09:45.18460496-05:00","dependencies":[{"issue_id":"bujo-kd8","depends_on_id":"bujo-q94","type":"blocks","created_at":"2025-11-29T21:19:03.755883421-05:00","created_by":"daemon"},{"issue_id":"bujo-kd8","depends_on_id":"bujo-8jm","type":"blocks","created_at":"2025-11-29T21:50:42.300247301-05:00","created_by":"daemon"}],"comments":[{"id":21,"issue_id":"bujo-kd8","author":"andy","text":"See also bujo-pdf-6t0 which has a more detailed description of the plan context and target API.","created_at":"2025-11-30T19:04:05Z"},{"id":22,"issue_id":"bujo-kd8","author":"andy","text":"Note: PdfDSL has define_pdf(name, \u0026block) for named recipes. Our new DSL uses define_pdf(year:, output:, \u0026block) for direct generation. Different signatures, no conflict since PdfDSL isn't auto-loaded. Can coexist during development for comparison.","created_at":"2025-11-30T19:04:05Z"}]}
{"id":"bujo-kd8.1","title":"Delete PdfDSL system (~2,600 lines)","description":"Delete unused PdfDSL code:\n\n## Files to Delete\n- lib/bujo_pdf/pdf_dsl.rb\n- lib/bujo_pdf/pdf_dsl/ (entire directory - 8 files)\n- test/unit/pdf_dsl/ (entire directory - 7 test files)\n- test/integration/standard_planner_generation_test.rb\n\n## Code to Remove\n- lib/bujo_pdf.rb: Remove define_pdf and generate_from_recipe methods\n\n## Verification\n- Run tests to ensure nothing broke\n- Generate planner to verify output unchanged","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-29T20:51:58.058031572-05:00","updated_at":"2025-11-30T00:09:36.830937167-05:00","closed_at":"2025-11-30T00:09:36.830937167-05:00","dependencies":[{"issue_id":"bujo-kd8.1","depends_on_id":"bujo-kd8","type":"parent-child","created_at":"2025-11-29T20:51:58.058678022-05:00","created_by":"daemon"},{"issue_id":"bujo-kd8.1","depends_on_id":"bujo-kd8.7","type":"blocks","created_at":"2025-11-29T20:56:50.656514734-05:00","created_by":"daemon"},{"issue_id":"bujo-kd8.1","depends_on_id":"bujo-8jm","type":"blocks","created_at":"2025-11-29T21:50:16.079914403-05:00","created_by":"daemon"}],"comments":[{"id":23,"issue_id":"bujo-kd8.1","author":"andy","text":"Delayed until after verification. Compare old PdfDSL approach with new DocumentBuilder before deletion to ensure we haven't lost any valuable concepts. PdfDSL has ~2,600 lines including LinkRegistry and recipe system - review these before final removal.","created_at":"2025-11-30T19:04:05Z"},{"id":24,"issue_id":"bujo-kd8.1","author":"andy","text":"Plan changed: BujoPdf.generate now uses PdfDSL (standard_planner recipe). What should be deleted is:\n- PlannerGenerator (lib/bujo_pdf/planner_generator.rb)\n- DocumentBuilder (lib/bujo_pdf/document_builder.rb)\n- Related config classes if only used by DocumentBuilder\n\nPdfDSL should NOT be deleted - it's now the primary system.","created_at":"2025-11-30T19:04:05Z"},{"id":25,"issue_id":"bujo-kd8.1","author":"andy","text":"Commit 7aa1955: Deleted PlannerGenerator and DocumentBuilder (723 lines removed).\n\nBujoPdf.generate now uses PdfDSL with the standard_planner recipe. The old orchestration layer is no longer needed.\n\nNote: Issue description was outdated - it originally said to delete PdfDSL, but the plan changed to keep PdfDSL as the primary system. What we actually deleted was:\n- lib/bujo_pdf/planner_generator.rb\n- lib/bujo_pdf/document_builder.rb\n- test/integration/standard_planner_generation_test.rb","created_at":"2025-11-30T19:04:05Z"}]}
{"id":"bujo-kd8.2","title":"Create Week value object for iteration","description":"Create lib/bujo_pdf/week.rb - value object for week iteration.\n\n## Purpose\n\nClean iteration over weeks in DocumentBuilder:\n```ruby\nweeks_in(2025).each do |week|\n  quarterly_planning_page(quarter: week.quarter) if week.starts_quarter?\n  monthly_review_page(month: week.month) if week.starts_month?\n  weekly_page(week: week)\nend\n```\n\n## Interface\n\n```ruby\nclass Week\n  attr_reader :year, :number, :start_date, :end_date\n  \n  def initialize(year:, number:)\n    @year = year\n    @number = number\n    @start_date = DateCalculator.week_start(year, number)\n    @end_date = DateCalculator.week_end(year, number)\n  end\n  \n  # Month of the week start\n  def month = start_date.month\n  def month_name = Date::MONTHNAMES[month]\n  \n  # Quarter (1-4)\n  def quarter = ((month - 1) / 3) + 1\n  \n  # Boundary detection for interleaving\n  def starts_month?\n    # True if this is the first week starting in this month\n  end\n  \n  def starts_quarter?\n    # True if this is the first week starting in this quarter\n  end\n  \n  def first_of_month?\n    # True if this is first week where start_date.month == month\n  end\n  \n  # For page context\n  def to_context\n    {\n      week_num: number,\n      week_start: start_date,\n      week_end: end_date\n    }\n  end\nend\n\n# Helper method for DocumentBuilder\ndef weeks_in(year)\n  total = DateCalculator.total_weeks(year)\n  (1..total).map { |n| Week.new(year: year, number: n) }\nend\n```\n\n## Boundary Detection\n\nThe tricky part is detecting month/quarter boundaries correctly:\n- Week 1 might start in December of previous year\n- Need to track \"have we generated January yet?\" state\n\nOptions:\n1. Week tracks state internally (stateful)\n2. weeks_in returns iterator that tracks state\n3. DocumentBuilder tracks generated months/quarters\n\nRecommend option 3 - DocumentBuilder tracks state, Week just provides data:\n```ruby\nweeks_in(year).each do |week|\n  if week.in_year?(year) \u0026\u0026 !@generated_quarters.include?(week.quarter)\n    quarterly_planning_page(quarter: week.quarter)\n    @generated_quarters.add(week.quarter)\n  end\n  # ...\nend\n```","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-29T20:52:19.122751088-05:00","updated_at":"2025-11-29T21:37:57.996113553-05:00","closed_at":"2025-11-29T21:37:57.996113553-05:00","dependencies":[{"issue_id":"bujo-kd8.2","depends_on_id":"bujo-kd8","type":"parent-child","created_at":"2025-11-29T20:52:19.123397744-05:00","created_by":"daemon"}],"comments":[{"id":26,"issue_id":"bujo-kd8.2","author":"andy","text":"Commit 4fd11fe: Added Week value object with boundary detection. Week.all_in(year) and weeks_in() helper in DocumentBuilder.","created_at":"2025-11-30T19:04:05Z"}]}
{"id":"bujo-kd8.3","title":"Create DocumentBuilder orchestration class","description":"Create lib/bujo_pdf/document_builder.rb - the core orchestration DSL.\n\n## Three-Phase Architecture\n\n### 1. Define Phase\nBuild document structure without rendering. Collect PageRefs and register links.\n\n```ruby\nDocumentBuilder.generate(\"planner.pdf\", year: 2025) do\n  @seasonal = seasonal_calendar\n  @index = page_set(2, \"Index %page of %total\") { |i| index_page(num: i + 1) }\n  @weeks = weeks_in(year).map { |week| weekly_page(week: week) }\n  @grids = grid_pages\nend\n```\n\n### 2. Validate Phase\nBefore rendering, validate all internal links resolve to valid PageRefs:\n- Catch typos in destination names\n- Detect links to removed/missing pages\n- Fail fast with clear error messages\n\n### 3. Render Phase\nGenerate actual PDF, assigning real page numbers to PageRefs.\n\n## Core Classes\n\n### PageRef\nRepresents a single generated page:\n```ruby\nclass PageRef\n  attr_reader :dest_name, :title, :page_type\n  attr_accessor :pdf_page_number, :set_context\n  \n  def outline_title\n    set_context\u0026.label || title\n  end\nend\n```\n\n### PageSet\nCollection of related pages with pagination context:\n```ruby\nclass PageSet\n  include Enumerable\n  attr_reader :name, :label_pattern\n  \n  def add(page_ref)\n    # Attaches SetContext to page_ref\n  end\n  \n  SetContext = Data.define(:page, :total, :label, :set_name) do\n    def first? = page == 1\n    def last? = page == total\n  end\nend\n```\n\n## Auto-Wrapping Verbs\n\nVerbs in DocumentBuilder are wrapped to:\n1. Create PageRef with metadata\n2. Register for validation\n3. Return PageRef (not void)\n4. Participate in page_set context if active\n\n```ruby\n# Verbs automatically return PageRefs in DocumentBuilder\n@events = year_events_page  # Returns PageRef\n@events.pdf_page_number     # Available after render phase\n```\n\n## Type-Safe Links\n\nLinks reference PageRefs directly - validated before render:\n```ruby\n# In page definitions\nlink_to(@next_week_ref) { draw_nav_arrow(:right) }\n\n# Validation catches broken links before PDF generation\n```\n\n## Automatic Outline Generation\n\nOutline built from PageRef metadata and set membership:\n- page_type determines outline category\n- set membership determines grouping\n- No manual page number tracking needed\n\n## Entry Point\n\n```ruby\ndef generate(\u0026block)\n  instance_eval(\u0026block)  # Define phase\n  validate!              # Validate phase - raises on broken links\n  render!                # Render phase - generates PDF\nend\n```\n\n## Benefits\n- Type-safe links (no string typos)\n- Accurate total_pages before rendering\n- Pre-computed page numbers for footers\n- Clear errors for missing destinations\n- Automatic outline from page metadata","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-29T20:52:35.327708836-05:00","updated_at":"2025-11-29T21:33:47.662710456-05:00","closed_at":"2025-11-29T21:33:47.662710456-05:00","dependencies":[{"issue_id":"bujo-kd8.3","depends_on_id":"bujo-kd8","type":"parent-child","created_at":"2025-11-29T20:52:35.328374988-05:00","created_by":"daemon"},{"issue_id":"bujo-kd8.3","depends_on_id":"bujo-q94","type":"blocks","created_at":"2025-11-29T21:18:08.544395778-05:00","created_by":"daemon"}],"comments":[{"id":27,"issue_id":"bujo-kd8.3","author":"andy","text":"Commit 09fb2e9: Added simplified DocumentBuilder. Includes Pages::All mixins for page verbs. Full three-phase architecture (define→validate→render) with auto-wrapping verbs deferred - would require modifying all page mixins to return PageRefs. Current version provides foundation with track_page() method.","created_at":"2025-11-30T19:04:05Z"}]}
{"id":"bujo-kd8.4","title":"Add BujoPdf.define_pdf entry point method","description":"Add convenience method to lib/bujo_pdf.rb:\n\n```ruby\ndef self.define_pdf(year:, output:, title: nil, theme: :light, \u0026block)\n  DocumentBuilder.new(year: year, output: output, title: title, theme: theme).generate(\u0026block)\nend\n```","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-29T20:52:49.998130424-05:00","updated_at":"2025-11-29T21:34:36.503501775-05:00","closed_at":"2025-11-29T21:34:36.503501775-05:00","dependencies":[{"issue_id":"bujo-kd8.4","depends_on_id":"bujo-kd8","type":"parent-child","created_at":"2025-11-29T20:52:49.999201018-05:00","created_by":"daemon"},{"issue_id":"bujo-kd8.4","depends_on_id":"bujo-kd8.3","type":"blocks","created_at":"2025-11-29T20:52:50.000029043-05:00","created_by":"daemon"}],"comments":[{"id":28,"issue_id":"bujo-kd8.4","author":"andy","text":"Commit cce620d: Added BujoPdf.define_pdf(year:, output:, theme:, \u0026block) entry point.","created_at":"2025-11-30T19:04:05Z"}]}
{"id":"bujo-kd8.5","title":"Refactor PlannerGenerator to use DocumentBuilder","description":"Refactor PlannerGenerator to use DocumentBuilder internally.\n\n## Before\n~300 lines of procedural page generation with manual page number tracking:\n```ruby\nyear_events_page\n@events_page = @pdf.page_number  # Manual tracking everywhere\n```\n\n## After\nThin wrapper using DocumentBuilder DSL with automatic tracking:\n\n```ruby\ndef generate(filename)\n  DocumentBuilder.generate(filename, year: @year) do\n    @seasonal = seasonal_calendar\n    \n    @index = page_set(INDEX_PAGE_COUNT, \"Index %page of %total\") do |i|\n      index_page(num: i + 1)\n    end\n    \n    @future_log = page_set(FUTURE_LOG_PAGE_COUNT, \"Future Log %page of %total\") do |i|\n      future_log_page(num: i + 1)\n    end\n    \n    @year_events = year_events_page\n    @year_highlights = year_highlights_page\n    @multi_year = multi_year_page\n    \n    weeks_in(@year).each do |week|\n      quarterly_planning_page(quarter: week.quarter) if week.starts_quarter?\n      monthly_review_page(month: week.month) if week.starts_month?\n      weekly_page(week: week)\n    end\n    \n    @grids = grid_pages      # Returns PageSet\n    @templates = template_pages  # Returns PageSet\n    \n    @collections_config.collections.each do |c|\n      collection_page(id: c[:id], title: c[:title], subtitle: c[:subtitle])\n    end\n    \n    # Outline auto-generated from PageRef metadata!\n  end\nend\n```\n\n## Key Improvements\n- No manual `@foo = @pdf.page_number` bookkeeping\n- PageRefs capture page metadata automatically\n- page_set handles \"X of Y\" footer labels\n- Links validated before render (no silent broken links)\n- Outline generated from page types, not manual definition\n- total_pages known accurately before rendering","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-29T20:53:00.989576982-05:00","updated_at":"2025-11-29T21:41:14.375487603-05:00","closed_at":"2025-11-29T21:41:14.375487603-05:00","dependencies":[{"issue_id":"bujo-kd8.5","depends_on_id":"bujo-kd8","type":"parent-child","created_at":"2025-11-29T20:53:00.990340247-05:00","created_by":"daemon"},{"issue_id":"bujo-kd8.5","depends_on_id":"bujo-kd8.3","type":"blocks","created_at":"2025-11-29T20:53:00.991283169-05:00","created_by":"daemon"},{"issue_id":"bujo-kd8.5","depends_on_id":"bujo-kd8.2","type":"blocks","created_at":"2025-11-29T20:53:00.992166268-05:00","created_by":"daemon"}],"comments":[{"id":29,"issue_id":"bujo-kd8.5","author":"andy","text":"Commit 0cd9d66: Refactored to use Week value object for cleaner iteration. Manual page tracking still present - full PageRef-based tracking requires verbs to return PageRefs (future enhancement). Output unchanged (89 pages).","created_at":"2025-11-30T19:04:05Z"}]}
{"id":"bujo-kd8.6","title":"Write DocumentBuilder tests","description":"Write unit and integration tests for DocumentBuilder:\n\n## Unit Tests\n- DocumentBuilder#page generates pages correctly\n- Convenience methods (index_pages, grid_pages, etc.) work\n- Week value object methods (starts_quarter?, starts_month?)\n- Page tracking for outline generation\n\n## Integration Test\n- Generate complete planner using DocumentBuilder\n- Compare output to existing PlannerGenerator output\n- Verify page count, destinations, outline","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-29T20:53:09.17164299-05:00","updated_at":"2025-11-29T22:05:20.475496483-05:00","closed_at":"2025-11-29T22:05:20.475496483-05:00","dependencies":[{"issue_id":"bujo-kd8.6","depends_on_id":"bujo-kd8","type":"parent-child","created_at":"2025-11-29T20:53:09.172391302-05:00","created_by":"daemon"},{"issue_id":"bujo-kd8.6","depends_on_id":"bujo-kd8.5","type":"blocks","created_at":"2025-11-29T20:53:09.173402793-05:00","created_by":"daemon"}],"comments":[{"id":30,"issue_id":"bujo-kd8.6","author":"andy","text":"Commit f65d27f: Added unit tests for Week, PageRef, PageSet, and SetContext. All 38 tests passing.","created_at":"2025-11-30T19:04:05Z"}]}
{"id":"bujo-kd8.7","title":"Verify planner output unchanged","description":"Final verification that refactored PlannerGenerator produces identical output:\n\n## Steps\n1. Generate planner with current PlannerGenerator (save as baseline)\n2. Refactor to use DocumentBuilder\n3. Generate planner again\n4. Compare: page count, file size, visual inspection\n5. Run full test suite","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-29T20:53:16.351893828-05:00","updated_at":"2025-11-29T21:45:35.284360131-05:00","closed_at":"2025-11-29T21:45:35.284360131-05:00","dependencies":[{"issue_id":"bujo-kd8.7","depends_on_id":"bujo-kd8","type":"parent-child","created_at":"2025-11-29T20:53:16.352753622-05:00","created_by":"daemon"},{"issue_id":"bujo-kd8.7","depends_on_id":"bujo-kd8.5","type":"blocks","created_at":"2025-11-29T20:53:16.354070857-05:00","created_by":"daemon"}],"comments":[{"id":31,"issue_id":"bujo-kd8.7","author":"andy","text":"Verified: Integration tests pass. Output consistent at 89 pages, ~7.2MB file size. All 5 integration tests green.","created_at":"2025-11-30T19:04:05Z"}]}
{"id":"bujo-kfu","title":"MonthlyReview: use hline verb for section dividers","description":"Replace 3 pdf.stroke_line calls with hline() verb calls.\n\nFile: lib/bujo_pdf/pages/monthly_review.rb\n\nPart of component architecture refactoring - Phase 2.","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-11-30T21:24:05.020158605-05:00","updated_at":"2025-11-30T21:31:35.040335635-05:00","closed_at":"2025-11-30T21:31:35.040335635-05:00","close_reason":"Closed"}
{"id":"bujo-ldq","title":"Refactor seasonal calendar to use WeekGrid","description":"Replace manual mini-month column calculation in lib/bujo_pdf/pages/seasonal_calendar.rb:\n- Use WeekGrid for weekday columns\n- Set quantize: true for grid alignment\n- Update render_mini_month to use grid.each_cell pattern\n\nPart of Plan #22 Phase 3","status":"closed","priority":3,"issue_type":"task","created_at":"2025-11-13T16:21:10.104311073-05:00","updated_at":"2025-11-30T14:05:29.080751771-05:00","closed_at":"2025-11-30T14:05:29.080751771-05:00","close_reason":"Not pursuing","labels":["plan-22","refactoring"],"dependencies":[{"issue_id":"bujo-ldq","depends_on_id":"bujo-hu8","type":"blocks","created_at":"2025-11-13T16:22:16.981916969-05:00","created_by":"daemon"}]}
{"id":"bujo-lev","title":"Create base/ directory for user extension points","description":"Move user extension points to `lib/bujo_pdf/base/`:\n\nFiles to move:\n- `component.rb` → `base/component.rb`\n- `layout.rb` → `base/layout.rb`\n\nTasks:\n1. Create `lib/bujo_pdf/base/` directory\n2. `git mv` both files\n3. Update requires in `lib/bujo_pdf.rb`\n4. Update any `require_relative` in dependent files (pages, components, layouts)\n5. Run tests\n\nPart of DSL reorganization plan.","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-11-30T15:08:20.312582527-05:00","updated_at":"2025-11-30T15:28:38.107040693-05:00","closed_at":"2025-11-30T15:28:38.107040693-05:00","close_reason":"Created base/ directory with component.rb and layout.rb. Updated 8 require paths. All tests pass. Commit 5650c4c."}
{"id":"bujo-m0p","title":"Custom tab cycling configuration","description":"Let users define their own navigation groups beyond the built-in grids cycle.\n\nCurrent state: Grids tab cycles through 8 predefined grid pages.\n\nEnhancement: Allow config-driven tab groups so users could define their own cycles like:\n- Planning tab: quarterly -\u003e monthly review -\u003e future log\n- Templates tab: index -\u003e collections -\u003e custom pages\n\nRelates to DSL work - this might fall out naturally from declarative page definitions.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-29T10:17:17.867376-05:00","updated_at":"2025-11-29T10:37:08.245419-05:00","closed_at":"2025-11-29T10:37:08.245419-05:00"}
{"id":"bujo-ma3","title":"Add tests for dsl/runtime/page_factory.rb (43% coverage)","description":"File: lib/bujo_pdf/dsl/runtime/page_factory.rb\nCurrent coverage: 43.48% (13 uncovered lines)\nTarget: 70%+","status":"open","priority":3,"issue_type":"chore","created_at":"2025-11-30T22:03:54.575112199-05:00","updated_at":"2025-11-30T22:03:54.575112199-05:00"}
{"id":"bujo-mg4","title":"Add tests for pages/mixin_support.rb (23% coverage)","description":"File: lib/bujo_pdf/pages/mixin_support.rb\nCurrent coverage: 23.08% (30 uncovered lines)\nTarget: 70%+","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-11-30T22:02:56.560795168-05:00","updated_at":"2025-11-30T22:57:25.942925034-05:00","closed_at":"2025-11-30T22:57:25.942925034-05:00","close_reason":"100% coverage achieved (target 70%). Added 36 tests covering start_new_page, build_context, total_weeks, define_page (render and define phases), and page_set."}
{"id":"bujo-mrz","title":"Investigate page count discrepancy after DSL refactor (89 vs ~177 pages)","description":"## Summary\nAfter refactoring PlannerGenerator to use the new page/page_set DSL, the generated planner has ~89 pages instead of the previous ~177 pages.\n\n## Current page breakdown (89 pages)\n- seasonal: 1\n- index: 2 (was 4)\n- future_log: 2\n- year_events: 1\n- year_highlights: 1\n- multi_year: 1\n- weekly: 53\n- quarterly_planning: 4\n- monthly_review: 12\n- grids: 8 (showcase + overview + 6 grid types)\n- templates: 4 (tracker, reference, daily_wheel, year_wheel)\n\n## Potential causes to investigate\n1. **Index page count**: Constants show INDEX_PAGE_COUNT=2, but CLAUDE.md says \"4 index pages by default\"\n2. **Missing pages**: May be missing some page types that existed before\n3. **Double-rendering**: Previous implementation may have generated pages multiple times (e.g., dual-page spreads?)\n4. **Legacy verb blocks**: Some legacy page generation methods may have generated multiple pages per call\n\n## Next steps\n- Compare against output from the previous PlannerGenerator implementation\n- Check if any page verbs were generating multiple pages\n- Verify INDEX_PAGE_COUNT should be 2 or 4\n- Verify no functionality was lost in the refactor","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-11-29T22:46:07.163658895-05:00","updated_at":"2025-11-29T22:50:08.380995181-05:00","closed_at":"2025-11-29T22:50:08.380995181-05:00"}
{"id":"bujo-nij","title":"Create Canvas class to bundle pdf + grid","description":"Create new Canvas value object that wraps pdf and grid system together.\n\n## Rationale\nThe pdf and grid parameters always travel together - every component needs both.\nCanvas provides a single object to pass, with room to add grid renderers later.\n\n## Architecture\n```\nDocument → Page → Canvas → Components\n                    ↓\n            wraps pdf + grid\n```\n\n## Implementation\n```ruby\n# lib/bujo_pdf/canvas.rb\nmodule BujoPdf\n  class Canvas\n    attr_reader :pdf, :grid\n\n    def initialize(pdf, grid)\n      @pdf = pdf\n      @grid = grid\n    end\n\n    # Grid coordinate delegators\n    def x(col) = @grid.x(col)\n    def y(row) = @grid.y(row)\n    def width(boxes) = @grid.width(boxes)\n    def height(boxes) = @grid.height(boxes)\n    def rect(col, row, w, h) = @grid.rect(col, row, w, h)\n\n    # Future: grid renderer access\n    # def dot_grid = @grid_renderers[:dot]\n  end\nend\n```\n\n## Files\n- Create: lib/bujo_pdf/canvas.rb\n- Modify: lib/bujo_pdf.rb (add require)\n- Modify: lib/bujo_pdf/pages/base.rb (create Canvas instance)\n\nThis is Phase 0 - must be done first before any component migration.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-30T15:47:59.152952861-05:00","updated_at":"2025-11-30T15:56:10.245414142-05:00","closed_at":"2025-11-30T15:56:10.245414142-05:00","close_reason":"Canvas class created at lib/bujo_pdf/canvas.rb with pdf/grid bundling and grid delegators. Commit b110d24."}
{"id":"bujo-nle","title":"Phase 2: Component Registry","description":"Build the component definition and instantiation system.\n\nCore classes:\n- ComponentRegistry - stores component definitions\n- ComponentDefinition - captures a component's block and params\n\nAPI:\n```ruby\nBujoPdf.define_component :day_header do |day:|\n  header height: 2 do\n    text day.name, style: :day_header\n  end\nend\n\n# Usage in pages:\ncomponent :day_header, day: week.days[index]\n```\n\nDeliverables:\n- ComponentRegistry class\n- ComponentDefinition class\n- component() DSL method\n- Tests for component instantiation","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-29T10:24:42.028436-05:00","updated_at":"2025-11-29T11:30:18.677467-05:00","closed_at":"2025-11-29T11:30:18.677467-05:00","dependencies":[{"issue_id":"bujo-nle","depends_on_id":"bujo-5e1","type":"parent-child","created_at":"2025-11-29T10:24:51.298599-05:00","created_by":"daemon"},{"issue_id":"bujo-nle","depends_on_id":"bujo-ter","type":"blocks","created_at":"2025-11-29T10:25:03.940532-05:00","created_by":"daemon"}]}
{"id":"bujo-nz8","title":"PDF DSL Phase 4: Standard Planner Recipe","description":"Define the :standard_planner recipe that produces output identical to the current PlannerGenerator.\n\nSteps:\n1. Define :standard_planner recipe using DSL\n2. Generate PDF with recipe\n3. Compare output to current generator (visual diff)\n4. Iterate until identical\n5. Document any DSL gaps discovered\n\nThis validates the PDF DSL can fully replace the existing generator.\n\nRecipe should include:\n- Seasonal calendar\n- Year events/highlights\n- 52-53 weekly pages\n- Grid showcase and grid pages\n- Reference, wheels\n\nSuccess criteria: Byte-for-byte identical PDF (or visually identical if byte comparison is impractical).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-29T10:30:44.580745-05:00","updated_at":"2025-11-29T12:09:22.305914-05:00","closed_at":"2025-11-29T12:09:22.305914-05:00","dependencies":[{"issue_id":"bujo-nz8","depends_on_id":"bujo-bjl","type":"parent-child","created_at":"2025-11-29T10:30:52.140973-05:00","created_by":"daemon"},{"issue_id":"bujo-nz8","depends_on_id":"bujo-1my","type":"blocks","created_at":"2025-11-29T10:30:52.159211-05:00","created_by":"daemon"}],"comments":[{"id":32,"issue_id":"bujo-nz8","author":"andy","text":"Commit 58d7941: Implemented standard_planner recipe\n\n- Created lib/bujo_pdf/pdf_dsl/recipes/standard_planner.rb with full page structure\n- Added load_recipes! method to PdfDSL module for recipe loading\n- Unit tests verify declaration structure (pages, groups, metadata)\n- Integration tests verify generated PDF matches original (\u003c5% file size variance)\n- All 357 tests pass","created_at":"2025-11-30T19:04:05Z"}]}
{"id":"bujo-o7s","title":"Collections template generator","description":"A titled blank page generator so users can add custom collection pages like 'Books to Read' or 'Project Ideas' without the generator having to opine on what collections should exist.\n\nCould be:\n- A config option to add named blank pages\n- A general-purpose 'titled dot grid page' component\n- Part of the DSL if that exists","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-29T10:15:47.024758-05:00","updated_at":"2025-11-29T12:51:56.528352-05:00","closed_at":"2025-11-29T12:51:56.528352-05:00","dependencies":[{"issue_id":"bujo-o7s","depends_on_id":"bujo-68h","type":"parent-child","created_at":"2025-11-29T10:15:54.308661-05:00","created_by":"daemon"}]}
{"id":"bujo-om0","title":"Index pages template","description":"Add numbered blank pages at the front for a hand-built table of contents. Classic bullet journal technique that works well digitally since you can hyperlink entries to page numbers.\n\nDesign considerations:\n- How many pages? (2-4 seems right)\n- Numbered lines or just blank with page numbers?\n- Link targets for each page so TOC entries can link to them","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-29T10:14:33.05737-05:00","updated_at":"2025-11-29T12:33:01.777052-05:00","closed_at":"2025-11-29T12:33:01.777052-05:00","dependencies":[{"issue_id":"bujo-om0","depends_on_id":"bujo-68h","type":"parent-child","created_at":"2025-11-29T10:14:38.87923-05:00","created_by":"daemon"}]}
{"id":"bujo-pk2","title":"Create ArcSegment component for wheel pages","description":"Extract duplicated arc rendering logic from:\n- daily_wheel.rb\n- year_wheel.rb\n\nCreate new component: lib/bujo_pdf/components/arc_segment.rb\n\nProvides: arc_segment(center_x, center_y, inner_r, outer_r, start_angle, end_angle, fill:)\n\nFUTURE WORK - Do not implement now.","status":"open","priority":3,"issue_type":"feature","created_at":"2025-11-30T21:24:28.900006981-05:00","updated_at":"2025-11-30T21:24:28.900006981-05:00"}
{"id":"bujo-prf","title":"Investigate declarative page DSL","description":"Explore what a declarative DSL for page composition might look like. Goals:\n\n- Express page structure without knowing Prawn internals\n- Compose from existing components (sidebars, grids, sections)\n- Make it easy to define new page types\n\nExample sketch:\n```ruby\npage :weekly do\n  sidebar width: 3 do\n    navigation :prev_week, :next_week\n  end\n  columns 7 do |day|\n    header day.name\n    field :tasks, lines: 5\n  end\n  section :notes, style: :cornell\nend\n```\n\nQuestions to answer:\n- What primitives does the DSL need? (columns, sections, sidebars, fields)\n- How does it integrate with the existing layout system?\n- What is the right level of abstraction?\n- How do navigation links work in this model?\n\nDeliverable: A design doc or spike implementation showing feasibility.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-29T10:14:15.41885-05:00","updated_at":"2025-11-29T10:25:12.117753-05:00","closed_at":"2025-11-29T10:25:12.117753-05:00","dependencies":[{"issue_id":"bujo-prf","depends_on_id":"bujo-68h","type":"related","created_at":"2025-11-29T10:17:24.109543-05:00","created_by":"daemon"}]}
{"id":"bujo-ptq","title":"WeekColumn: composition refactor to use component verbs","description":"Major refactor of WeekColumn to use component composition:\n- box() for backgrounds\n- text() for headers and labels  \n- hline() for dividers\n\nFile: lib/bujo_pdf/components/week_column.rb\n\nPart of component architecture refactoring - Phase 3.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-30T21:24:27.627203898-05:00","updated_at":"2025-11-30T22:06:50.893734915-05:00","closed_at":"2025-11-30T22:06:50.893734915-05:00","close_reason":"Refactored to use box(), hline(), and text() component verbs. Used hline() for dividers (sparse 2-box spacing) rather than ruled_lines() (dense row-by-row). Commit: 02356ab"}
{"id":"bujo-q0s","title":"Migrate existing Base::Component users to canvas: + explicit kwargs","description":"Convert 5 components from **options to canvas: + explicit kwargs.\n\n## Components\n1. TopNavigation\n2. CornellNotes\n3. WeekSidebar\n4. DailySection\n5. RightSidebar\n\n## Pattern\nBefore:\n```ruby\ndef initialize(pdf, grid_system, content_area: nil, **options)\n  super\n  # access via options[:year]\nend\n```\n\nAfter:\n```ruby\ndef initialize(canvas:, content_area: nil, year:, total_weeks:, col:, row:, ...)\n  super(canvas: canvas, content_area: content_area)\n  @year = year\n  @total_weeks = total_weeks\n  @col = col\n  @row = row\nend\n```\n\n## Files\n- lib/bujo_pdf/components/top_navigation.rb\n- lib/bujo_pdf/components/cornell_notes.rb\n- lib/bujo_pdf/components/week_sidebar.rb\n- lib/bujo_pdf/components/daily_section.rb\n- lib/bujo_pdf/components/right_sidebar.rb","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-30T15:34:29.347605893-05:00","updated_at":"2025-11-30T16:08:48.392915899-05:00","closed_at":"2025-11-30T16:08:48.392915899-05:00","close_reason":"Migrated 5 components + 2 callers to canvas: interface. Commit 510c83f.","dependencies":[{"issue_id":"bujo-q0s","depends_on_id":"bujo-auv","type":"blocks","created_at":"2025-11-30T15:34:59.775795884-05:00","created_by":"daemon"}]}
{"id":"bujo-q94","title":"Create PageRef and PageSet classes","description":"Create lib/bujo_pdf/page_ref.rb and lib/bujo_pdf/page_set.rb.\n\n## PageRef\n\nRepresents a single generated page:\n\n```ruby\nclass PageRef\n  attr_reader :dest_name, :title, :page_type, :metadata\n  attr_accessor :pdf_page_number, :set_context\n  \n  def initialize(dest_name:, title:, page_type:, metadata: {})\n    @dest_name = dest_name\n    @title = title\n    @page_type = page_type\n    @metadata = metadata\n    @pdf_page_number = nil  # Assigned during render phase\n    @set_context = nil      # Assigned if part of PageSet\n  end\n  \n  def in_set? = !set_context.nil?\n  \n  def outline_title\n    set_context\u0026.label || title\n  end\n  \n  # For link validation\n  def valid_destination? = true\nend\n```\n\n## PageSet\n\nCollection of related pages with pagination context:\n\n```ruby\nclass PageSet\n  include Enumerable\n  \n  attr_reader :name, :label_pattern, :count\n  \n  def initialize(name:, count:, label_pattern: nil)\n    @name = name\n    @count = count\n    @label_pattern = label_pattern\n    @pages = []\n  end\n  \n  def add(page_ref)\n    position = @pages.length + 1\n    page_ref.set_context = SetContext.new(\n      page: position,\n      total: @count,\n      label: interpolate_label(position),\n      set_name: @name\n    )\n    @pages \u003c\u003c page_ref\n    page_ref\n  end\n  \n  def each(\u0026) = @pages.each(\u0026)\n  def [](i) = @pages[i]\n  def first = @pages.first\n  def last = @pages.last\n  def size = @pages.length\n  \n  def outline_entry\n    { destination: first\u0026.pdf_page_number, title: @name }\n  end\n  \n  private\n  \n  def interpolate_label(pos)\n    label_pattern\u0026.gsub('%page', pos.to_s)\u0026.gsub('%total', @count.to_s)\n  end\n  \n  SetContext = Data.define(:page, :total, :label, :set_name) do\n    def first? = page == 1\n    def last? = page == total\n  end\nend\n```\n\n## Usage\n\n```ruby\n# Standalone page\nref = PageRef.new(dest_name: 'seasonal', title: 'Seasonal Calendar', page_type: :seasonal)\n\n# Page in a set\nset = PageSet.new(name: 'Index', count: 2, label_pattern: 'Index %page of %total')\nref1 = PageRef.new(dest_name: 'index_1', title: 'Index', page_type: :index)\nset.add(ref1)\nref1.set_context.label  # =\u003e \"Index 1 of 2\"\n```","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-29T21:18:04.237042623-05:00","updated_at":"2025-11-29T21:24:12.304521832-05:00","closed_at":"2025-11-29T21:24:12.304521832-05:00","comments":[{"id":33,"issue_id":"bujo-q94","author":"andy","text":"Commit 8957a35: Created PageRef and PageSet classes per spec. Renamed existing PageSet to PageSetContext to avoid collision. All tests pass, planner generates correctly.","created_at":"2025-11-30T19:04:05Z"}]}
{"id":"bujo-qce","title":"Add tests for pages/monthly_review.rb (32% coverage)","description":"File: lib/bujo_pdf/pages/monthly_review.rb\nCurrent coverage: 32.39% (48 uncovered lines)\nTarget: 70%+","status":"open","priority":2,"issue_type":"chore","created_at":"2025-11-30T22:03:24.897984737-05:00","updated_at":"2025-11-30T22:03:24.897984737-05:00"}
{"id":"bujo-qpq","title":"Refactor PDF outline to use inline declarations","description":"## Problem\n\nThe current `build_outline` method in `PdfBuilder` has ~90 lines of explicit mapping from destination keys to outline titles. This duplicates knowledge already present in page declarations and requires updating two locations when adding/removing pages.\n\n## Solution\n\nReplace explicit outline mapping with a declarative inline approach:\n\n### 1. Simple pages: `outline:` keyword argument\n\n```ruby\npage :seasonal, id: :seasonal, outline: 'Seasonal Calendar'\npage :index, id: :index_1, outline: 'Index'\npage :index, id: :index_2  # No outline (omitted)\n```\n\n### 2. Computed entries: `outline_entry` for conditional/dynamic cases\n\n```ruby\nweeks_in(year).each do |week|\n  page :weekly, id: :\"week_#{week.number}\", week: week\n  \n  if week.first_of_month?\n    outline_entry :\"week_#{week.number}\", \"#{week.month_name} #{year}\"\n  end\nend\n```\n\n### 3. Sections with hierarchy: `outline_section`\n\nPages declared inside an `outline_section` block inherit that section context:\n\n```ruby\noutline_section 'Front Matter' do\n  page :seasonal, id: :seasonal, outline: 'Seasonal Calendar'\n  page :index, id: :index_1, outline: 'Index'\n  page :future_log, id: :future_log_1, outline: 'Future Log'\nend\n```\n\n### 4. Clickable section headers: `dest:` parameter\n\nSection headers can link to a specific page while still grouping children:\n\n```ruby\noutline_section 'Grids', dest: :grid_showcase do\n  page :grid_showcase, id: :grid_showcase, outline: 'Grid Showcase'\n  page :grid_dot, id: :grid_dot, outline: 'Dot Grid'\nend\n\n# Or link to first child automatically\noutline_section 'January', dest: :first do\n  page :monthly_review, id: :review_1, outline: 'Monthly Review'\n  page :weekly, id: :week_1, outline: 'Week 1'\n  page :weekly, id: :week_2, outline: 'Week 2'\nend\n```\n\n### 5. Groups can contribute outline entry\n\n```ruby\ngroup :grids, cycle: true, outline: 'Grid Types Showcase' do\n  page :grid_showcase, id: :grid_showcase\n  # ...\nend\n```\n\n## Example: Monthly grouping pattern\n\n```ruby\n(1..12).each do |month|\n  month_name = Date::MONTHNAMES[month]\n  weeks = weeks_for_month(year, month)\n  \n  outline_section month_name, dest: :\"review_#{month}\" do\n    page :monthly_review, id: :\"review_#{month}\", outline: 'Monthly Review'\n    \n    weeks.each do |week|\n      page :weekly, id: :\"week_#{week}\", week: week, outline: \"Week #{week}\"\n    end\n  end\nend\n```\n\nClicking \"January\" jumps to review_1, expanding shows Monthly Review + Week 1-4.\n\n## Benefits\n\n- Single source of truth: add/remove page in one place\n- Outline entries collected in declaration order (matches document flow)\n- Conditional logic lives next to the pages it references\n- Visual grouping in recipe mirrors outline hierarchy\n- Clickable section headers for navigation + organization\n- Flexible nesting for any combination (months → weeks, quarters → months, etc.)\n\n## Implementation\n\n1. Add `outline:` param support to `PageDeclaration`\n2. Add `outline:` param support to `GroupDeclaration`\n3. Add `outline_entry` method to `DeclarationContext`\n4. Add `outline_section` method with block support and `dest:` param\n5. Track current section context in `DeclarationContext`\n6. Create `OutlineDeclaration` class to store entries with section/dest info\n7. Refactor `PdfBuilder#build_outline` to iterate collected entries\n8. Update `standard_planner.rb` to use new syntax\n9. Remove hardcoded outline mapping from `PdfBuilder`\n\n## Files\n\n- `lib/bujo_pdf/pdf_dsl/page_declaration.rb`\n- `lib/bujo_pdf/pdf_dsl/declaration_context.rb`\n- `lib/bujo_pdf/pdf_dsl/pdf_builder.rb`\n- `lib/bujo_pdf/pdf_dsl/recipes/standard_planner.rb`\n- `lib/bujo_pdf/pdf_dsl/outline_declaration.rb` (new)","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-30T08:21:13.154401566-05:00","updated_at":"2025-11-30T08:43:17.167299301-05:00","closed_at":"2025-11-30T08:43:17.167299301-05:00","comments":[{"id":34,"issue_id":"bujo-qpq","author":"andy","text":"Commit 472d241: Added OutlineDeclaration class, outline: param to PageDeclaration/GroupDeclaration, outline_entry and outline_section DSL methods, and updated standard_planner.rb to use declarative syntax","created_at":"2025-11-30T19:04:05Z"},{"id":35,"issue_id":"bujo-qpq","author":"andy","text":"Commit 3de76fe: Added outline: true support which auto-derives title from page class register_page declaration","created_at":"2025-11-30T19:04:05Z"}]}
{"id":"bujo-qy5","title":"Add tests for components/vline.rb (41% coverage)","description":"File: lib/bujo_pdf/components/vline.rb\nCurrent coverage: 41.18% (20 uncovered lines)\nTarget: 70%+","status":"open","priority":3,"issue_type":"chore","created_at":"2025-11-30T22:03:39.548015079-05:00","updated_at":"2025-11-30T22:03:39.548015079-05:00"}
{"id":"bujo-r8n","title":"MonthlyReview: use box verb for nav links","description":"Replace transparent fill_rounded_rectangle with box() verb for navigation links.\n\nFile: lib/bujo_pdf/pages/monthly_review.rb\n\nSame pattern as QuarterlyPlanning refactor.\n\nPart of component architecture refactoring - Phase 2.","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-11-30T21:24:05.580965031-05:00","updated_at":"2025-11-30T21:31:35.05477494-05:00","closed_at":"2025-11-30T21:31:35.05477494-05:00","close_reason":"Closed"}
{"id":"bujo-rq5","title":"Wire CalendarIntegration into PdfBuilder","description":"The calendar integration infrastructure is complete but not wired into the pipeline:\n\nFiles involved:\n- lib/bujo_pdf/calendar_integration/ - Full iCal parsing, event storage\n- config/calendars.yml - Calendar source configuration\n- Pages (year_at_glance_base.rb, week_column.rb) already expect context.event_store\n\nProblem: PdfBuilder.build_base_context() never calls CalendarIntegration.load_events() - so event_store is always nil and calendar highlights never appear.\n\nFix: Add to lib/bujo_pdf/pdf_dsl/pdf_builder.rb:\n  event_store = CalendarIntegration.load_events(year: year)\n  # Include in context hash","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-11-30T14:26:48.298553575-05:00","updated_at":"2025-11-30T14:56:26.164166006-05:00","closed_at":"2025-11-30T14:56:26.164166006-05:00","close_reason":"Wired CalendarIntegration into PdfBuilder. Calendar events now load from calendars.yml and appear in year-at-a-glance pages."}
{"id":"bujo-rw9","title":"Add tests for components/hline.rb (41% coverage)","description":"File: lib/bujo_pdf/components/hline.rb\nCurrent coverage: 41.18% (20 uncovered lines)\nTarget: 70%+","status":"open","priority":3,"issue_type":"chore","created_at":"2025-11-30T22:03:39.216813993-05:00","updated_at":"2025-11-30T22:03:39.216813993-05:00"}
{"id":"bujo-s5c","title":"PdfDSL may be missing named destinations for internal links","description":"## Problem\nNeed to verify that PdfDSL-generated PDFs have proper named destinations for internal navigation links.\n\n## Check\n- Year overview pages linking to weeks\n- Sidebar navigation links\n- Grid page cycling\n- Quarterly planning links to weeks\n\n## Location\nlib/bujo_pdf/pdf_dsl/pdf_builder.rb\nlib/bujo_pdf/pdf_dsl/link_registry.rb\n\n## Reference\nDocumentBuilder sets destinations via Pages::Base#set_destination","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-11-29T23:51:54.399572606-05:00","updated_at":"2025-11-30T00:06:46.552309259-05:00","closed_at":"2025-11-30T00:06:46.552309259-05:00","comments":[{"id":36,"issue_id":"bujo-s5c","author":"andy","text":"Commit 6495e9c: Added missing set_destination calls to all grid pages. The pages were using register_page with dest: metadata but not creating the actual named destinations in the PDF. Fixed by adding set_destination calls in setup methods of:\n- DotGridPage, GraphGridPage, LinedGridPage\n- IsometricGridPage, PerspectiveGridPage, HexagonGridPage\n- GridsOverview","created_at":"2025-11-30T19:04:05Z"}]}
{"id":"bujo-s5o","title":"Add tests for pages/year_at_glance_base.rb (17% coverage)","description":"File: lib/bujo_pdf/pages/year_at_glance_base.rb\nCurrent coverage: 17.06% (141 uncovered lines)\nTarget: 70%+","status":"closed","priority":1,"issue_type":"chore","created_at":"2025-11-30T22:02:41.584444261-05:00","updated_at":"2025-11-30T22:36:36.841066506-05:00","closed_at":"2025-11-30T22:36:36.841066506-05:00","close_reason":"Added 25 tests achieving 100% coverage"}
{"id":"bujo-s6k","title":"Example tracker spread (show dont prescribe)","description":"Include a single example spread demonstrating how someone COULD use the grid for habit tracking, mood tracking, etc. - without baking it into the main planner.\n\nOptions:\n- Separate PDF in the repo\n- Appendix pages in the main planner\n- Just a screenshot in the README\n\nGoal: Spark ideas without prescribing structure.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-29T10:16:13.58286-05:00","updated_at":"2025-11-29T13:03:49.294781-05:00","closed_at":"2025-11-29T13:03:49.294781-05:00","dependencies":[{"issue_id":"bujo-s6k","depends_on_id":"bujo-68h","type":"parent-child","created_at":"2025-11-29T10:17:17.826521-05:00","created_by":"daemon"}]}
{"id":"bujo-s9r","title":"Add tests for components/grid_dots.rb (36% coverage)","description":"File: lib/bujo_pdf/components/grid_dots.rb\nCurrent coverage: 36.0% (16 uncovered lines)\nTarget: 70%+","status":"open","priority":2,"issue_type":"chore","created_at":"2025-11-30T22:03:37.541298443-05:00","updated_at":"2025-11-30T22:03:37.541298443-05:00"}
{"id":"bujo-smh","title":"Fieldset: refactor to use text() and hline()/vline() verbs","description":"Refactor Fieldset component to use composition instead of direct Prawn calls.\n\nFile: lib/bujo_pdf/components/fieldset.rb\n\nCurrent problems:\n1. Includes Text::Mixin but calls pdf.text_box directly instead of using text() verb\n2. Has 8+ pdf.stroke_line calls for border drawing (pixel-precise)\n\nRefactor to:\n1. Replace pdf.text_box calls with text() verb (with rotation support)\n2. Replace pdf.stroke_line calls with hline()/vline() using pt_* params\n\nDepends on: bujo-etn (HLine pt_*), bujo-3xu (VLine pt_*)\n\nPart of component architecture refactoring - Phase 3.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-11-30T21:24:26.904236746-05:00","updated_at":"2025-11-30T21:51:18.948015132-05:00","closed_at":"2025-11-30T21:51:18.948015132-05:00","close_reason":"Refactored Fieldset to use box() and text() component verbs instead of direct Prawn calls","dependencies":[{"issue_id":"bujo-smh","depends_on_id":"bujo-etn","type":"blocks","created_at":"2025-11-30T21:24:34.844111745-05:00","created_by":"daemon"},{"issue_id":"bujo-smh","depends_on_id":"bujo-3xu","type":"blocks","created_at":"2025-11-30T21:24:34.859802662-05:00","created_by":"daemon"}]}
{"id":"bujo-stj","title":"Standardize TodoList component to use canvas/grid pattern","description":"TodoList component uses raw PDF coordinates (pdf:, x:, y:) instead of the standard canvas/grid pattern used by other components. Should be refactored to match the standard component interface for consistency.","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-11-30T20:54:10.514495798-05:00","updated_at":"2025-11-30T22:00:00.598316157-05:00","closed_at":"2025-11-30T22:00:00.598316157-05:00","close_reason":"Refactored TodoList to use canvas/grid pattern. Commit: 379a0d7"}
{"id":"bujo-sto","title":"Refactor Fieldset to use Box + Text components","description":"Rewrite Fieldset internals to compose Box + Text instead of raw Prawn stroke_line calls.\n\n**Implementation:**\n1. Include Box::Mixin and Text::Mixin in Fieldset\n2. Replace each position's border drawing with single box() call\n3. Replace each position's legend rendering with text() call (with rotation for vertical positions)\n4. Use position config hash to map positions to parameters:\n   - top_left: text at (col+1, row), position: :superscript, rotation: 0\n   - top_center: text centered, position: :superscript, rotation: 0\n   - top_right: text at right edge, rotation: -90\n   - bottom_left: text at (col+1, row+height), position: :subscript, rotation: 0\n   - bottom_right: text at left edge, rotation: +90\n\n**Files:**\n- lib/bujo_pdf/components/fieldset.rb\n\n**Acceptance:**\n- Fieldset renders identically to before\n- Code reduced from ~239 to ~80-100 lines\n- No raw @pdf.stroke_line or @pdf.rotate calls","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-11-30T15:20:21.535119825-05:00","updated_at":"2025-11-30T15:42:05.517329391-05:00","closed_at":"2025-11-30T15:42:05.517329391-05:00","close_reason":"Refactored Fieldset with data-driven position config and consolidated edge drawing methods. Note: Box component can't fully replace stroke_line because Fieldset needs gap-in-border effect. Commit b53e40a.","dependencies":[{"issue_id":"bujo-sto","depends_on_id":"bujo-4dk","type":"blocks","created_at":"2025-11-30T15:20:27.065900706-05:00","created_by":"daemon"}]}
{"id":"bujo-syo","title":"Add tests for components/week_column.rb (15% coverage)","description":"File: lib/bujo_pdf/components/week_column.rb\nCurrent coverage: 14.63% (105 uncovered lines)\nTarget: 70%+","status":"closed","priority":1,"issue_type":"chore","created_at":"2025-11-30T22:02:40.991889936-05:00","updated_at":"2025-11-30T22:31:18.79989116-05:00","closed_at":"2025-11-30T22:31:18.79989116-05:00","close_reason":"Added 24 tests achieving 100% coverage"}
{"id":"bujo-tap","title":"Add tests for pages/base.rb (43% coverage)","description":"File: lib/bujo_pdf/pages/base.rb\nCurrent coverage: 42.86% (60 uncovered lines)\nTarget: 70%+","status":"open","priority":3,"issue_type":"chore","created_at":"2025-11-30T22:03:54.233699372-05:00","updated_at":"2025-11-30T22:03:54.233699372-05:00"}
{"id":"bujo-ter","title":"Phase 1: Layout Engine","description":"Build a layout tree that computes bounding boxes.\n\nCore classes:\n- LayoutNode - base class with children, bounds, constraints\n- Container nodes: SidebarNode, HeaderNode, FooterNode, SectionNode, ColumnsNode, RowsNode, GridNode\n- Content nodes: TextNode, FieldNode, DotGridNode, GraphGridNode\n- Navigation nodes: NavLinkNode, NavGroupNode\n\nKey method:\n```ruby\ndef compute_bounds(available_rect)\n  # Resolve flex, apply constraints, recurse to children\nend\n```\n\nDeliverables:\n- Layout tree data structure\n- Flex layout algorithm\n- Bounding box computation\n- Unit tests for layout calculations","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-29T10:24:26.224674-05:00","updated_at":"2025-11-29T11:16:30.270314-05:00","closed_at":"2025-11-29T11:16:30.270314-05:00","dependencies":[{"issue_id":"bujo-ter","depends_on_id":"bujo-5e1","type":"parent-child","created_at":"2025-11-29T10:24:41.992845-05:00","created_by":"daemon"}],"comments":[{"id":37,"issue_id":"bujo-ter","author":"andy","text":"Commit 628dc7b: Layout engine implementation complete. Created layout tree data structure with LayoutNode base class, ContainerNode for flex layout, ColumnsNode/RowsNode/GridNode for divisions, ContentNode variants for renderable content, and NavigationNode for links/tabs. Flex layout algorithm distributes space proportionally with quantization to whole grid boxes. 62 unit tests passing.","created_at":"2025-11-30T19:04:05Z"}]}
{"id":"bujo-tzj","title":"Add tests for components/ruled_lines.rb (41% coverage)","description":"File: lib/bujo_pdf/components/ruled_lines.rb\nCurrent coverage: 41.18% (20 uncovered lines)\nTarget: 70%+","status":"open","priority":3,"issue_type":"chore","created_at":"2025-11-30T22:03:51.197545607-05:00","updated_at":"2025-11-30T22:03:51.197545607-05:00"}
{"id":"bujo-u1p","title":"PdfDSL missing PDF outline/bookmarks","description":"## Problem\nPDFs generated via BujoPdf.generate (PdfDSL path) have no outline/bookmarks.\n\nThe old DocumentBuilder path generated PDF outlines for navigation.\n\n## Expected\n- PDF should have bookmarks/outline for major sections\n- Year overview, weekly pages, grid pages, etc. should be navigable\n\n## Location\nlib/bujo_pdf/pdf_dsl/pdf_builder.rb - needs outline generation\n\n## Reference\nCheck how DocumentBuilder generates outlines and replicate in PdfBuilder","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-29T23:51:46.345550366-05:00","updated_at":"2025-11-30T00:03:34.580884935-05:00","closed_at":"2025-11-30T00:03:34.580884935-05:00","comments":[{"id":38,"issue_id":"bujo-u1p","author":"andy","text":"Commit 7d784e7: Added build_outline method to PdfBuilder to generate PDF bookmarks/outline. Outline structure matches DocumentBuilder with:\n- Front matter section\n- Year overview section\n- Planning pages section\n- Monthly navigation (12 entries linking to first week of each month)\n- Grid pages with indented sub-items\n- Template pages\n- Collection pages","created_at":"2025-11-30T19:04:05Z"}]}
{"id":"bujo-u7t","title":"Add tests for components/right_sidebar.rb (26% coverage)","description":"File: lib/bujo_pdf/components/right_sidebar.rb\nCurrent coverage: 26.03% (54 uncovered lines)\nTarget: 70%+","status":"open","priority":2,"issue_type":"chore","created_at":"2025-11-30T22:03:10.007441793-05:00","updated_at":"2025-11-30T22:03:10.007441793-05:00"}
{"id":"bujo-umc","title":"Create dsl/configuration/ for config loaders","description":"Move configuration loaders into `lib/bujo_pdf/dsl/configuration/`.\n\nFiles to move:\n- `collections_configuration.rb` → `dsl/configuration/collections.rb`\n- `date_configuration.rb` → `dsl/configuration/dates.rb`\n- `calendar_integration.rb` → `dsl/configuration/calendars.rb`\n- `calendar_integration/` subdirectory → `dsl/configuration/calendars/`\n\nTasks:\n1. Create `lib/bujo_pdf/dsl/configuration/` directory\n2. `git mv` all files (with simplified names)\n3. Update requires in `lib/bujo_pdf.rb`\n4. Update internal require_relative statements\n5. Run tests\n\nPart of DSL reorganization plan.","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-11-30T15:08:41.770643525-05:00","updated_at":"2025-11-30T15:39:52.144618162-05:00","closed_at":"2025-11-30T15:39:52.144618162-05:00","close_reason":"Created dsl/configuration/ with collections.rb, dates.rb, calendars.rb, and calendars/ subdirectory. Tests pass. Commit dbd4213.","dependencies":[{"issue_id":"bujo-umc","depends_on_id":"bujo-49m","type":"blocks","created_at":"2025-11-30T15:08:46.283421993-05:00","created_by":"daemon"}]}
{"id":"bujo-uvk","title":"Add tests for pages/grids/graph_grid_page.rb (42% coverage)","description":"File: lib/bujo_pdf/pages/grids/graph_grid_page.rb\nCurrent coverage: 42.42% (19 uncovered lines)\nTarget: 70%+","status":"open","priority":3,"issue_type":"chore","created_at":"2025-11-30T22:03:53.837018347-05:00","updated_at":"2025-11-30T22:03:53.837018347-05:00"}
{"id":"bujo-vuc","title":"Migrate SubComponentBase users to canvas: + explicit kwargs","description":"Convert 3 components from SubComponentBase (render_at pattern) to canvas: + position kwargs.\n\n## Components\n1. Fieldset\n2. DayHeader  \n3. WeekColumn\n\n## Pattern Change\nBefore:\n```ruby\nclass Fieldset \u003c SubComponentBase\n  def render_at(col, row, width_boxes, height_boxes)\n    legend = option(:legend)\n    # ...\n  end\nend\n# Usage: Fieldset.new(pdf, grid, legend: 'X').render_at(5, 10, 20, 30)\n```\n\nAfter:\n```ruby\nclass Fieldset \u003c Component\n  def initialize(canvas:, col:, row:, width:, height:, legend:, position: :top_left)\n    super(canvas: canvas)\n    @col = col\n    @row = row\n    @width = width\n    @height = height\n    @legend = legend\n    @position = position\n  end\n  \n  def render\n    # use @col, @row directly\n    # access pdf via: pdf.text_box(...)\n    # access grid via: grid.rect(@col, @row, @width, @height)\n  end\nend\n# Usage: Fieldset.new(canvas: canvas, col: 5, row: 10, width: 20, height: 30, legend: 'X').render\n```\n\n## Call Site Update\n- lib/bujo_pdf/components/daily_section.rb:93 calls WeekColumn#render_at\n- Change to: WeekColumn.new(canvas: @canvas, col:, row:, ...).render\n\n## Files\n- lib/bujo_pdf/components/fieldset.rb\n- lib/bujo_pdf/components/day_header.rb\n- lib/bujo_pdf/components/week_column.rb","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-30T15:34:37.357690678-05:00","updated_at":"2025-11-30T16:22:36.514462568-05:00","closed_at":"2025-11-30T16:22:36.514462568-05:00","close_reason":"Migrated Fieldset, DayHeader, WeekColumn to canvas: interface. Updated DailySection caller. Commit 5d7ab91.","dependencies":[{"issue_id":"bujo-vuc","depends_on_id":"bujo-auv","type":"blocks","created_at":"2025-11-30T15:34:59.789796668-05:00","created_by":"daemon"}]}
{"id":"bujo-whp","title":"Add tests for components/text.rb (20% coverage)","description":"File: lib/bujo_pdf/components/text.rb\nCurrent coverage: 20.0% (68 uncovered lines)\nTarget: 70%+","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-11-30T22:02:55.021194822-05:00","updated_at":"2025-11-30T22:49:21.898053155-05:00","closed_at":"2025-11-30T22:49:21.898053155-05:00","close_reason":"Added 37 tests achieving 99% coverage (up from 20%)"}
{"id":"bujo-wsa","title":"Add tests for calendars/event_store.rb (39% coverage)","description":"File: lib/bujo_pdf/dsl/configuration/calendars/event_store.rb\nCurrent coverage: 38.64% (27 uncovered lines)\nTarget: 70%+","status":"open","priority":2,"issue_type":"chore","created_at":"2025-11-30T22:03:38.522816259-05:00","updated_at":"2025-11-30T22:03:38.522816259-05:00"}
{"id":"bujo-wwp","title":"Update architecture documentation to reflect DSL system and component verb pattern","description":"## Context\nRecent architectural changes have introduced several new concepts not reflected in docs:\n\n## Changes to Document\n\n### 1. DSL System (lib/bujo_pdf/dsl/)\n- **builder.rb/context.rb** - Core DSL for defining planners\n- **configuration/** - Config loaders (calendars, collections, dates)\n- **runtime/** - Execution-time support (component_context, page_factory, render_context)\n\n### 2. Component Verb Pattern (lib/bujo_pdf/components/all.rb)\n- Components provide Mixin modules with verb methods\n- Pages call verbs like `ruled_lines()`, `grid_dots()`, `h1()` directly\n- Single include point via Components::All\n\n### 3. Base Extension Points (lib/bujo_pdf/base/)\n- component.rb - Base class for user-defined components\n- layout.rb - Base class for user-defined layouts\n\n### 4. Themes System (lib/bujo_pdf/themes/)\n- theme_registry.rb with light, earth, dark themes\n\n### 5. PDF Recipes (lib/bujo_pdf/pdfs/)\n- Recipe files that define complete planner configurations\n\n### 6. New Components\n- box, erase_dots, grid_dots, h1, h2, hline, vline\n- mini_month, ruled_lines, ruled_list, text\n- top_navigation, week_column, sub_component_base\n\n### 7. Grid Pages Namespace (lib/bujo_pdf/pages/grids/)\n- Specialized grid page types in separate directory\n\n## Files to Update\n- ARCHITECTURE.md (top-level)\n- docs/ARCHITECTURE.md (detailed)\n- docs/*.d2 diagrams (system-overview, component-hierarchy)\n- CLAUDE.md (project context)\n\n## Success Criteria\n- Documentation accurately reflects current codebase structure\n- D2 diagrams updated and regenerated\n- New patterns (DSL, verbs, themes) clearly explained","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-30T15:52:03.153736043-05:00","updated_at":"2025-11-30T16:15:14.910168479-05:00","closed_at":"2025-11-30T16:15:14.910168479-05:00","close_reason":"Updated all architecture documentation and diagrams to reflect DSL system, component verb pattern, themes, and new page types"}
{"id":"bujo-xi2","title":"Monthly review pages","description":"Simple prompt-based template for monthly reflection.\n\nPrompts like:\n- What worked this month?\n- What didn't work?\n- Focus for next month?\n\nKeep it minimal - just prompts and space to write. One page per month or a general template?","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-29T10:15:54.345857-05:00","updated_at":"2025-11-29T12:56:03.293264-05:00","closed_at":"2025-11-29T12:56:03.293264-05:00","dependencies":[{"issue_id":"bujo-xi2","depends_on_id":"bujo-68h","type":"parent-child","created_at":"2025-11-29T10:16:01.807624-05:00","created_by":"daemon"}]}
{"id":"bujo-xzh","title":"Refactor RightSidebar to use Text rotation","description":"Replace manual rotation logic in RightSidebar#draw_tab_text with Text component.\n\n**Current code** (lines 143-176 of right_sidebar.rb):\n@pdf.rotate(-90, origin: [center_x, center_y]) do\n  @pdf.text_box label, at: [text_box_x, text_box_y], ...\nend\n\n**Replacement:**\ntext(col, row, label, rotation: -90, size: FONT_SIZE, style: font_style, color: color)\n\n**Files:**\n- lib/bujo_pdf/components/right_sidebar.rb\n\n**Acceptance:** RightSidebar renders identical output with simplified code","status":"closed","priority":3,"issue_type":"chore","created_at":"2025-11-30T15:20:42.871943825-05:00","updated_at":"2025-11-30T17:40:50.492025601-05:00","closed_at":"2025-11-30T17:40:50.492025601-05:00","close_reason":"Refactored RightSidebar#draw_tab_text to use Text component with new centered rotation mode. All tests pass and visual output is identical.","dependencies":[{"issue_id":"bujo-xzh","depends_on_id":"bujo-4dk","type":"blocks","created_at":"2025-11-30T15:20:48.319710548-05:00","created_by":"daemon"}]}
{"id":"bujo-y8v","title":"Add tests for dsl/builder.rb (19% coverage)","description":"File: lib/bujo_pdf/dsl/builder.rb\nCurrent coverage: 19.08% (106 uncovered lines)\nTarget: 70%+","status":"closed","priority":1,"issue_type":"chore","created_at":"2025-11-30T22:02:42.843385178-05:00","updated_at":"2025-11-30T22:47:28.290645273-05:00","closed_at":"2025-11-30T22:47:28.290645273-05:00","close_reason":"Added 28 tests achieving 86% coverage (up from 19%)"}
{"id":"bujo-zqm","title":"Add missing pages to standard_planner recipe","description":"## Problem\nThe standard_planner recipe in PdfDSL is missing pages that PlannerGenerator included.\n\n## Missing pages\n- Index pages (2)\n- Future log pages (2)\n- Quarterly planning pages (4)\n- Monthly reviews (12)\n- Tracker example page (1)\n- Collection pages (user-configured)\n\n## Location\nlib/bujo_pdf/pdf_dsl/recipes/standard_planner.rb\n\n## Expected\nRecipe should generate same pages as the old PlannerGenerator (92 pages vs current 68)","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-29T23:51:46.195421539-05:00","updated_at":"2025-11-30T00:00:35.794109972-05:00","closed_at":"2025-11-30T00:00:35.794109972-05:00","comments":[{"id":39,"issue_id":"bujo-zqm","author":"andy","text":"Commit 58a72fe: Added all missing pages to standard_planner recipe:\n- Index pages (2)\n- Future log pages (2)\n- Quarterly planning (4) - interleaved before each quarter's weekly pages\n- Monthly reviews (12) - interleaved before each month's first weekly page\n- Tracker example page\n- Collection pages (loaded from config/collections.yml if present)\n\nAlso added Week#in_year?, #month, #quarter, #starts_quarter? methods to PdfDSL::Week.\nUpdated tests to verify new 92-page structure.","created_at":"2025-11-30T19:04:05Z"}]}
{"id":"bujo-zrw","title":"PDF DSL Phase 2: Link Resolution","description":"Implement two-pass build with cross-reference resolution.\n\nProblem: Pages reference each other (weekly links to prev/next week, year page links to weeks). Link targets must be known before rendering.\n\nSolution: Two-pass architecture\n1. Declaration pass - collect all pages, assign identifiers\n2. Render pass - generate pages with resolved links\n\nCore classes:\n- LinkRegistry - maps (page_type, params) -\u003e destination info\n- LinkResolver - resolves symbolic references to destinations\n\nKey behavior:\n- Build destination map from declarations\n- Pages query LinkRegistry during render\n- Handle missing destinations gracefully (validation or error)\n\nDeliverables:\n- LinkRegistry implementation\n- Two-pass PdfBuilder\n- Integration with existing navigation links\n- Tests for cross-reference resolution","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-29T10:28:25.25536-05:00","updated_at":"2025-11-29T11:41:50.088528-05:00","closed_at":"2025-11-29T11:41:50.088528-05:00","dependencies":[{"issue_id":"bujo-zrw","depends_on_id":"bujo-bjl","type":"parent-child","created_at":"2025-11-29T10:28:35.042388-05:00","created_by":"daemon"},{"issue_id":"bujo-zrw","depends_on_id":"bujo-2q7","type":"blocks","created_at":"2025-11-29T10:28:35.059424-05:00","created_by":"daemon"}],"comments":[{"id":40,"issue_id":"bujo-zrw","author":"andy","text":"Commit 237be4c: Implemented PDF DSL Phase 2 Link Resolution\n\nCreated:\n- LinkRegistry class for mapping declarations to destinations\n- LinkResolver class for high-level link resolution during render\n- Two-pass PdfBuilder with declaration pass and render pass\n- Each page receives link_registry and link_resolver in context\n\nTests: 32 tests, 60 assertions all passing","created_at":"2025-11-30T19:04:05Z"}]}
