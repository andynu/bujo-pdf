direction: down

title: Component Architecture (Verb Pattern) {
  near: top-center
  shape: text
  style: {
    font-size: 20
    bold: true
  }
}

# Component verb system
verb_system: Component Verb System {
  shape: package
  style: {
    fill: "#e3f2fd"
    stroke: "#1976d2"
    stroke-width: 2
  }

  all_module: "Components::All" {
    desc: "Aggregates all component mixins.\nSingle include point for Pages::Base."
  }

  pattern: Mixin Pattern {
    mixin: "Each component defines Mixin module"
    verb: "Mixin provides verb method(s)"
    include: "Pages call verbs directly"
  }
}

# Grid system
grid_system: GridSystem Utilities {
  shape: hexagon
  style: {
    fill: "#fce4ec"
    stroke: "#c2185b"
  }

  helpers: Grid Helper Methods {
    grid_x: grid_x(col) → x
    grid_y: grid_y(row) → y
    grid_width: grid_width(boxes) → width
    grid_height: grid_height(boxes) → height
    grid_rect: grid_rect(col, row, w, h) → hash
  }
}

# Navigation Components
nav_components: Navigation Components {
  shape: package
  style.fill: "#e8f5e9"

  week_sidebar: WeekSidebar {
    verb: "Used by layouts (not verb)"
    renders: "Week list 1-53 with month labels"
  }

  right_sidebar: RightSidebar {
    verb: "Used by layouts (not verb)"
    renders: "Rotated year/grid page tabs"
  }

  top_nav: TopNavigation {
    verb: "Used by layouts (not verb)"
    renders: "Prev/next week buttons"
  }
}

# Content Components (with verbs)
content_components: Content Components (Verbs) {
  shape: package
  style.fill: "#c8e6c9"

  text_comp: Text {
    verb: "text(col, row, content, **opts)"
    renders: "Text at grid position"
  }

  h1_comp: H1 {
    verb: "h1(col, row, content, **opts)"
    renders: "Large heading text"
  }

  h2_comp: H2 {
    verb: "h2(col, row, content, **opts)"
    renders: "Medium heading text"
  }

  fieldset_comp: Fieldset {
    verb: "fieldset(position:, legend:, **opts)"
    renders: "Bordered section with legend"
  }

  ruled_lines_comp: RuledLines {
    verb: "ruled_lines(col, row, w, h, **opts)"
    renders: "Horizontal ruled lines"
  }

  ruled_list_comp: RuledList {
    verb: "ruled_list(col, row, w, h, **opts)"
    renders: "Numbered/bulleted list"
  }

  mini_month_comp: MiniMonth {
    verb: "mini_month(col, row, year, month)"
    renders: "Compact month calendar"
  }
}

# Drawing Components (with verbs)
drawing_components: Drawing Components (Verbs) {
  shape: package
  style.fill: "#b2dfdb"

  box_comp: Box {
    verb: "box(col, row, w, h, **opts)"
    renders: "Rectangle outline/fill"
  }

  hline_comp: HLine {
    verb: "hline(col, row, width, **opts)"
    renders: "Horizontal line"
  }

  vline_comp: VLine {
    verb: "vline(col, row, height, **opts)"
    renders: "Vertical line"
  }

  grid_dots_comp: GridDots {
    verb: "grid_dots(col, row, w, h, **opts)"
    renders: "Dot grid overlay"
  }

  erase_dots_comp: EraseDots {
    verb: "erase_dots(col, row, w, h)"
    renders: "White rectangle to hide dots"
  }
}

# Prawn integration
prawn: Prawn PDF {
  shape: cylinder
  style: {
    fill: "#eceff1"
    stroke: "#546e7a"
  }
}

# Pages using verbs
pages: Page Classes {
  shape: package
  style.fill: "#fff3e0"

  base: "Pages::Base" {
    includes: "includes Components::All"
  }

  example_usage: |ruby
    def render
      h1(5, 2, "Title")
      ruled_lines(5, 5, 30, 20)
      fieldset(position: :top_left,
               legend: "Notes")
    end
  |
}

# Verb system flow
verb_system.all_module -> content_components: includes mixins from
verb_system.all_module -> drawing_components: includes mixins from
pages.base -> verb_system.all_module: includes

# Grid coordinate usage
content_components -> grid_system: uses for positioning
drawing_components -> grid_system: uses for positioning
nav_components -> grid_system: uses for positioning

# Prawn drawing operations
content_components -> prawn: text_box, stroke operations
drawing_components -> prawn: line, rect, fill operations
nav_components -> prawn: text_box, link_annotation

# Layout system using nav components
layouts: StandardWithSidebarsLayout {
  shape: hexagon
  style.fill: "#f3e5f5"
}

layouts -> nav_components: renders sidebars
