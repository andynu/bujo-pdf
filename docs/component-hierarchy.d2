direction: down

title: Component Architecture (Verb Pattern) {
  near: top-center
  shape: text
  style: {
    font-size: 20
    bold: true
  }
}

# Component verb system
verb_system: Component Verb System {
  shape: package
  style: {
    fill: "#e3f2fd"
    stroke: "#1976d2"
    stroke-width: 2
  }

  all_module: |md
    **Components::All**<br/>
    Aggregates all component mixins<br/>
    Single include point for Pages::Base
  |

  pattern: |md
    **Mixin Pattern**<br/>
    1. Each component defines Mixin module<br/>
    2. Mixin provides verb method(s)<br/>
    3. Pages call verbs directly
  |
}

# Grid system
grid_system: GridSystem Utilities {
  shape: hexagon
  style: {
    fill: "#fce4ec"
    stroke: "#c2185b"
  }

  helpers: |md
    **Grid Helper Methods**<br/>
    `grid_x(col)` → x coordinate<br/>
    `grid_y(row)` → y coordinate<br/>
    `grid_width(boxes)` → width in points<br/>
    `grid_height(boxes)` → height in points<br/>
    `grid_rect(col, row, w, h)` → bounds hash
  |
}

# Navigation Components
nav_components: Navigation Components {
  shape: package
  style.fill: "#e8f5e9"

  week_sidebar: |md
    **WeekSidebar**<br/>
    Week list 1-53 with month labels<br/>
    *(Used by layouts, not verb)*
  |

  right_sidebar: |md
    **RightSidebar**<br/>
    Rotated year/grid page tabs<br/>
    *(Used by layouts, not verb)*
  |

  top_nav: |md
    **TopNavigation**<br/>
    Prev/next week buttons<br/>
    *(Used by layouts, not verb)*
  |
}

# Content Components (with verbs)
content_components: Content Components (Verbs) {
  shape: package
  style.fill: "#c8e6c9"

  text_comp: |md
    **Text**<br/>
    Text at grid position<br/>
    `text(col, row, content, **opts)`
  |

  h1_comp: |md
    **H1**<br/>
    Large heading text<br/>
    `h1(col, row, content, **opts)`
  |

  h2_comp: |md
    **H2**<br/>
    Medium heading text<br/>
    `h2(col, row, content, **opts)`
  |

  fieldset_comp: |md
    **Fieldset**<br/>
    Bordered section with legend<br/>
    `fieldset(position:, legend:, **opts)`
  |

  ruled_lines_comp: |md
    **RuledLines**<br/>
    Horizontal ruled lines<br/>
    `ruled_lines(col, row, w, h, **opts)`
  |

  ruled_list_comp: |md
    **RuledList**<br/>
    Numbered/bulleted list<br/>
    `ruled_list(col, row, w, h, **opts)`
  |

  mini_month_comp: |md
    **MiniMonth**<br/>
    Compact month calendar<br/>
    `mini_month(col, row, year, month)`
  |
}

# Drawing Components (with verbs)
drawing_components: Drawing Components (Verbs) {
  shape: package
  style.fill: "#b2dfdb"

  box_comp: |md
    **Box**<br/>
    Rectangle outline/fill<br/>
    `box(col, row, w, h, **opts)`
  |

  hline_comp: |md
    **HLine**<br/>
    Horizontal line<br/>
    `hline(col, row, width, **opts)`
  |

  vline_comp: |md
    **VLine**<br/>
    Vertical line<br/>
    `vline(col, row, height, **opts)`
  |

  grid_dots_comp: |md
    **GridDots**<br/>
    Dot grid overlay<br/>
    `grid_dots(col, row, w, h, **opts)`
  |

  erase_dots_comp: |md
    **EraseDots**<br/>
    White rectangle to hide dots<br/>
    `erase_dots(col, row, w, h)`
  |
}

# Prawn integration
prawn: Prawn PDF {
  shape: cylinder
  style: {
    fill: "#eceff1"
    stroke: "#546e7a"
  }
}

# Pages using verbs
pages: Page Classes {
  shape: package
  style.fill: "#fff3e0"

  base: |md
    **Pages::Base**<br/>
    includes Components::All<br/>
    provides @pdf and @grid_system
  |

  example_usage: |ruby
    def render
      h1(5, 2, "Title")
      ruled_lines(5, 5, 30, 20)
      fieldset(position: :top_left,
               legend: "Notes")
    end
  |
}

# Verb system flow
verb_system.all_module -> content_components: includes mixins from
verb_system.all_module -> drawing_components: includes mixins from
pages.base -> verb_system.all_module: includes

# Grid coordinate usage
content_components -> grid_system: uses for positioning
drawing_components -> grid_system: uses for positioning
nav_components -> grid_system: uses for positioning

# Prawn drawing operations
content_components -> prawn: text_box, stroke operations
drawing_components -> prawn: line, rect, fill operations
nav_components -> prawn: text_box, link_annotation

# Layout system using nav components
layouts: StandardWithSidebarsLayout {
  shape: hexagon
  style.fill: "#f3e5f5"
}

layouts -> nav_components: renders sidebars
