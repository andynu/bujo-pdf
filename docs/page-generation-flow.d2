direction: down

title: PDF Generation Flow (DSL-Based) {
  near: top-center
  shape: text
  style: {
    font-size: 20
    bold: true
  }
}

user: User {shape: person}
cli: bin/bujo-pdf {shape: rectangle}

# DSL Layer
dsl: DSL Layer {
  shape: package
  style.fill: "#e3f2fd"

  builder: Builder {
    desc: "Entry point for planner definition"
  }
  context: Context {
    desc: "Runtime state (pdf, year, theme)"
  }
  registry: PageRegistry {
    desc: "Tracks all pages & destinations"
  }
}

# Configuration
config: Configuration {
  shape: package
  style.fill: "#fff9c4"

  dates: dates.yml {shape: document}
  calendars: calendars.yml {shape: document}
  collections: collections.yml {shape: document}
}

pdf_doc: PDF Document {
  shape: cylinder
  style.fill: "#fff3e0"
}

# Page Generation Phases
phase1: Phase 1: Front Matter {
  shape: step
  style.fill: "#e8f5e9"

  pages: |md
    - Index Pages (4)
    - Future Log (2)
    - Collection Pages
    - Monthly Reviews (12)
    - Quarterly Planning (4)
  |
}

phase2: Phase 2: Year Overview {
  shape: step
  style.fill: "#e8f5e9"

  pages: |md
    - Seasonal Calendar
    - Year Events
    - Year Highlights
    - Multi-Year Overview
    - Tracker Example
  |
}

phase3: Phase 3: Weekly Pages {
  shape: step
  style.fill: "#e8f5e9"
}

phase3_loop: "Loop 52-53 weeks" {
  shape: rectangle
  style: {
    stroke-dash: 3
    fill: "#fff9c4"
  }
}

phase4: Phase 4: Grid Templates {
  shape: step
  style.fill: "#e8f5e9"

  pages: |md
    - Grid Showcase
    - Grids Overview
    - Dot Grid
    - Graph Grid
    - Lined Grid
    - Isometric Grid
    - Perspective Grid
    - Hexagon Grid
  |
}

phase5: Phase 5: Wheels & Templates {
  shape: step
  style.fill: "#e8f5e9"

  pages: |md
    - Daily Wheel
    - Year Wheel
    - Reference Page
  |
}

outline: Build PDF Outline {
  shape: step
  style.fill: "#f3e5f5"

  desc: "Nested bookmarks from\nPageRegistry with outline: true"
}

output: planner_YYYY.pdf {
  shape: document
  style: {
    fill: "#ffebee"
    stroke: "#c62828"
    stroke-width: 2
  }
}

success: Generation complete {
  shape: oval
  style: {
    fill: "#c8e6c9"
    stroke: "#388e3c"
    stroke-width: 2
  }
}

# Flow connections
user -> cli: bin/bujo-pdf 2025
cli -> dsl.builder: load planner recipe

config.dates -> dsl.builder: load dates
config.calendars -> dsl.builder: load calendar events
config.collections -> dsl.builder: load collection pages

dsl.builder -> dsl.context: create context (pdf, year, theme)
dsl.builder -> dsl.registry: register all pages
dsl.context -> pdf_doc: create PDF document

pdf_doc -> phase1: generate front matter
phase1 -> phase2: front matter complete
phase2 -> phase3: year overview complete
phase3 -> phase3_loop: for each week in year
phase3_loop -> phase4: all weeks complete
phase4 -> phase5: grid templates complete
phase5 -> outline: wheels/templates complete

outline -> output: add bookmarks\nsave to disk
output -> success: file written
success -> user: planner ready
