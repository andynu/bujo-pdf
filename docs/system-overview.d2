direction: right

title: BujoPDF System Architecture {
  near: top-center
  shape: text
  style: {
    font-size: 20
    bold: true
  }
}

# DSL Layer - Entry point for defining planners
dsl: DSL Module {
  shape: package
  style: {
    fill: "#e3f2fd"
    stroke: "#1976d2"
    stroke-width: 2
  }

  builder: Builder
  context: Context
  registry: PageRegistry

  configuration: Configuration {
    calendars: Calendars
    dates: Dates
    collections: Collections
  }

  runtime: Runtime {
    component_ctx: ComponentContext
    page_factory: PageFactory
    render_ctx: RenderContext
  }
}

# Recipes - Complete planner definitions
pdfs: PDFs (Recipes) {
  shape: package
  style.fill: "#e1f5fe"

  standard: StandardPlanner
}

# Pages Module
pages: Pages Module {
  shape: package
  style.fill: "#fff3e0"

  base: Base
  seasonal: SeasonalCalendar
  year_events: YearEvents
  year_highlights: YearHighlights
  weekly: WeeklyPage
  index: IndexPages
  future_log: FutureLog
  collection: CollectionPage
  review: MonthlyReview
  quarterly: QuarterlyPlanning

  grids: Grids Namespace {
    dot: DotGridPage
    graph: GraphGridPage
    lined: LinedGridPage
    iso: IsometricGridPage
  }
}

# Layouts Module
layouts: Layouts Module {
  shape: package
  style.fill: "#f3e5f5"

  base_layout: BaseLayout
  full_page: FullPageLayout
  standard_sidebars: StandardWithSidebarsLayout
  factory: LayoutFactory
}

# Components Module - with verb pattern
components: Components Module {
  shape: package
  style.fill: "#e8f5e9"

  all: "All (Mixin aggregator)"

  navigation: Navigation {
    week_sidebar: WeekSidebar
    right_sidebar: RightSidebar
    top_nav: TopNavigation
  }

  content: Content {
    fieldset: Fieldset
    text: Text
    h1: H1
    h2: H2
    ruled_lines: RuledLines
    ruled_list: RuledList
    mini_month: MiniMonth
  }

  drawing: Drawing {
    box: Box
    hline: HLine
    vline: VLine
    grid_dots: GridDots
    erase_dots: EraseDots
  }
}

# Base Module - User extension points
base: Base Module {
  shape: package
  style.fill: "#fce4ec"

  component: Component (base class)
  layout: Layout (base class)
}

# Themes Module
themes: Themes Module {
  shape: package
  style.fill: "#fff9c4"

  registry: ThemeRegistry
  light: Light
  earth: Earth
  dark: Dark
}

# Utilities Module
utilities: Utilities Module {
  shape: package
  style.fill: "#f3e5f5"

  grid_system: GridSystem
  date_calc: DateCalculator
  grid_renderers: GridRenderers
}

prawn: Prawn PDF Library {
  shape: cylinder
  style: {
    fill: "#eceff1"
    stroke: "#546e7a"
  }
}

output: planner_YYYY.pdf {
  shape: document
  style: {
    fill: "#ffebee"
    stroke: "#c62828"
  }
}

# DSL orchestrates everything
pdfs.standard -> dsl.builder: defines planner
dsl.builder -> dsl.context: creates context
dsl.builder -> dsl.registry: registers pages
dsl.configuration -> dsl.builder: provides config
dsl.runtime -> pages: creates pages

# Pages use components via verbs
pages.base -> components.all: includes verb mixins
components.all -> components.content: aggregates mixins
components.all -> components.drawing: aggregates mixins
components.all -> components.navigation: aggregates mixins

# Page/Layout relationships
pages.base -> layouts.base_layout: uses layout system
layouts.factory -> layouts.full_page: creates
layouts.factory -> layouts.standard_sidebars: creates
layouts.standard_sidebars -> components.navigation: renders sidebars

# Base module provides extension points
base.component -> components: subclassed by
base.layout -> layouts: subclassed by

# Theme integration
themes.registry -> dsl.context: provides colors
themes.registry -> components: provides styling

# Utilities used throughout
pages.base -> utilities.grid_system: coordinates
pages.base -> utilities.date_calc: date logic
components -> utilities.grid_system: positioning

# Prawn integration
dsl.runtime -> prawn: PDF operations
pages.base -> prawn: drawing
layouts.base_layout -> prawn: drawing
components -> prawn: drawing

# Output
dsl.builder -> output: saves file
